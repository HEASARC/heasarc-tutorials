
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Exploring RXTE spectral observations of Eta Car &#8212; HEASARC Tutorial Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=79d33dc3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-R7YGYK7HYQ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-R7YGYK7HYQ');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/mission_specific_analyses/rxte/analyze-rxte-spectra';</script>
    <link rel="icon" href="../../../_static/heasarc_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Using archived and newly generated RXTE light curves" href="analyze-rxte-lightcurves.html" />
    <link rel="prev" title="RXTE" href="rxte_index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p class='beta-banner'>The HEASARC tutorials resource is in <strong>BETA</strong> and may be subject to significant changes.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/heasarc_logo.png" class="logo__image only-light" alt="High Energy Astrophysics Science Archive Research Center - Home"/>
    <script>document.write(`<img src="../../../_static/heasarc_logo.png" class="logo__image only-dark" alt="High Energy Astrophysics Science Archive Research Center - Home"/>`);</script>
  
  
    <p class="title logo__title">v0.1</p>
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/HEASARC/heasarc-tutorials" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../about/about_index.html">About</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about/authors.html">Contributors</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developing skills with HEASARC services</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../heasarc_service_skills/heasarc_data/heasarc_data_index.html">Accessing HEASARC Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../heasarc_service_skills/heasarc_data/pyvo-data-acquisition.html">Using PyVO to find and acquire HEASARC data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../heasarc_service_skills/heasarc_catalogs/heasarc_catalogs_index.html">Accessing HEASARC Catalogs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../heasarc_service_skills/heasarc_catalogs/finding_relevant_heasarc_catalog.html">Find specific HEASARC catalogs using Python</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mission specific tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../nustar/nustar_index.html">NuSTAR</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nustar/data-analysis-nustar.html">Analyzing a single NuSTAR observation</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="rxte_index.html">RXTE</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Exploring RXTE spectral observations of Eta Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="analyze-rxte-lightcurves.html">Using archived and newly generated RXTE light curves</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nicer/nicer_index.html">NICER</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nicer/data-analysis-nicer.html">Getting started with NICER data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ixpe/ixpe_index.html">IXPE</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ixpe/data-analysis-ixpe.html">Getting started with preprocessed IXPE data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../swift/swift_index.html">Swift</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../swift/getting-started-swift-xrt.html">Getting started with Swift-XRT</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful high-energy tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy_index.html">HEASoftPy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy-getting-started.html">Getting started with HEASoftPy</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas_index.html">pySAS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas-short-intro.html">Short introduction to pySAS</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/edit/main/tutorials/mission_specific_analyses/rxte/analyze-rxte-spectra.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/issues/new?title=Issue%20on%20page%20%2Ftutorials/mission_specific_analyses/rxte/analyze-rxte-spectra.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/tutorials/mission_specific_analyses/rxte/analyze-rxte-spectra.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exploring RXTE spectral observations of Eta Car</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-environments">Imports &amp; Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-data">1. Finding the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-find-the-heasarc-table-that-lists-all-of-rxtes-observations">Using Astroquery to find the HEASARC table that lists all of RXTE’s observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-rxte-observations-of-eta-car">Identifying RXTE observations of Eta Car</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets">Using Astroquery to fetch datalinks to RXTE datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-the-data">2. Acquiring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-easiest-way-to-download-data">The easiest way to download data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-only-rxte-pca-spectra">Downloading only RXTE-PCA spectra</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data-into-pyxspec">3. Reading the data into PyXspec</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-pyxspec">Configuring PyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-fitting-the-spectra">Reading and fitting the spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-spectra">Visualizing the spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-fitted-models">Visualizing the fitted models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-model-fit-results">4. Exploring model fit results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitted-model-parameter-distributions">Fitted model parameter distributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-model-parameters-vary-with-time">Do model parameters vary with time?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-simple-unsupervised-machine-learning-to-the-spectra">5. Applying simple unsupervised machine learning to the spectra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing">Preparing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolating-the-spectra-onto-a-common-energy-grid">Interpolating the spectra onto a common energy grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-and-normalizing-the-spectra">Scaling and normalizing the spectra</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-scaled-and-normalized-spectra">Examining the scaled and normalized spectra</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-the-dimensionality-of-the-scaled-spectral-dataset">Reducing the dimensionality of the scaled spectral dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#principal-component-analysis-pca">Principal Component Analysis (PCA)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#t-distributed-stochastic-neighbor-embedding-t-sne">T-distributed Stochastic Neighbor Embedding (t-SNE)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#uniform-manifold-approximation-and-projection-umap">Uniform Manifold Approximation and Projection (UMAP)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-results-of-the-different-dimensionality-reduction-methods">Comparing the results of the different dimensionality reduction methods</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-clustering-of-like-spectra-with-density-based-spatial-clustering-of-applications-with-noise-dbscan">Automated clustering of like spectra with Density-Based Spatial Clustering of Applications with Noise (DBSCAN)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-results-of-spectral-clustering">Exploring the results of spectral clustering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exploring-rxte-spectral-observations-of-eta-car">
<h1>Exploring RXTE spectral observations of Eta Car<a class="headerlink" href="#exploring-rxte-spectral-observations-of-eta-car" title="Link to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Know how to find and use observation tables hosted by HEASARC.</p></li>
<li><p>Be able to search for RXTE observations of a named source.</p></li>
<li><p>Understand how to access RXTE spectra stored in the HEASARC S3 bucket.</p></li>
<li><p>Be capable of downloading and visualizing retrieved spectra.</p></li>
<li><p>Perform basic spectral fits and explore how spectral properties change with time.</p></li>
<li><p>Use simple machine learning techniques to perform a model-independent analysis of the spectral data.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook demonstrates an analysis of archival Rossi X-ray Timing Explorer (RXTE) Proportional Counter Array (PCA) data, particularly spectra of Eta Car.</p>
<p>The RXTE archive contains standard data products that can be used without re-processing the data, which are summarized in this <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes/stdprod_guide.html">description of standard RXTE data products</a>.</p>
<p>We find all the standard spectra and then load, visualize, and fit them with PyXspec.</p>
<section id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The name of the source we are going to explore using archival RXTE observations - <strong>Eta Car</strong>.</p></li>
</ul>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Downloaded source and background spectra.</p></li>
<li><p>Downloaded spectral response files.</p></li>
<li><p>Visualization of all spectra and fitted spectral models.</p></li>
<li><p>A figure showing powerlaw model parameter distributions from all spectral fits.</p></li>
<li><p>A figure showing how fitted model parameters vary with time.</p></li>
</ul>
</section>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading">#</a></h3>
<p>As of 16th January 2026, this notebook takes ~3 minutes to run to completion on Fornax, using the ‘small’ server with 8GB RAM/ 2 cores.</p>
</section>
</section>
<section id="imports-environments">
<h2>Imports &amp; Environments<a class="headerlink" href="#imports-environments" title="Link to this heading">#</a></h2>
<p>We need the following Python modules:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.io.fits</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fits</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xspec</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span><span class="p">,</span> <span class="n">TimeDelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.heasarc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Heasarc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cycler</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FuncFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">s3fs</span><span class="w"> </span><span class="kn">import</span> <span class="n">S3FileSystem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.manifold</span><span class="w"> </span><span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">umap</span><span class="w"> </span><span class="kn">import</span> <span class="n">UMAP</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/heasoft/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
</section>
<section id="global-setup">
<h2>Global Setup<a class="headerlink" href="#global-setup" title="Link to this heading">#</a></h2>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading">#</a></h3>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SRC_NAME</span> <span class="o">=</span> <span class="s2">&quot;Eta Car&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h3>
<p>The only configuration we do is to set up the root directory where we will store downloaded data.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># -------------- Set paths and create directories --------------</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;../../../_data&quot;</span><span class="p">):</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;../../../_data/RXTE/&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;RXTE/&quot;</span>

<span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>

<span class="c1"># Make sure the download directory exists.</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<hr class="docutils" />
<section id="finding-the-data">
<h2>1. Finding the data<a class="headerlink" href="#finding-the-data" title="Link to this heading">#</a></h2>
<p>To identify the relevant RXTE data, we could use <a class="reference external" href="https://heasarc.gsfc.nasa.gov/xamin/">Xamin</a>, the HEASARC web portal, the Virtual Observatory (VO) python client <code class="docutils literal notranslate"><span class="pre">pyvo</span></code>, or <strong>the Astroquery module</strong> (our choice for this demonstration).</p>
<section id="using-astroquery-to-find-the-heasarc-table-that-lists-all-of-rxtes-observations">
<h3>Using Astroquery to find the HEASARC table that lists all of RXTE’s observations<a class="headerlink" href="#using-astroquery-to-find-the-heasarc-table-that-lists-all-of-rxtes-observations" title="Link to this heading">#</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code> object from Astroquery, we can easily search through all of HEASARC’s catalog holdings. In this
case we need to find what we refer to as a ‘master’ catalog/table, which summarizes all RXTE observations present in
our archive. We can do this by passing the <code class="docutils literal notranslate"><span class="pre">master=True</span></code> keyword argument to the <code class="docutils literal notranslate"><span class="pre">list_catalogs</span></code> method.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_name</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">list_catalogs</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="s2">&quot;xte&quot;</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<span class="n">table_name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.str_(&#39;xtemaster&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="identifying-rxte-observations-of-eta-car">
<h3>Identifying RXTE observations of Eta Car<a class="headerlink" href="#identifying-rxte-observations-of-eta-car" title="Link to this heading">#</a></h3>
<p>Now that we have identified the HEASARC table that contains summary information about all of RXTE’s observations, we’re going to search
it for observations of <strong>Eta Car</strong>.</p>
<p>For convenience, we pull the coordinate of Eta Car from the <a class="reference external" href="https://cds.unistra.fr/">Strasbourg astronomical Data Center (CDS)</a> name resolver functionality built into Astropy’s
<code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> class.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>You should always carefully vet the positions you use in your own work!</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the coordinate for Eta Car</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="s2">&quot;Eta Car&quot;</span><span class="p">)</span>
<span class="n">pos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (161.2647742, -59.6844309)&gt;
</pre></div>
</div>
</div>
</div>
<p>Then we can use the <code class="docutils literal notranslate"><span class="pre">query_region</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code> to search for observations with a central coordinate that
falls within a radius of <span class="math notranslate nohighlight">\(0.2^{\prime}\)</span> of Eta Car.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Each HEASARC catalog has its own default search radius, but we select <span class="math notranslate nohighlight">\(0.2^{\prime}\)</span> to limit the number of results.
You should carefully consider the search radius you use for your own science case!</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_obs</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span>
    <span class="n">pos</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">Quantity</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;arcmin&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">valid_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=317</i>
<table id="table140655059524048" class="table-striped table-bordered table-condensed">
<thead><tr><th>obsid</th><th>prnb</th><th>status</th><th>pi_lname</th><th>pi_fname</th><th>target_name</th><th>ra</th><th>dec</th><th>time</th><th>duration</th><th>exposure</th><th>__row</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>deg</th><th>deg</th><th>d</th><th>s</th><th>s</th><th></th></tr></thead>
<thead><tr><th>object</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th></tr></thead>
<tr><td>94002-01-15-00</td><td>94002</td><td>archived</td><td>TOO</td><td>PUBLIC</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>55000.4322</td><td>2518</td><td>1197</td><td>16751</td></tr>
<tr><td>93002-01-17-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54398.83492</td><td>2179</td><td>924</td><td>16752</td></tr>
<tr><td>93002-02-52-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54808.7048</td><td>1582</td><td>905</td><td>16753</td></tr>
<tr><td>93002-02-53-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54810.66671</td><td>1510</td><td>829</td><td>16754</td></tr>
<tr><td>93002-02-54-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54812.85572</td><td>1430</td><td>927</td><td>16755</td></tr>
<tr><td>93002-01-47-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54606.98389</td><td>3246</td><td>863</td><td>16756</td></tr>
<tr><td>93002-02-55-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54814.29519</td><td>2168</td><td>771</td><td>16757</td></tr>
<tr><td>93002-02-56-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54816.35667</td><td>2442</td><td>885</td><td>16758</td></tr>
<tr><td>93002-02-57-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54818.31775</td><td>2273</td><td>830</td><td>16759</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>93002-02-45-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54794.04643</td><td>2080</td><td>853</td><td>17059</td></tr>
<tr><td>93002-01-32-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54502.15576</td><td>2869</td><td>923</td><td>17060</td></tr>
<tr><td>93002-02-46-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54796.9229</td><td>1269</td><td>957</td><td>17061</td></tr>
<tr><td>93002-02-47-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54798.88473</td><td>1992</td><td>951</td><td>17062</td></tr>
<tr><td>93002-02-48-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54800.43516</td><td>1740</td><td>943</td><td>17063</td></tr>
<tr><td>93002-02-49-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54803.07797</td><td>1680</td><td>1077</td><td>17064</td></tr>
<tr><td>93002-02-50-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54804.38447</td><td>2856</td><td>882</td><td>17065</td></tr>
<tr><td>93002-02-51-00</td><td>93002</td><td>archived</td><td>CORCORAN</td><td>MICHAEL</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6845</td><td>54806.15838</td><td>1422</td><td>888</td><td>17066</td></tr>
<tr><td>94418-01-01-00</td><td>94418</td><td>archived</td><td>TOO</td><td>PUBLIC</td><td>ETA_CAR</td><td>161.2650</td><td>-59.6840</td><td>54899.76288</td><td>1934</td><td>1017</td><td>17067</td></tr>
</table></div></div></div>
</div>
<p>Alternatively, if you wished to place extra constraints on the search, you could use the more complex <code class="docutils literal notranslate"><span class="pre">query_tap</span></code> method
to pass a full Astronomical Data Query Language (ADQL) query. Using ADQL allows you to be much more flexible but in
many cases may not be necessary.</p>
<p>This demonstration runs the same spatial query as before but also includes a stringent exposure time requirement; you might do this to try and only
select the highest signal-to-noise observations.</p>
<p>Note that we call the <code class="docutils literal notranslate"><span class="pre">to_table</span></code> method on the result of the query to convert the result into an Astropy table, which
is the form required to pass to the <code class="docutils literal notranslate"><span class="pre">locate_data</span></code> method (see the next section).</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;SELECT * &quot;</span>
    <span class="s2">&quot;from </span><span class="si">{c}</span><span class="s2"> as cat &quot;</span>
    <span class="s2">&quot;where contains(point(&#39;ICRS&#39;,cat.ra,cat.dec), circle(&#39;ICRS&#39;,</span><span class="si">{ra}</span><span class="s2">,</span><span class="si">{dec}</span><span class="s2">,0.0033))=1 &quot;</span>
    <span class="s2">&quot;and cat.exposure &gt; 1200&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">alt_obs</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">query_tap</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="n">alt_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=30</i>
<table id="table140654987262480" class="table-striped table-bordered table-condensed">
<thead><tr><th>__row</th><th>pi_lname</th><th>pi_fname</th><th>pi_no</th><th>prnb</th><th>cycle</th><th>subject_category</th><th>target_name</th><th>time_awarded</th><th>ra</th><th>dec</th><th>priority</th><th>tar_no</th><th>obsid</th><th>time</th><th>duration</th><th>exposure</th><th>status</th><th>scheduled_date</th><th>observed_date</th><th>processed_date</th><th>archived_date</th><th>hexte_anglea</th><th>hexte_angleb</th><th>hexte_dwella</th><th>hexte_dwellb</th><th>hexte_energya</th><th>hexte_energyb</th><th>hexte_modea</th><th>hexte_modeb</th><th>pca_config1</th><th>pca_config2</th><th>pca_config3</th><th>pca_config4</th><th>pca_config5</th><th>pca_config6</th><th>lii</th><th>bii</th><th>__x_ra_dec</th><th>__y_ra_dec</th><th>__z_ra_dec</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>s</th><th>deg</th><th>deg</th><th></th><th></th><th></th><th>d</th><th>s</th><th>s</th><th></th><th>d</th><th>d</th><th>d</th><th>d</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>deg</th><th>deg</th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>object</th><th>int32</th><th>int32</th><th>int16</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>int16</th><th>int16</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>object</th><th>float64</th><th>float64</th><th>int32</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>16769</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-66-00</td><td>54836.05479</td><td>2428</td><td>1267</td><td>archived</td><td>54836.05479</td><td>54836.05479</td><td>54845</td><td>55211</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16771</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-68-00</td><td>54840.44851</td><td>2842</td><td>1335</td><td>archived</td><td>54840.44851</td><td>54840.44851</td><td>54850</td><td>55218</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16777</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-73-00</td><td>54850.24669</td><td>3308</td><td>1651</td><td>archived</td><td>54850.24669</td><td>54850.24669</td><td>54859</td><td>55225</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16789</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-84-00</td><td>54872.22313</td><td>2542</td><td>1283</td><td>archived</td><td>54872.22313</td><td>54872.22313</td><td>54880</td><td>55247</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16797</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>94002</td><td>13</td><td>STARS</td><td>ETA_CAR</td><td>1310.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>94002-01-05-00</td><td>54930.46883</td><td>1725</td><td>1313</td><td>archived</td><td>54930.46883</td><td>54930.46883</td><td>54938</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16799</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>94002</td><td>13</td><td>STARS</td><td>ETA_CAR</td><td>1210.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>94002-01-07-00</td><td>54944.20307</td><td>2695</td><td>1207</td><td>archived</td><td>54944.20307</td><td>54944.20307</td><td>54952</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16803</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-49-00</td><td>54620.98435</td><td>2615</td><td>1504</td><td>archived</td><td>54620.98435</td><td>54620.98435</td><td>54629</td><td>54994</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16804</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>94002</td><td>13</td><td>STARS</td><td>ETA_CAR</td><td>1400.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>94002-01-11-00</td><td>54971.98391</td><td>2823</td><td>1401</td><td>archived</td><td>54971.98391</td><td>54971.98391</td><td>54980</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16805</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>94002</td><td>13</td><td>STARS</td><td>ETA_CAR</td><td>1320.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>94002-01-12-00</td><td>54978.67289</td><td>2346</td><td>1320</td><td>archived</td><td>54978.67289</td><td>54978.67289</td><td>54986</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>16975</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-27-00</td><td>54468.31416</td><td>2400</td><td>1211</td><td>archived</td><td>54468.31416</td><td>54468.31416</td><td>54479</td><td>54848</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16983</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>96002</td><td>15</td><td>STARS</td><td>ETA_CAR</td><td>1550.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>96002-01-48-00</td><td>55895.6681</td><td>2769</td><td>1550</td><td>archived</td><td>55895.6681</td><td>55895.6681</td><td>55903</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16985</td><td>TOO</td><td>PUBLIC</td><td>0</td><td>96002</td><td>15</td><td>STARS</td><td>ETA_CAR</td><td>1340.0</td><td>161.2650</td><td>-59.6845</td><td>0</td><td>1</td><td>96002-01-50-00</td><td>55909.92591</td><td>1788</td><td>1339</td><td>archived</td><td>55909.92591</td><td>55909.92591</td><td>55917</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>GOODVLE1_2S</td><td>STANDARD1B</td><td>STANDARD2F</td><td>GOODVLE2_2S</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16993</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-01-00</td><td>54286.22152</td><td>2484</td><td>1316</td><td>archived</td><td>54286.22152</td><td>54286.22152</td><td>54297</td><td>54667</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>16999</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-57-00</td><td>54677.83937</td><td>1803</td><td>1234</td><td>archived</td><td>54677.83937</td><td>54677.83937</td><td>54685</td><td>55050</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>17007</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-64-00</td><td>54894.6579</td><td>2580</td><td>1386</td><td>archived</td><td>54894.6579</td><td>54894.6579</td><td>54902</td><td>55267</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>17008</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>65000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>1</td><td>93002-01-65-00</td><td>54847.22777</td><td>1680</td><td>1317</td><td>archived</td><td>54847.22777</td><td>54847.22777</td><td>54857</td><td>55225</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>17015</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-06-00</td><td>54716.71092</td><td>2739</td><td>1353</td><td>archived</td><td>54716.71092</td><td>54716.71092</td><td>54724</td><td>55092</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
<tr><td>17032</td><td>CORCORAN</td><td>MICHAEL</td><td>196</td><td>93002</td><td>12</td><td>STARS</td><td>ETA_CAR</td><td>85000.0</td><td>161.2650</td><td>-59.6845</td><td>1</td><td>2</td><td>93002-02-21-00</td><td>54746.01762</td><td>2187</td><td>1375</td><td>archived</td><td>54746.01762</td><td>54746.01762</td><td>54754</td><td>55120</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>IDLE</td><td>IDLE</td><td>287.5969</td><td>-0.6295</td><td>0.162125023877781</td><td>-0.478016026673964</td><td>-0.863259031157778</td></tr>
</table></div></div></div>
</div>
</section>
<section id="using-astroquery-to-fetch-datalinks-to-rxte-datasets">
<h3>Using Astroquery to fetch datalinks to RXTE datasets<a class="headerlink" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets" title="Link to this heading">#</a></h3>
<p>We’ve already figured out which HEASARC table to pull RXTE observation information from, and then used that table
to identify specific observations that might be relevant to our target source (Eta Car). Our next step is to pinpoint
the exact location of files from each observation that we can use to visualize the spectral emission of our source.</p>
<p>Just as in the last two steps, we’re going to make use of Astroquery. The difference is, rather than dealing with tables of
observations, we now need to construct ‘datalinks’ to places where specific files for each observation are stored. In
this demonstration we’re going to pull data from the HEASARC ‘S3 bucket’, an Amazon-hosted open-source dataset
containing all of HEASARC’s data holdings.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_links</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">locate_data</span><span class="p">(</span><span class="n">valid_obs</span><span class="p">,</span> <span class="s2">&quot;xtemaster&quot;</span><span class="p">)</span>
<span class="n">data_links</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1536</i>
<table id="table140655080305344" class="table-striped table-bordered table-condensed">
<thead><tr><th>ID</th><th>access_url</th><th>sciserver</th><th>aws</th><th>content_length</th><th>error_message</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>byte</th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>str50</th><th>str63</th><th>int64</th><th>object</th></tr></thead>
<tr><td>ivo://nasa.heasarc/xtemaster?16751</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94002/94002-01-15-00//</td><td>/FTP/xte/data/archive/AO13/P94002/94002-01-15-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16751</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94002/94002-01-15-00A//</td><td>/FTP/xte/data/archive/AO13/P94002/94002-01-15-00A/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00A/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16751</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94002/94002-01-15-00Z//</td><td>/FTP/xte/data/archive/AO13/P94002/94002-01-15-00Z/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00Z/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16751</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94002//94002-01-15-00/</td><td>/FTP/xte/data/archive/AO13/P94002/94002-01-15-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16751</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94002//94002-01/</td><td>/FTP/xte/data/archive/AO13/P94002/94002-01/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16752</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002/93002-01-17-00//</td><td>/FTP/xte/data/archive/AO12/P93002/93002-01-17-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-17-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16752</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002/93002-01-17-00A//</td><td>/FTP/xte/data/archive/AO12/P93002/93002-01-17-00A/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-17-00A/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16752</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002/93002-01-17-00Z//</td><td>/FTP/xte/data/archive/AO12/P93002/93002-01-17-00Z/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-17-00Z/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?16752</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002//93002-01-17-00/</td><td>/FTP/xte/data/archive/AO12/P93002/93002-01-17-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-17-00/</td><td>--</td><td></td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17066</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002/93002-02-51-00A//</td><td>/FTP/xte/data/archive/AO12/P93002/93002-02-51-00A/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-02-51-00A/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17066</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002/93002-02-51-00Z//</td><td>/FTP/xte/data/archive/AO12/P93002/93002-02-51-00Z/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-02-51-00Z/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17066</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002//93002-02-51-00/</td><td>/FTP/xte/data/archive/AO12/P93002/93002-02-51-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-02-51-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17066</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO12/P93002//93002-02/</td><td>/FTP/xte/data/archive/AO12/P93002/93002-02/</td><td>s3://nasa-heasarc/xte/data/archive/AO12/P93002/93002-02/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17067</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94418/94418-01-01-00//</td><td>/FTP/xte/data/archive/AO13/P94418/94418-01-01-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94418/94418-01-01-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17067</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94418/94418-01-01-00A//</td><td>/FTP/xte/data/archive/AO13/P94418/94418-01-01-00A/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94418/94418-01-01-00A/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17067</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94418/94418-01-01-00Z//</td><td>/FTP/xte/data/archive/AO13/P94418/94418-01-01-00Z/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94418/94418-01-01-00Z/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17067</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94418//94418-01-01-00/</td><td>/FTP/xte/data/archive/AO13/P94418/94418-01-01-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94418/94418-01-01-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?17067</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO13/P94418//94418-01/</td><td>/FTP/xte/data/archive/AO13/P94418/94418-01/</td><td>s3://nasa-heasarc/xte/data/archive/AO13/P94418/94418-01/</td><td>--</td><td></td></tr>
</table></div></div></div>
</div>
</section>
</section>
<section id="acquiring-the-data">
<h2>2. Acquiring the data<a class="headerlink" href="#acquiring-the-data" title="Link to this heading">#</a></h2>
<p>We now know where the relevant RXTE-PCA spectra are stored in the HEASARC S3 bucket and will proceed to download
them for local use.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><em><strong>Many workflows are being adapted to stream remote data directly into memory</strong></em> (RAM), rather than
downloading it onto disk storage, <em>then</em> reading into memory - PyXspec does not yet support this way of
operating, but our demonstrations will be updated when it does.</p>
</div>
<section id="the-easiest-way-to-download-data">
<h3>The easiest way to download data<a class="headerlink" href="#the-easiest-way-to-download-data" title="Link to this heading">#</a></h3>
<p>At this point, you may wish to simply download the entire set of files for all the observations you’ve identified.
That is easily achieved using Astroquery, with the <code class="docutils literal notranslate"><span class="pre">download_data</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code>, we just need to pass
the datalinks we found in the previous step.</p>
<p>We demonstrate this approach using the first three entries in the datalinks table, but in the following sections will
demonstrate a more complicated, but targeted, approach that will let us download only the RXTE-PCA spectra and their
supporting files:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Heasarc</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data_links</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Downloading data AWS S3 ... [astroquery.heasarc.core]
INFO: Enabling anonymous cloud data access ... [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00A/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00Z/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00A/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO13/P94002/94002-01-15-00Z/ [astroquery.heasarc.core]
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-only-rxte-pca-spectra">
<h3>Downloading only RXTE-PCA spectra<a class="headerlink" href="#downloading-only-rxte-pca-spectra" title="Link to this heading">#</a></h3>
<p>Rather than downloading all files for all our observations, we will now <em>only</em> fetch those that are directly
relevant to what we want to do in this notebook. This method is a little more involved than using Astroquery, but
it is more efficient and flexible.</p>
<p>We make use of a Python module called <code class="docutils literal notranslate"><span class="pre">s3fs</span></code>, which allows us to interact with files stored on Amazon’s S3
platform through Python commands.</p>
<p>We create an <code class="docutils literal notranslate"><span class="pre">S3FileSystem</span></code> object, which lets us interact with the S3 bucket as if it were a filesystem.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Note the <code class="docutils literal notranslate"><span class="pre">anon=True</span></code> argument, as attempting access to the HEASARC S3 bucket will fail without it!</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we identify the specific files we want to download. The datalink table tells us the AWS S3 ‘path’ (the Uniform
Resource Identifier, or URI) to each observation’s data directory, the <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/start_guide.html#directories">RXTE documentation</a>
tells us that the automatically generated data products are stored in a subdirectory called ‘stdprod’, and the
<a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes/stdprod_guide.html">RXTE Guest Observer Facility (GOF) standard product guide</a>
shows us that PCA spectra and supporting files are named as:</p>
<ul class="simple">
<li><p><strong>xp{ObsID}_s2.pha</strong> - the spectrum automatically generated for the target of the RXTE observation.</p></li>
<li><p><strong>xp{ObsID}_b2.pha</strong> - the background spectrum companion to the source spectrum.</p></li>
<li><p><strong>xp{ObsID}.rsp</strong> - the supporting file that defines the response curve (sensitivity over energy range) and redistribution matrix (a mapping of channel to energy) for the RXTE-PCA instrument during the observation.</p></li>
</ul>
<p>We set up patterns for these three files for each datalink entry, and then use the <code class="docutils literal notranslate"><span class="pre">expand_path</span></code> method of
our previously set-up S3 filesystem object to find all the files that match the pattern. This is useful because the
RXTE datalinks we found might include sections of a particular observation that do not have standard products
generated, for instance, the slewing periods before/after the telescope was aligned on target.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_file_patt</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="s2">&quot;stdprod&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">base_uri</span> <span class="ow">in</span> <span class="n">data_links</span><span class="p">[</span><span class="s2">&quot;aws&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xp*_s2.pha*&quot;</span><span class="p">,</span> <span class="s2">&quot;xp*_b2.pha*&quot;</span><span class="p">,</span> <span class="s2">&quot;xp*.rsp*&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">val_file_uris</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">all_file_patt</span><span class="p">)</span>
<span class="n">val_file_uris</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-01-00/stdprod/xp93002010100.rsp.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-01-00/stdprod/xp93002010100_b2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-01-00/stdprod/xp93002010100_s2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-02-00/stdprod/xp93002010200.rsp.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-02-00/stdprod/xp93002010200_b2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-02-00/stdprod/xp93002010200_s2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-03-00/stdprod/xp93002010300.rsp.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-03-00/stdprod/xp93002010300_b2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-03-00/stdprod/xp93002010300_s2.pha.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO12/P93002/93002-01-04-00/stdprod/xp93002010400.rsp.gz&#39;]
</pre></div>
</div>
</div>
</div>
<p>Now we can just use the <code class="docutils literal notranslate"><span class="pre">get</span></code> method of our S3 filesystem object to download all the valid spectral files!</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;rxte_pca_demo_spec&quot;</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val_file_uris</span><span class="p">,</span> <span class="n">spec_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reading-the-data-into-pyxspec">
<h2>3. Reading the data into PyXspec<a class="headerlink" href="#reading-the-data-into-pyxspec" title="Link to this heading">#</a></h2>
<p>We have acquired the spectra and their supporting files and will perform very basic visualizations and model fitting
using the Python wrapper to the ubiquitous X-ray spectral fitting code, XSPEC. To learn more advanced uses of
PyXspec, please refer to the <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/software/xspec/python/html/index.html">documentation</a>
or examine other tutorials in this repository.</p>
<p>We set the <code class="docutils literal notranslate"><span class="pre">chatter</span></code> parameter to 0 to reduce the printed text given the large number of files we are reading.</p>
<section id="configuring-pyxspec">
<h3>Configuring PyXspec<a class="headerlink" href="#configuring-pyxspec" title="Link to this heading">#</a></h3>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">chatter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Other xspec settings</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">xAxis</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">statMethod</span> <span class="o">=</span> <span class="s2">&quot;cstat&quot;</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">nIterations</span> <span class="o">=</span> <span class="mi">500</span>

<span class="c1"># Store the current working directory</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-and-fitting-the-spectra">
<h3>Reading and fitting the spectra<a class="headerlink" href="#reading-and-fitting-the-spectra" title="Link to this heading">#</a></h3>
<p>This code will read in the spectra and fit a simple power-law model with default start values (we do not necessarily
recommend this model for this type of source, nor leaving parameters set to default values). It also extracts the
spectrum data points, fitted model data points for plotting, and the fitted model parameters.</p>
<p>Note that we move into the directory where the spectra are stored. This is because the main source spectra files
have relative paths to the background and response files in their headers, and if we didn’t move into the
working directory, then PyXspec would not be able to find them.</p>
<p>The directory change is performed using a <em>context manager</em>, so that if anything goes wrong during the loading
process, we will still automatically return to the original working directory.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The spectra will be saved in a list</span>
<span class="n">spec_plot_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fit_plot_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pho_inds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">norms</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Picking out just the source spectrum files</span>
<span class="n">src_sp_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel_uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">rel_uri</span> <span class="ow">in</span> <span class="n">val_file_uris</span> <span class="k">if</span> <span class="s2">&quot;_s2&quot;</span> <span class="ow">in</span> <span class="n">rel_uri</span><span class="p">]</span>

<span class="c1"># We use a context manager to temporarily change the working directory to where</span>
<span class="c1">#  the spectra are stored</span>
<span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">spec_file_path</span><span class="p">):</span>

    <span class="c1"># Iterating through all the source spectra</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loading/fitting RXTE spectra&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">src_sp_files</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">onwards</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sp_name</span> <span class="ow">in</span> <span class="n">src_sp_files</span><span class="p">:</span>
            <span class="c1"># Clear out the previously loaded dataset and model</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="c1"># Loading in the spectrum</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">sp_name</span><span class="p">)</span>

            <span class="c1"># Set up a powerlaw and then fit to the current spectrum</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;powerlaw&quot;</span><span class="p">)</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

            <span class="c1"># Extract the parameter values</span>
            <span class="n">pho_inds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">powerlaw</span><span class="o">.</span><span class="n">PhoIndex</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">norms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">powerlaw</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

            <span class="c1"># Create an XSPEC plot (not visualized here) and then extract the</span>
            <span class="c1">#  information required to let us plot it using matplotlib</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="n">spec_plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span><span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">xErr</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">yErr</span><span class="p">()]</span>
            <span class="p">)</span>
            <span class="n">fit_plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>

            <span class="n">onwards</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pho_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pho_inds</span><span class="p">)</span>
<span class="n">norms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-spectra">
<h3>Visualizing the spectra<a class="headerlink" href="#visualizing-the-spectra" title="Link to this heading">#</a></h3>
<p>Using the data extracted in the last step, we can plot the spectra and fitted models using matplotlib.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we plot the spectra</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">xerr</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="ow">in</span> <span class="n">spec_plot_data</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Counts cm$^{-2}$ s$^{-1}$ keV$^{-1}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/c9a21283de45883f75cc28f2c7147e53493ec6de57e40fb4a8924a325596980e.png" src="../../../_images/c9a21283de45883f75cc28f2c7147e53493ec6de57e40fb4a8924a325596980e.png" />
</div>
</div>
</section>
<section id="visualizing-the-fitted-models">
<h3>Visualizing the fitted models<a class="headerlink" href="#visualizing-the-fitted-models" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">fit_ind</span><span class="p">,</span> <span class="n">fit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fit_plot_data</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec_plot_data</span><span class="p">[</span><span class="n">fit_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fit</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Counts cm$^{-2}$ s$^{-1}$ keV$^{-1}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/654e9f27705826e44d37386886090e36e37e9708f00d889e8b5b52eb35bc2a70.png" src="../../../_images/654e9f27705826e44d37386886090e36e37e9708f00d889e8b5b52eb35bc2a70.png" />
</div>
</div>
</section>
</section>
<section id="exploring-model-fit-results">
<h2>4. Exploring model fit results<a class="headerlink" href="#exploring-model-fit-results" title="Link to this heading">#</a></h2>
<p>As we have fit models to all these spectra and retrieved the parameter’s values, we should take a look at them!</p>
<p>Exactly what you do at this point will depend entirely upon your science case and the type of object you’ve been
analyzing. However, any analysis will benefit from an initial examination of the fitted parameter values (particularly if
you have fit hundreds of spectra, as we have).</p>
<section id="fitted-model-parameter-distributions">
<h3>Fitted model parameter distributions<a class="headerlink" href="#fitted-model-parameter-distributions" title="Link to this heading">#</a></h3>
<p>This shows us what the distributions of the ‘Photon Index’ (related to the power-law slope) and the
model normalization look like. We can see that the distributions are not particularly symmetric and Gaussian-looking.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax_inds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ax_arr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pho_inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;stepfilled&quot;</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Photon Index&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">norms</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;Normalization [photons keV$^{-1}$ cm$^{-2}$ s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/77818bfb279f7fca8c6cb21a093368c255c1c7deb21cd7d8751fa3069a2d2ee7.png" src="../../../_images/77818bfb279f7fca8c6cb21a093368c255c1c7deb21cd7d8751fa3069a2d2ee7.png" />
</div>
</div>
</section>
<section id="do-model-parameters-vary-with-time">
<h3>Do model parameters vary with time?<a class="headerlink" href="#do-model-parameters-vary-with-time" title="Link to this heading">#</a></h3>
<p>That might then make us wonder if the reason we’re seeing these non-Gaussian distributions is due to Eta Car’s
X-ray emission varying with time over the course of RXTE’s campaign? Some kinds of X-ray sources are extremely
variable, and we know that Eta Car’s X-ray emission is variable in other wavelengths.</p>
<p>As a quick check, we can retrieve the start time of each RXTE observation from the source spectra and then plot
the model parameter values against the time of their observation. In this case, we extract the modified Julian
date (MJD) reference time, the time system, and the start time (which is currently relative to the reference time).
Combining this information lets us convert the start time into a datetime object.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_start</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">loc_sp</span> <span class="ow">in</span> <span class="n">src_sp_files</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spec_file_path</span><span class="p">,</span> <span class="n">loc_sp</span><span class="p">))</span> <span class="k">as</span> <span class="n">speco</span><span class="p">:</span>
        <span class="n">cur_ref</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span>
            <span class="n">speco</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;MJDREFI&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">speco</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;MJDREFF&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span>
        <span class="p">)</span>
        <span class="n">cur_tstart</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">speco</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;TSTART&quot;</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">start_dt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cur_ref</span>
            <span class="o">+</span> <span class="n">TimeDelta</span><span class="p">(</span>
                <span class="n">cur_tstart</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;sec&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">speco</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;TIMESYS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span>
        <span class="n">obs_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we actually plot the Photon Index and Normalization values against the start times, and we can see an extremely
strong indication of time varying X-ray emission from Eta Car:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax_inds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ax_arr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">obs_start</span><span class="p">,</span>
    <span class="n">pho_inds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">pho_inds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Photon Index&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">obs_start</span><span class="p">,</span>
    <span class="n">norms</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">norms</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Norm [ph keV$^{-1}$ cm$^{-2}$ s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/589fbca8fff009d538cad7de2772f76461f257e8ebc924e8fa6dd2cac36f45be.png" src="../../../_images/589fbca8fff009d538cad7de2772f76461f257e8ebc924e8fa6dd2cac36f45be.png" />
</div>
</div>
</section>
</section>
<section id="applying-simple-unsupervised-machine-learning-to-the-spectra">
<h2>5. Applying simple unsupervised machine learning to the spectra<a class="headerlink" href="#applying-simple-unsupervised-machine-learning-to-the-spectra" title="Link to this heading">#</a></h2>
<p>From our previous analysis, fitting a simple power-law model to the spectra and plotting the parameters against
the time of their observation, we can see that some quite interesting spectral changes occur over the course of
RXTE’s survey visits to Eta Car.</p>
<p>We might now want to know whether we can identify those same behaviors in a model independent way, to ensure that
it isn’t just a strange emergent property of spectral model choice.</p>
<p>Additionally, if the spectral changes we observed through the fitted model parameters <strong>are</strong> representative of real
behavior, then are we seeing a single transient event where the emission returns to ‘normal’ after the most
significant changes, or is it entering a new ‘phase’ of its emission life cycle?</p>
<p>We are going to use some very simple machine learning techniques to explore these questions by:</p>
<ul class="simple">
<li><p>Reducing the spectra (with around one hundred energy bins and corresponding spectral values) to two dimensions.</p></li>
<li><p>Using a clustering technique to group similar spectra together.</p></li>
<li><p>Examining which spectra have been found to be the most similar.</p></li>
</ul>
<section id="preparing">
<h3>Preparing<a class="headerlink" href="#preparing" title="Link to this heading">#</a></h3>
<p>Simply shoving the RXTE spectra that we already loaded in through some machine learning techniques is not likely to
produce useful results.</p>
<p>Machine learning techniques that reduce dataset dimensionality often benefit from re-scaling the datasets so that all
features (the spectral value for a particular energy bin, in this case) exist within the same general
range (-1 to 1, for example). This is because the distance between points is often used as some form of metric in
these techniques, and we wish to give every feature the same weight in those calculations.</p>
<p>It will hopefully mean that, for instance, the overall normalization isn’t the one dominant factor
in grouping the spectra together, and instead other features (particularly the shape of a spectrum) will be
given weight as well.</p>
<section id="interpolating-the-spectra-onto-a-common-energy-grid">
<h4>Interpolating the spectra onto a common energy grid<a class="headerlink" href="#interpolating-the-spectra-onto-a-common-energy-grid" title="Link to this heading">#</a></h4>
<p>Our first step is to place all the spectra onto a common energy grid. Due to changing calibration and instrument
response, we cannot guarantee that the energy bins of all our spectra are identical.</p>
<p>Looking at the first few energy bins of two different spectra, as an example:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">spec_plot_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spec_plot_data</span><span class="p">[</span><span class="mi">40</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.0708092413842678, 2.2686474323272705, 2.669748067855835, 3.0714478492736816, 3.473743438720703]
[1.0690011642873287, 2.2649662494659424, 2.6654340028762817, 3.0664981603622437, 3.4681555032730103]
</pre></div>
</div>
</div>
</div>
<p>The quickest and easiest way to deal with this is to define a common energy grid and then interpolate all of our
spectra onto it.</p>
<p>We choose to begin the grid at 2 keV to avoid low-resolution noise at lower energies, a limitation of RXTE-PCA data, and
to stop it at 12 keV due to a noticeable lack of emission from Eta Car above that energy. The grid will have a
resolution of 0.1 keV.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining the specified energy grid</span>
<span class="n">interp_en_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Iterate through all loaded RXTE-PCA spectra</span>
<span class="n">interp_spec_vals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">spec_info</span> <span class="ow">in</span> <span class="n">spec_plot_data</span><span class="p">:</span>
    <span class="c1"># This runs the interpolation, using the values we extracted from PyXspec earlier.</span>
    <span class="c1">#  spec_info[0] are the energy values, and spec_info[2] the spectral values</span>
    <span class="n">interp_spec_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">interp_en_vals</span><span class="p">,</span> <span class="n">spec_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">spec_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<span class="c1"># Make the interpolated spectra into a numpy array</span>
<span class="n">interp_spec_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interp_spec_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="scaling-and-normalizing-the-spectra">
<h4>Scaling and normalizing the spectra<a class="headerlink" href="#scaling-and-normalizing-the-spectra" title="Link to this heading">#</a></h4>
<p>As we’ve already mentioned, the machine learning techniques we’re going to use will work best if the input data
are scaled. This <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> class will move the mean of each feature (spectral value in an energy bin) to zero
and scale it unit variance.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaled_interp_spec_vals</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">interp_spec_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examining-the-scaled-and-normalized-spectra">
<h4>Examining the scaled and normalized spectra<a class="headerlink" href="#examining-the-scaled-and-normalized-spectra" title="Link to this heading">#</a></h4>
<p>To demonstrate the changes we’ve made to our dataset, we’ll visualize both the interpolated and the scaled-interpolated spectra:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax_inds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ax_arr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interp_en_vals</span><span class="p">,</span> <span class="n">interp_spec_vals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Spectrum [ct cm$^{-2}$ s$^{-1}$ keV$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Now for the scaled interpolated spectra</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interp_en_vals</span><span class="p">,</span> <span class="n">scaled_interp_spec_vals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Scaled Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/0c516babf93c52f7e4e736b0807d2f992d0dc0515faebc2a748c61153c34b731.png" src="../../../_images/0c516babf93c52f7e4e736b0807d2f992d0dc0515faebc2a748c61153c34b731.png" />
</div>
</div>
</section>
</section>
<section id="reducing-the-dimensionality-of-the-scaled-spectral-dataset">
<h3>Reducing the dimensionality of the scaled spectral dataset<a class="headerlink" href="#reducing-the-dimensionality-of-the-scaled-spectral-dataset" title="Link to this heading">#</a></h3>
<p>At this point, we <em>could</em> try to find similar spectra by applying a clustering technique directly to the scaled
dataset we just created. However, it has been well demonstrated that finding similar data points (clustering them
together, in other words) is very difficult in high-dimensional data.</p>
<p>This is a result of something called “the curse of dimensionality”
(<a class="reference external" href="https://towardsdatascience.com/curse-of-dimensionality-a-curse-to-machine-learning-c122ee33bfeb/">see, Karanam, Shashmi; 2021, for an overview</a>), a common problem in machine learning and data science.</p>
<p>One of the ways to combat this issue is to try and reduce the dimensionality of the dataset. The hope is that the
data point that represents a spectrum (in N dimensions, where N is the number of energy bins in our interpolated
spectrum) can be projected/reduced to a much smaller number of dimensions without losing the information that will
help us group the different spectra.</p>
<p>We’re going to try three common dimensionality reduction techniques:</p>
<ul class="simple">
<li><p>Principal Component Analysis (PCA)</p></li>
<li><p>T-distributed Stochastic Neighbor Embedding (t-SNE)</p></li>
<li><p>Uniform Manifold Approximation and Projection (UMAP)</p></li>
</ul>
<p>An article by <a class="reference external" href="https://medium.com/&#64;aastha.code/dimensionality-reduction-pca-t-sne-and-umap-41d499da2df2">Varma, Aastha (2024)</a> provides
simple summaries of these three techniques and when they can be used. We encourage you to identify resources that
explain whatever dimensionality reduction technique you may end up using, as it is all too easy to treat these
techniques as black boxes.</p>
<section id="principal-component-analysis-pca">
<h4>Principal Component Analysis (PCA)<a class="headerlink" href="#principal-component-analysis-pca" title="Link to this heading">#</a></h4>
<p>PCA is arguably the simplest of the dimensionality reduction techniques that we’re trying out in this
demonstration. The technique works by projecting the high-dimensionality data into a lower-dimension parameter
space (two dimensions, in this case) whilst maximizing the variance of the projected data.</p>
<p>PCA is best suited to linearly separable data, but isn’t particularly suitable for non-linear relationships.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">scaled_specs_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_interp_spec_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="t-distributed-stochastic-neighbor-embedding-t-sne">
<h4>T-distributed Stochastic Neighbor Embedding (t-SNE)<a class="headerlink" href="#t-distributed-stochastic-neighbor-embedding-t-sne" title="Link to this heading">#</a></h4>
<p>Unlike PCA, t-SNE <strong>is</strong> suited to non-linearly separable data, though it is also much more computationally
expensive. This technique works by comparing two distributions:</p>
<ul class="simple">
<li><p>Pairwise similarities (defined by some distance metric) of the data points in the original high-dimensional data.</p></li>
<li><p>The equivalent similarities but in the projected two-dimensional space.</p></li>
</ul>
<p>The goal is to minimize the divergence between the two distributions and effectively try to represent the
same spacings between data points in N-dimensions in a two-dimensional space.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scaled_specs_tsne</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_interp_spec_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="uniform-manifold-approximation-and-projection-umap">
<h4>Uniform Manifold Approximation and Projection (UMAP)<a class="headerlink" href="#uniform-manifold-approximation-and-projection-umap" title="Link to this heading">#</a></h4>
<p>Finally, the UMAP technique is also well suited to non-linearly separable data. It also does well at preserving
and representing local and global structures from the original N-dimensional data in the output
two-dimensional (in our case) space.</p>
<p>UMAP in particular is mathematically complex (compared to the other two techniques
we’re using) - a full explanation <a class="reference external" href="https://umap-learn.readthedocs.io/en/latest/how_umap_works.html">by the UMAP Contributors</a> is included in the documentation.</p>
<p>The original paper describing UMAP (<a class="reference external" href="https://ui.adsabs.harvard.edu/link_gateway/2018arXiv180203426M/doi:10.48550/arXiv.1802.03426">McInnes et al. 2018</a>) may also be useful.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">um</span> <span class="o">=</span> <span class="n">UMAP</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scaled_specs_umap</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_interp_spec_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-the-results-of-the-different-dimensionality-reduction-methods">
<h4>Comparing the results of the different dimensionality reduction methods<a class="headerlink" href="#comparing-the-results-of-the-different-dimensionality-reduction-methods" title="Link to this heading">#</a></h4>
<p>In each case, we reduced the scaled spectral dataset to two dimensions, so it is easy to visualize how each
technique has behaved. We’re going to visually assess the separability of data point groups (we are starting with the
assumption that there <em>will</em> be some distinct groupings of spectra).</p>
<p>Just from a quick look, it is fairly obvious that UMAP has done the best job of forming distinct, separable, groupings
of spectra. <strong>That doesn’t necessarily mean that those spectra are somehow physically linked</strong>, but it does seem like
it will be the best dataset to run our clustering algorithm on.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax_inds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ax_arr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># PCA plot</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">scaled_specs_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">scaled_specs_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PCA&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># t-SNE plot</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">scaled_specs_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">scaled_specs_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:cyan&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t-SNE&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># UMAP plot</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">scaled_specs_umap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">scaled_specs_umap</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;goldenrod&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;UMAP&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># Make the fourth subplot invisible</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparison of dimensionality reduction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/63e3552d47c6f592215e8d5667f2ff6d9870c757f16b6cffe9742b4690535452.png" src="../../../_images/63e3552d47c6f592215e8d5667f2ff6d9870c757f16b6cffe9742b4690535452.png" />
</div>
</div>
</section>
</section>
<section id="automated-clustering-of-like-spectra-with-density-based-spatial-clustering-of-applications-with-noise-dbscan">
<h3>Automated clustering of like spectra with Density-Based Spatial Clustering of Applications with Noise (DBSCAN)<a class="headerlink" href="#automated-clustering-of-like-spectra-with-density-based-spatial-clustering-of-applications-with-noise-dbscan" title="Link to this heading">#</a></h3>
<p>There are a litany of clustering algorithms implemented in scikit-learn, all with different characteristics,
strengths, and weaknesses. The scikit-learn website provides an interesting comparison
(<a class="reference external" href="https://scikit-learn.org/stable/auto_examples/cluster/plot_cluster_comparison.html">Scikit-learn Contributors</a>) of
their performance on different toy datasets, which gives an idea of what sorts of features can be separated
with each approach.</p>
<p>Some algorithms require that you specify the number of clusters you want to find, which is not particularly easy to do
while doing this sort of exploratory data analysis. As such, we’re going to use ‘DBSCAN’, which identifies dense
cores of data points and expands clusters from them. You should read about a variety of clustering techniques and
how they work before deciding on one to use for your own scientific work.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dbs</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">dbs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_specs_umap</span><span class="p">)</span>

<span class="c1"># The labels of the point clusters</span>
<span class="n">clust_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span>
<span class="n">clust_labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 2, 3, 4, 5, 6])
</pre></div>
</div>
</div>
</div>
<p>We will once again visualize the UMAP-reduced spectral dataset, but this time we’ll color each data point by the
cluster that DBSCAN says it belongs to. That will give us a good idea of how well the algorithm has performed:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">clust_id</span> <span class="ow">in</span> <span class="n">clust_labels</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">scaled_specs_umap</span><span class="p">[</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">clust_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">scaled_specs_umap</span><span class="p">[</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">clust_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">clust_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DBSCAN clustered UMAP-reduced spectra&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/eed111a34d4593c66407d1a8d0f76e4e0b116b5089627d0dc5e0219ac60bd093.png" src="../../../_images/eed111a34d4593c66407d1a8d0f76e4e0b116b5089627d0dc5e0219ac60bd093.png" />
</div>
</div>
</section>
<section id="exploring-the-results-of-spectral-clustering">
<h3>Exploring the results of spectral clustering<a class="headerlink" href="#exploring-the-results-of-spectral-clustering" title="Link to this heading">#</a></h3>
<p>Now that we think we’ve identified distinct groupings of spectra that are similar (in the two-dimensional space
produced by UMAP at least), we can look to see whether they look distinctly different in their original
high-dimensional parameter space!</p>
<p>Here we examine both unscaled and scaled versions of the interpolated spectra, but rather than coloring every
individual spectrum by the cluster that it belongs to, we instead plot the mean spectrum of each cluster.</p>
<p>This approach makes it much easier to interpret the figures, and we can see straight away that most of the
mean spectra of the clusters are quite distinct from one another:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax_inds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">ax_arr</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">clust_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">mean_spec</span> <span class="o">=</span> <span class="n">interp_spec_vals</span><span class="p">[</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">clust_id</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interp_en_vals</span><span class="p">,</span> <span class="n">mean_spec</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">clust_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Spectrum [ct cm$^{-2}$ s$^{-1}$ keV$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="k">for</span> <span class="n">clust_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">mean_scaled_spec</span> <span class="o">=</span> <span class="n">scaled_interp_spec_vals</span><span class="p">[</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">clust_id</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interp_en_vals</span><span class="p">,</span> <span class="n">mean_scaled_spec</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">clust_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Scaled Spectrum&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/d0085c1af30100968744c1828571d9fd6baf31bf1b287dae08d938951afedd8d.png" src="../../../_images/d0085c1af30100968744c1828571d9fd6baf31bf1b287dae08d938951afedd8d.png" />
</div>
</div>
<p>Having done all of this, we can return to the original goal of this section and look to see whether the significant
time-dependent behaviors of our fitted model parameters are also identified through this model-independent
approach. Additionally, if they are identified this way, are the spectra before and after the most significant changes
different, or did the emission return to ‘normal’ after the disruption?</p>
<p>We plot the same figure of power-law photon index versus time that we did earlier, but now we can color the data
points by which point cluster their spectrum is associated with.</p>
<p>From this plot it seems like the significant fluctuations of photon index with time <strong>are not an emergent property
of our model choice</strong>, and instead represent real differences in the RXTE-PCA spectra of Eta Car at different
observation times!</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">marker_cycler</span> <span class="o">=</span> <span class="n">cycler</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span>
<span class="n">default_color_cycler</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span>
<span class="n">new_cycler</span> <span class="o">=</span> <span class="n">marker_cycler</span> <span class="o">+</span> <span class="n">default_color_cycler</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_prop_cycle</span><span class="p">(</span><span class="n">new_cycler</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">clust_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">cur_mask</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">clust_id</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_start</span><span class="p">)[</span><span class="n">cur_mask</span><span class="p">],</span>
        <span class="n">pho_inds</span><span class="p">[</span><span class="n">cur_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">pho_inds</span><span class="p">[</span><span class="n">cur_mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cluster </span><span class="si">{</span><span class="n">clust_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Photon Index&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/b7118dd4fe462b20319be653eec31e383d6fd54488d265953907544f599cf0b9.png" src="../../../_images/b7118dd4fe462b20319be653eec31e383d6fd54488d265953907544f599cf0b9.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this notebook<a class="headerlink" href="#about-this-notebook" title="Link to this heading">#</a></h2>
<p>Author: Tess Jaffe, HEASARC Chief Archive Scientist.</p>
<p>Author: David J Turner, HEASARC Staff Scientist.</p>
<p>Updated On: 2026-01-19</p>
<section id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Link to this heading">#</a></h3>
<p>Support: <a class="reference external" href="https://heasarc.gsfc.nasa.gov/cgi-bin/Feedback?selected=xte">HEASARC RXTE Helpdesk</a></p>
<p>Documents:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/abc/front_page.html">RXTE ABC Guide</a></p></li>
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes/stdprod_guide.html">Description of standard RXTE data products</a></p></li>
</ul>
</section>
<section id="acknowledgements">
<h3>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h3>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://towardsdatascience.com/curse-of-dimensionality-a-curse-to-machine-learning-c122ee33bfeb/">Karanam, Shashmi (2021) - ‘Curse of Dimensionality; A “Curse” to Machine Learning’ [ACCESSED 19-JAN-2026]</a></p>
<p><a class="reference external" href="https://medium.com/&#64;aastha.code/dimensionality-reduction-pca-t-sne-and-umap-41d499da2df2">Varma, Aastha (2024) - ‘Dimensionality Reduction: PCA, t-SNE, and UMAP’ [ACCESSED 19-JAN-2026]</a></p>
<p><a class="reference external" href="https://umap-learn.readthedocs.io/en/latest/how_umap_works.html">UMAP Contributors - ‘How UMAP Works’ [ACCESSED 19-JAN-2026]</a></p>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/link_gateway/2018arXiv180203426M/doi:10.48550/arXiv.1802.03426">McInnes et al. (2018) - ‘UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction’</a></p>
<p><a class="reference external" href="https://scikit-learn.org/stable/auto_examples/cluster/plot_cluster_comparison.html">Scikit-learn Contributors - Comparing different clustering algorithms on toy datasets [ACCESSED 19-JAN-2026]</a></p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="rxte_index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">RXTE</p>
      </div>
    </a>
    <a class="right-next"
       href="analyze-rxte-lightcurves.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Using archived and newly generated RXTE light curves</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-environments">Imports &amp; Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-data">1. Finding the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-find-the-heasarc-table-that-lists-all-of-rxtes-observations">Using Astroquery to find the HEASARC table that lists all of RXTE’s observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-rxte-observations-of-eta-car">Identifying RXTE observations of Eta Car</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets">Using Astroquery to fetch datalinks to RXTE datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-the-data">2. Acquiring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-easiest-way-to-download-data">The easiest way to download data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-only-rxte-pca-spectra">Downloading only RXTE-PCA spectra</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data-into-pyxspec">3. Reading the data into PyXspec</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-pyxspec">Configuring PyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-fitting-the-spectra">Reading and fitting the spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-spectra">Visualizing the spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-fitted-models">Visualizing the fitted models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-model-fit-results">4. Exploring model fit results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitted-model-parameter-distributions">Fitted model parameter distributions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-model-parameters-vary-with-time">Do model parameters vary with time?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-simple-unsupervised-machine-learning-to-the-spectra">5. Applying simple unsupervised machine learning to the spectra</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing">Preparing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpolating-the-spectra-onto-a-common-energy-grid">Interpolating the spectra onto a common energy grid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scaling-and-normalizing-the-spectra">Scaling and normalizing the spectra</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-scaled-and-normalized-spectra">Examining the scaled and normalized spectra</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducing-the-dimensionality-of-the-scaled-spectral-dataset">Reducing the dimensionality of the scaled spectral dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#principal-component-analysis-pca">Principal Component Analysis (PCA)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#t-distributed-stochastic-neighbor-embedding-t-sne">T-distributed Stochastic Neighbor Embedding (t-SNE)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#uniform-manifold-approximation-and-projection-umap">Uniform Manifold Approximation and Projection (UMAP)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-the-results-of-the-different-dimensionality-reduction-methods">Comparing the results of the different dimensionality reduction methods</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-clustering-of-like-spectra-with-density-based-spatial-clustering-of-applications-with-noise-dbscan">Automated clustering of like spectra with Density-Based Spatial Clustering of Applications with Noise (DBSCAN)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-results-of-spectral-clustering">Exploring the results of spectral clustering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By HEASARC developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026, HEASARC developers.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>