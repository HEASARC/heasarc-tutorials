
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using archived and newly generated RXTE light curves &#8212; HEASARC Tutorial Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=79d33dc3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-R7YGYK7HYQ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-R7YGYK7HYQ');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/mission_specific_analyses/rxte/analyze-rxte-lightcurves';</script>
    <script src="../../../_static/internal_screen.js?v=3df308be"></script>
    <link rel="icon" href="../../../_static/heasarc_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="NICER" href="../nicer/nicer_index.html" />
    <link rel="prev" title="Exploring RXTE spectral observations of Eta Car" href="analyze-rxte-spectra.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p class='beta-banner'>The HEASARC tutorials resource is in <strong>BETA</strong> and may be subject to significant changes.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/heasarc_logo.png" class="logo__image only-light" alt="High Energy Astrophysics Science Archive Research Center - Home"/>
    <script>document.write(`<img src="../../../_static/heasarc_logo.png" class="logo__image only-dark" alt="High Energy Astrophysics Science Archive Research Center - Home"/>`);</script>
  
  
    <p class="title logo__title">v0.1</p>
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/HEASARC/heasarc-tutorials" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../about/about_index.html">About</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about/authors.html">Contributors</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developing skills with HEASARC services</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../heasarc_service_skills/sciserver-data-find-download.html">Using PyVO to find and acquire HEASARC data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mission specific tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../nustar/nustar_index.html">NuSTAR</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nustar/data-analysis-nustar.html">Analysing a single NuSTAR observation</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="rxte_index.html">RXTE</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="analyze-rxte-spectra.html">Exploring RXTE spectral observations of Eta Car</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Using archived and newly generated RXTE light curves</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nicer/nicer_index.html">NICER</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nicer/data-analysis-nicer.html">Getting started with NICER data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ixpe/ixpe_index.html">IXPE</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ixpe/data-analysis-ixpe.html">Getting started with preprocessed IXPE data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../swift/swift_index.html">Swift</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../swift/getting-started-swift-xrt.html">Getting started with Swift-XRT</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful high-energy tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy_index.html">HEASoftPy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy-getting-started.html">Getting started with HEASoftPy</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas_index.html">pySAS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas-short-intro.html">Short introduction to pySAS</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/edit/main/tutorials/mission_specific_analyses/rxte/analyze-rxte-lightcurves.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/issues/new?title=Issue%20on%20page%20%2Ftutorials/mission_specific_analyses/rxte/analyze-rxte-lightcurves.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/tutorials/mission_specific_analyses/rxte/analyze-rxte-lightcurves.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using archived and newly generated RXTE light curves</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-environments">Imports &amp; Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-data">1. Finding the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-find-the-rxte-observation-summary-master-table">Using Astroquery to find the RXTE observation summary (master) table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-rxte-observations-of-igr-j174802446-t5x2">Identifying RXTE observations of IGR J17480–2446/T5X2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-an-adql-query-advanced-alternative">Constructing an ADQL query [<strong>advanced alternative</strong>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets">Using Astroquery to fetch datalinks to RXTE datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-the-data">2. Acquiring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-easiest-way-to-download-data">The easiest way to download data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-only-the-archived-rxte-light-curves">Downloading only the archived RXTE light curves</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-archived-rxte-light-curves">3. Examining the archived RXTE light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collecting-like-light-curves-together">Collecting like light curves together</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-light-curve-files-into-python">Loading the light curve files into Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-long-term-variability">Examining long-term variability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interacting-with-aggregate-light-curves">Interacting with aggregate light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#which-observations-contributed-data">Which observations contributed data?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-constituent-light-curves">Retrieving constituent light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-all-data">Accessing all data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-data-for-a-specific-time-interval">Accessing data for a specific time interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-aggregated-light-curves">Visualizing aggregated light curves</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-new-rxte-pca-light-curves">4. Generating new RXTE-PCA light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-specific-files-for-our-rxte-observations">Downloading specific files for our RXTE observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-rxte-pca-preparation-pipeline">Running the RXTE-PCA preparation pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-rxte-pca-good-time-interval-gti-files">Setting up RXTE-PCA good time interval (GTI) files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-light-curves-within-custom-energy-bounds">New light curves within custom energy bounds</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#building-rxte-pca-response-files">Building RXTE-PCA response files</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-light-curves">Generating the light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-light-curves-into-python">Loading the light curves into Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-new-custom-energy-band-light-curves">Visualizing new custom-energy-band light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-and-examining-hardness-ratio-curves">Calculating and examining hardness ratio curves</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-light-curves-with-high-temporal-resolution">New light curves with high temporal resolution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-new-light-curves">Generating new light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Loading the light curves into Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-new-higher-time-resolution-light-curves">Visualizing new higher time-resolution light curves</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experimenting-with-an-automated-method-to-identify-bursts">5. Experimenting with an automated method to identify bursts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-transform-peak-finding">Wavelet transform peak finding</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-on-a-single-light-curve">Testing on a single light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-peak-times-identified-for-the-single-light-curve">Visualizing peak times identified for the single light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-wavelet-transform-peak-finding-to-the-whole-aggregated-light-curve">Applying wavelet transform peak finding to the whole aggregated light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#storing-peak-information-in-a-pandas-dataframe">Storing peak information in a Pandas DataFrame</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-t5x2-properties-at-potential-burst-times">Exploring T5X2 properties at potential burst times</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#count-rates-at-potential-burst-times">Count rates at potential burst times</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hardness-ratios-at-potential-burst-times">Hardness ratios at potential burst times</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-light-curves-of-potential-bursts-with-hardness-information">Visualizing light curves of potential bursts with hardness information</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#number-and-frequency-of-potential-bursts">Number and frequency of potential bursts</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-peaks-did-we-find-in-each-time-chunk">How many peaks did we find in each time chunk?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-frequency-of-bursts">Calculating the frequency of bursts</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#does-the-frequency-of-peak-identification-evolve-with-time">Does the frequency of peak identification evolve with time?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#does-the-hardness-ratio-of-potential-bursts-evolve-with-time">Does the hardness ratio of potential bursts evolve with time?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-archived-and-newly-generated-rxte-light-curves">
<h1>Using archived and newly generated RXTE light curves<a class="headerlink" href="#using-archived-and-newly-generated-rxte-light-curves" title="Link to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Know how to find and use observation tables hosted by HEASARC.</p></li>
<li><p>Be able to search for RXTE observations of a named source.</p></li>
<li><p>Understand how to access RXTE light curves stored in the HEASARC AWS S3 bucket.</p></li>
<li><p>Be capable of downloading and visualizing retrieved light curves.</p></li>
<li><p>Know how to generate new RXTE-PCA light curves with:</p>
<ul>
<li><p>Custom energy bounds.</p></li>
<li><p>Higher temporal resolution than archived products.</p></li>
</ul>
</li>
<li><p>Use ‘Continuous Wavelet Transform’ (CWT) peak finding to identify possible bursts.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook is intended to demonstrate how you can use Rossi Timing X-ray Explorer (<a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/rxte.html">RXTE</a>) data to examine
the temporal variation of a source’s X-ray emission across a wide energy range. We start by identifying and
exploring archived RXTE light curves for our source of interest and move on to generating <strong>new</strong> light curves
from raw RXTE Proportional Counter Array (PCA) data.</p>
<p>RXTE was a high-energy mission that provided very high temporal resolution, moderate spectral resolution,
observations across a wide energy band (~2–250 keV).</p>
<p>The satellite hosted three instruments:</p>
<ul class="simple">
<li><p><strong>PCA</strong> - <em>Proportional Counter Array</em>; a set of five co-aligned proportional counter units (PCU), sensitive in the 2–60 keV energy band. Collimated ~1 degree full-width half-maximum (FWHM) field-of-view (FoV).</p></li>
<li><p><strong>HEXTE</strong> - <em>High-Energy X-ray Timing Experiment</em>; a pair of scintillation-counter clusters, sensitive in the 15–250 keV energy band. Collimated ~1 degree FWHM FoV.</p></li>
<li><p><strong>ASM</strong> - <em>All Sky Monitor</em>; a set of three coded-mask instruments that covered a significant fraction of the sky with each observation (each camera had a 6 x 90 degree FoV). Sensitive in the 2–12 keV energy band.</p></li>
</ul>
<p>The <strong>PCA</strong> and <strong>HEXTE</strong> instruments had maximum temporal resolutions of <span class="math notranslate nohighlight">\(1 \mu \rm{s}\)</span> and <span class="math notranslate nohighlight">\(8 \mu \rm{s}\)</span> respectively.</p>
<p>Our demonstration is only going to use data from the PCA and HEXTE instruments, and we will only generate new light curves from the PCA instrument.</p>
<p>Though neither PCA nor HEXTE had any imaging capability (they collected photons from their whole FoV without any further spatial information), their time resolution was such that they were very well suited to observations of pulsars; rotating neutron stars with high-energy emission that can vary on the millisecond scale.</p>
<p>We’re going to use a particularly notable pulsar in a low-mass X-ray binary (LMXB) system discovered using RXTE as the subject of our demonstration, ‘<strong>IGR J17480–2446</strong>’ or ‘<strong>T5X2</strong>’.</p>
<p>Though it actually rotates quite slowly for a pulsar (“only” ~11 times per second), it displays a number of very interesting behaviors; these include ‘bursts’ of emission caused by infalling gas from its binary companion, and X-ray emission caused by sustained thermonuclear reactions from a large build-up of material possible because of the high accretion rate from its companion.</p>
<p>This behavior had been predicted and modeled, but the first real example was identified in RXTE observations of T5X2, see <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a> for full analysis and results.</p>
<section id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The name of the source we’ve chosen for the demonstration; <strong>IGR J17480–2446</strong> or <strong>T5X2</strong>.</p></li>
</ul>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Visualizations of archived RXTE-PCA and HEXTE light curves.</p></li>
<li><p>Newly generated RXTE-PCA light curves within a custom energy band.</p></li>
<li><p>Newly generated RXTE-PCA light curves with a higher time resolution than the archived data products.</p></li>
</ul>
</section>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading">#</a></h3>
<p>As of 21st January 2026, this notebook takes ~25 minutes to run to completion on Fornax, using the ‘small’ server with 8GB RAM / 2 cores.</p>
</section>
</section>
<section id="imports-environments">
<h2>Imports &amp; Environments<a class="headerlink" href="#imports-environments" title="Link to this heading">#</a></h2>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">heasoftpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">unique</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.heasarc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Heasarc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FuncFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">s3fs</span><span class="w"> </span><span class="kn">import</span> <span class="n">S3FileSystem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_peaks_cwt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xga.products</span><span class="w"> </span><span class="kn">import</span> <span class="n">AggregateLightCurve</span><span class="p">,</span> <span class="n">LightCurve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/heasoft/lib/python3.12/site-packages/xga/utils.py:39: DeprecationWarning: The XGA &#39;find_all_wcs&#39; function should be imported from imagetools.misc, in the future it will be removed from utils.
  warn(message, DeprecationWarning)
/opt/envs/heasoft/lib/python3.12/site-packages/xga/utils.py:619: UserWarning: SAS_DIR environment variable is not set, unable to verify SAS is present on system, as such all functions in xga.sas will not work.
  warn(&quot;SAS_DIR environment variable is not set, unable to verify SAS is present on system, as such &quot;
/opt/envs/heasoft/lib/python3.12/site-packages/xga/__init__.py:6: UserWarning: This is the first time you&#39;ve used XGA; to use most functionality you will need to configure /home/jovyan/.config/xga/xga.cfg to match your setup, though you can use product classes regardless.
  from .utils import xga_conf, CENSUS, OUTPUT, NUM_CORES, XGA_EXTRACT, BASE_XSPEC_SCRIPT, CROSS_ARF_XSPEC_SCRIPT, \
/opt/envs/heasoft/lib/python3.12/site-packages/xga/products/relation.py:12: DeprecationWarning: `scipy.odr` is deprecated as of version 1.17.0 and will be removed in SciPy 1.19.0. Please use `https://pypi.org/project/odrpack/` instead.
  import scipy.odr as odr
/opt/envs/heasoft/lib/python3.12/site-packages/xga/products/relation.py:12: DeprecationWarning: `scipy.odr` is deprecated as of version 1.17.0 and will be removed in SciPy 1.19.0. Please use `https://pypi.org/project/odrpack/` instead.
  import scipy.odr as odr
</pre></div>
</div>
</div>
</div>
</section>
<section id="global-setup">
<h2>Global Setup<a class="headerlink" href="#global-setup" title="Link to this heading">#</a></h2>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rxte_lc_inst_band_obs</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple function to extract the RXTE instrument, energy band, and ObsID from a</span>
<span class="sd">    light curve file with a name that follows the RXTE standards.</span>

<span class="sd">    :param str path: The path to the file, either a relative/absolute path or just</span>
<span class="sd">        the file name will be accepted.</span>
<span class="sd">    :return: The instrument name, the energy band, and the ObsID</span>
<span class="sd">    :rtype: Tuple[str, Quantity, str]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure that we just have the file name, and not any full-path</span>
    <span class="c1">#  directory information</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># First check, is this file from PCA or one of the HEXTE clusters?</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;xp&quot;</span><span class="p">:</span>
        <span class="n">file_inst</span> <span class="o">=</span> <span class="s2">&quot;PCA&quot;</span>
    <span class="k">elif</span> <span class="n">file_name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;xh&quot;</span><span class="p">:</span>
        <span class="n">file_inst</span> <span class="o">=</span> <span class="s2">&quot;HEXTE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Passed file name does not appear to be in the RXTE standard format.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># If HEXTE, which cluster?</span>
    <span class="k">if</span> <span class="n">file_inst</span> <span class="o">==</span> <span class="s2">&quot;HEXTE&quot;</span><span class="p">:</span>
        <span class="n">file_clust_id</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Just add the information to the instrument name</span>
        <span class="n">file_inst</span> <span class="o">=</span> <span class="n">file_inst</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">file_clust_id</span>

    <span class="c1"># Extract ObsID from the file name</span>
    <span class="n">file_oi</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>

    <span class="c1"># Convert the energy band code in the name to real numbers!</span>
    <span class="n">file_en_code</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">file_inst</span> <span class="o">==</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span>
        <span class="n">file_en_band</span> <span class="o">=</span> <span class="n">PCA_EN_BANDS</span><span class="p">[</span><span class="n">file_en_code</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_en_band</span> <span class="o">=</span> <span class="n">HEXTE_EN_BANDS</span><span class="p">[</span><span class="n">file_en_code</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">file_inst</span><span class="p">,</span> <span class="n">file_en_band</span><span class="p">,</span> <span class="n">file_oi</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pca_pcu_check</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple validation function, that will normalize user-supplied sets of RXTE-PCA</span>
<span class="sd">    PCU IDs to a string format that can be passed to RXTE-PCA HEASoft tasks.</span>

<span class="sd">    :param str/int/List[Union[str, int]] sel_pcu: User-supplied RXTE-PCA PCU IDs in</span>
<span class="sd">        one of several allowable formats.</span>
<span class="sd">    :return: User-selected RXTE-PCA PCU IDs in a normalized format suitable for passing</span>
<span class="sd">        to RXTE-PCA HEASoft tasks.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make a joined string of all allowed PCU IDs - useful in error messages</span>
    <span class="n">all_pcu_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">pcu_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">pcu_id</span> <span class="ow">in</span> <span class="n">ALLOWED_PCA_PCU_IDS</span><span class="p">])</span>

    <span class="c1"># Formats allowed for the &#39;sel_pcu&#39; argument are:</span>
    <span class="c1">#  - Single string (convertible to integer) or integer</span>
    <span class="c1">#  - List of strings (convertible to integer) or integers</span>
    <span class="c1">#  - String &quot;ALL&quot;</span>
    <span class="c1"># This set of if/elif statements both validates the input types, makes sure that</span>
    <span class="c1">#  the contents are valid PCU IDs, and converts to the output format</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sel_pcu</span> <span class="ow">in</span> <span class="n">ALLOWED_PCA_PCU_IDS</span><span class="p">:</span>
        <span class="n">sel_pcu</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">sel_pcu</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_PCA_PCU_IDS</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The value passed to the &#39;sel_pcu&#39; argument is not a valid &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;PCA PCU ID, pass one of the following; </span><span class="si">{</span><span class="n">all_pcu_str</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">en</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ALLOWED_PCA_PCU_IDS</span> <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">sel_pcu</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The list passed to the &#39;sel_pcu&#39; argument contains invalid &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;PCU IDs, please only use the following values; </span><span class="si">{</span><span class="n">all_pcu_str</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">sel_pcu</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">pcu_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">pcu_id</span> <span class="ow">in</span> <span class="n">sel_pcu</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">sel_pcu</span>


<span class="k">def</span><span class="w"> </span><span class="nf">process_rxte_pca</span><span class="p">(</span><span class="n">cur_obs_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj_coord</span><span class="p">:</span> <span class="n">SkyCoord</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper for the HEASoftPy pcaprepobsid task, which is used to prepare and process</span>
<span class="sd">    RXTE-PCA observation data, and is the first step toward creating new RXTE-PCA</span>
<span class="sd">    data products. The wrapper is primarily to enable the use of multiprocessing.</span>

<span class="sd">    Both Standard 1 and Standard 2 data modes will be processed.</span>

<span class="sd">    The tasks that pcaprepobsid runs are:</span>

<span class="sd">        1. xtefilt - create XTE filter file (*.xfl)</span>
<span class="sd">        2. xteprefilter - create prefilter-style filter file (*.mkf)</span>
<span class="sd">        3. pcaprepfile1 - prepare each Standard1 file for analysis</span>
<span class="sd">           - pcadeadcalc1 - calculate dead time quantities</span>
<span class="sd">        3. pcaprepfile2 - prepare each Standard2 file for analysis</span>
<span class="sd">           - pcadeadcalc2 - calculate dead time quantities</span>
<span class="sd">           - pcabackest - estimate PCA background</span>

<span class="sd">    :param str cur_obs_id: The ObsID of the RXTE observation to be processed.</span>
<span class="sd">    :param str out_dir: The directory where output files should be written.</span>
<span class="sd">    :param SkyCoord obj_coord: The coordinate of the target source.</span>
<span class="sd">    :return: A tuple containing the processed ObsID, the log output of the</span>
<span class="sd">        pipeline, and a boolean flag indicating success (True) or failure (False).</span>
<span class="sd">    :rtype: Tuple[str, hsp.core.HSPResult, bool]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Makes sure the specified output directory exists.</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Using dual contexts, one that moves us into the output directory for the</span>
    <span class="c1">#  duration, and another that creates a new set of HEASoft parameter files (so</span>
    <span class="c1">#  there are no clashes with other processes).</span>
    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>

        <span class="c1"># The processing/preparation stage of any X-ray telescope&#39;s data is the most</span>
        <span class="c1">#  likely to go wrong, and we use a Python try-except as an automated way to</span>
        <span class="c1">#  collect ObsIDs that had an issue during processing.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">pcaprepobsid</span><span class="p">(</span>
                <span class="n">indir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">cur_obs_id</span><span class="p">),</span>
                <span class="n">outdir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
                <span class="n">ra</span><span class="o">=</span><span class="n">obj_coord</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">dec</span><span class="o">=</span><span class="n">obj_coord</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">task_success</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">hsp</span><span class="o">.</span><span class="n">HSPTaskException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">task_success</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cur_obs_id</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">task_success</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gen_pca_gti</span><span class="p">(</span><span class="n">cur_obs_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rel_filt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hsp</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">HSPResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper for the HEASoftPy maketime task, which helps enable multiprocessing runs</span>
<span class="sd">    of this task. The maketime task is used to generate good time interval (GTI) files</span>
<span class="sd">    based on the input filter expression. This is necessary for RXTE-PCA data that</span>
<span class="sd">    is being re-processed from scratch</span>

<span class="sd">    :param str cur_obs_id: The ObsID of the RXTE observation to be processed.</span>
<span class="sd">    :param str out_dir: The directory where output files should be written.</span>
<span class="sd">    :param str rel_filt: Filtering expression to be applied to the RXTE-PCA data.</span>
<span class="sd">    :return: HEASoftPy result object output from this run of &#39;maketime&#39;.</span>
<span class="sd">    :rtype: hsp.core.HSPResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the filter file that was created by pcaprepobsid</span>
    <span class="n">filt_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/FP_*.xfl&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">maketime</span><span class="p">(</span>
            <span class="n">infile</span><span class="o">=</span><span class="n">filt_file</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;rxte-pca-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-gti.fits&quot;</span><span class="p">,</span>
            <span class="n">expr</span><span class="o">=</span><span class="n">rel_filt</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;VALUE&quot;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
            <span class="n">compact</span><span class="o">=</span><span class="s2">&quot;NO&quot;</span><span class="p">,</span>
            <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gen_pca_s2_spec_resp</span><span class="p">(</span>
    <span class="n">cur_obs_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sel_pcu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hsp</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">HSPResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper for the HEASoftPy pcaextspect2 task, which will generate RXTE-PCA spectra</span>
<span class="sd">    and supporting files. In this case we are only interested in the response files to</span>
<span class="sd">    help us convert between Standard 2 channels and energy, so the wrapper will</span>
<span class="sd">    remove the actual source and background spectral files after generation.</span>

<span class="sd">    The user can specify which RXTE-PCA PCUs are to be used when generating the files.</span>

<span class="sd">    :param str cur_obs_id: The ObsID of the RXTE observation to be processed.</span>
<span class="sd">    :param str out_dir: The directory where output files should be written.</span>
<span class="sd">    :param str/int/List[Union[str, int]] sel_pcu: The RXTE-PCA PCUs to be used when</span>
<span class="sd">        generating the spectral responses. Pass either a single string or integer</span>
<span class="sd">        representing the PCU ID, or a list of strings or integers representing the</span>
<span class="sd">        PCU IDs. Defaults to &#39;ALL&#39;.</span>
<span class="sd">    :return: HEASoftPy result object output from this run of &#39;pcaextspect2&#39;.</span>
<span class="sd">    :rtype: hsp.core.HSPResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Runs the PCU validation function</span>
    <span class="n">sel_pcu</span> <span class="o">=</span> <span class="n">pca_pcu_check</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">)</span>

    <span class="c1"># Again locate the filter file that was created by pcaprepobsid</span>
    <span class="n">filt_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/FP_*.xfl&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Specify the name of the response file that is the output of this function</span>
    <span class="n">rsp_out</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rxte-pca-pcu</span><span class="si">{</span><span class="n">sel_pcu</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">.rsp&quot;</span>

    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">pcaextspect2</span><span class="p">(</span>
            <span class="n">src_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtstd2.lis&quot;</span><span class="p">,</span>
            <span class="n">bkg_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtbkg2.lis&quot;</span><span class="p">,</span>
            <span class="n">src_phafile</span><span class="o">=</span><span class="s2">&quot;remove_sp.fits&quot;</span><span class="p">,</span>
            <span class="n">bkg_phafile</span><span class="o">=</span><span class="s2">&quot;remove_bsp.fits&quot;</span><span class="p">,</span>
            <span class="n">respfile</span><span class="o">=</span><span class="n">rsp_out</span><span class="p">,</span>
            <span class="n">gtiandfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;rxte-pca-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-gti.fits&quot;</span><span class="p">,</span>
            <span class="n">pculist</span><span class="o">=</span><span class="n">sel_pcu</span><span class="p">,</span>
            <span class="n">layerlist</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
            <span class="n">filtfile</span><span class="o">=</span><span class="n">filt_file</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># No care was taken generating the spectra themselves, as this function was</span>
        <span class="c1">#  only intended to provide response files. As such we delete the spectra</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;remove_sp.fits&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;remove_bsp.fits&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gen_pca_s1_light_curve</span><span class="p">(</span>
    <span class="n">cur_obs_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">time_bin_size</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
    <span class="n">sel_pcu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hsp</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">HSPResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper for the HEASoftPy pcaextlc1 task, which generates a light curve from</span>
<span class="sd">    RXTE-PCA Standard 1 data.</span>

<span class="sd">    The Standard 1 data mode is less commonly used than Standard 2, and has the</span>
<span class="sd">    significant downside of not providing any spectral information. HOWEVER, it does</span>
<span class="sd">    allow the user to create light curves with time bin sizes less than 16 seconds.</span>

<span class="sd">    If the desired time bin size is greater than or equal to 16 seconds, then the</span>
<span class="sd">    Standard 2 data mode, and the gen_pca_s2_light_curve function, should be</span>
<span class="sd">    used instead.</span>

<span class="sd">    :param str cur_obs_id: The ObsID of the RXTE observation to be processed.</span>
<span class="sd">    :param str out_dir: The directory where output files should be written.</span>
<span class="sd">    :param Quantity time_bin_size: Bin size (in units of time) used to generate the</span>
<span class="sd">        Standard 1 light curve. Defaults to 2 seconds, and values greater than</span>
<span class="sd">        or equal to 16 seconds are invalid (instead use gen_pca_s2_light_curve).</span>
<span class="sd">    :param str/int/List[Union[str, int]] sel_pcu: The RXTE-PCA PCUs to be used when</span>
<span class="sd">        generating the spectral responses. Pass either a single string or integer</span>
<span class="sd">        representing the PCU ID, or a list of strings or integers representing the</span>
<span class="sd">        PCU IDs. Defaults to &#39;ALL&#39;.</span>
<span class="sd">    :return: HEASoftPy result object output from this run of &#39;pcaextlc1&#39;.</span>
<span class="sd">    :rtype: hsp.core.HSPResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Checking the validity of the passed time bin size - for Standard 1 data the</span>
    <span class="c1">#  background becomes slightly invalid when using time bins larger than 16 seconds.</span>
    <span class="c1"># Besides, the user should WANT to use Standard 2 for those bin sizes because</span>
    <span class="c1">#  then you get spectral information back</span>
    <span class="k">if</span> <span class="n">time_bin_size</span> <span class="o">&gt;=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Time bin sizes greater than 16 seconds are not recommended for use with &quot;</span>
            <span class="s2">&quot;Standard-1 RXTE PCA analysis.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_bin_size</span> <span class="o">=</span> <span class="n">time_bin_size</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Running PCU selection validity check</span>
    <span class="n">sel_pcu</span> <span class="o">=</span> <span class="n">pca_pcu_check</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">)</span>

    <span class="c1"># Setting up the light curve file name - no energy information is included in this</span>
    <span class="c1">#  file name because the Standard 1 data mode does not provide spectral information.</span>
    <span class="n">lc_out</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;rxte-pca-pcu</span><span class="si">{</span><span class="n">sel_pcu</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;enALL-tb</span><span class="si">{</span><span class="n">time_bin_size</span><span class="si">}</span><span class="s2">s-lightcurve.fits&quot;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>
        <span class="c1"># Running pcaextlc1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">pcaextlc1</span><span class="p">(</span>
            <span class="n">src_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtstd1.lis&quot;</span><span class="p">,</span>
            <span class="n">bkg_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtbkg2.lis&quot;</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="n">lc_out</span><span class="p">,</span>
            <span class="n">gtiandfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;rxte-pca-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-gti.fits&quot;</span><span class="p">,</span>
            <span class="n">chmin</span><span class="o">=</span><span class="s2">&quot;INDEF&quot;</span><span class="p">,</span>
            <span class="n">chmax</span><span class="o">=</span><span class="s2">&quot;INDEF&quot;</span><span class="p">,</span>
            <span class="n">pculist</span><span class="o">=</span><span class="n">sel_pcu</span><span class="p">,</span>
            <span class="n">layerlist</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
            <span class="n">binsz</span><span class="o">=</span><span class="n">time_bin_size</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gen_pca_s2_light_curve</span><span class="p">(</span>
    <span class="n">cur_obs_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">lo_en</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
    <span class="n">hi_en</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span>
    <span class="n">rsp_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">time_bin_size</span><span class="p">:</span> <span class="n">Quantity</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
    <span class="n">sel_pcu</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hsp</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">HSPResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper for the HEASoftPy pcaextlc2 task, which generates a light curve from</span>
<span class="sd">    RXTE-PCA Standard 2 data.</span>

<span class="sd">    The Standard 2 data mode is the default for most RXTE-PCA analyses, and is</span>
<span class="sd">    recommended for most users. It provides spectral information that allows us</span>
<span class="sd">    to specify the energy bounds of the output light curve; HOWEVER, it cannot</span>
<span class="sd">    be used to generate light curves with better temporal resolution than 16 seconds.</span>

<span class="sd">    If the desired time bin size is less than 16 seconds, then the</span>
<span class="sd">    Standard 1 data mode, and the gen_pca_s1_light_curve function, should be</span>
<span class="sd">    used instead.</span>

<span class="sd">    :param str cur_obs_id: The ObsID of the RXTE observation to be processed.</span>
<span class="sd">    :param str out_dir: The directory where output files should be written.</span>
<span class="sd">    :param Quantity lo_en: Lower bound of the energy band within which we will</span>
<span class="sd">        generate the light curve</span>
<span class="sd">    :param Quantity hi_en: Upper bound of the energy band within which we will</span>
<span class="sd">        generate the light curve</span>
<span class="sd">    :param str rsp_path: The path to the response file to be used for conversion</span>
<span class="sd">        of energy limits to channel. Should be generated by the</span>
<span class="sd">        gen_pca_s2_spec_resp function.</span>
<span class="sd">    :param Quantity time_bin_size: Bin size (in units of time) used to generate the</span>
<span class="sd">        Standard 2 light curve. Defaults to 16 seconds, and values less than</span>
<span class="sd">        16 seconds are invalid (instead use gen_pca_s1_light_curve).</span>
<span class="sd">    :param str/int/List[Union[str, int]] sel_pcu: The RXTE-PCA PCUs to be used when</span>
<span class="sd">        generating the spectral responses. Pass either a single string or integer</span>
<span class="sd">        representing the PCU ID, or a list of strings or integers representing the</span>
<span class="sd">        PCU IDs. Defaults to &#39;ALL&#39;.</span>
<span class="sd">    :return: HEASoftPy result object output from this run of &#39;pcaextlc2&#39;.</span>
<span class="sd">    :rtype: hsp.core.HSPResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check that the time bin size isn&#39;t invalid for Standard 2 data</span>
    <span class="k">if</span> <span class="n">time_bin_size</span> <span class="o">&lt;</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Time bin sizes smaller than 16 seconds require the use of &quot;</span>
            <span class="s2">&quot;the Standard-1 mode.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_bin_size</span> <span class="o">=</span> <span class="n">time_bin_size</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Run validity checks on the input PCU IDs</span>
    <span class="n">sel_pcu</span> <span class="o">=</span> <span class="n">pca_pcu_check</span><span class="p">(</span><span class="n">sel_pcu</span><span class="p">)</span>

    <span class="c1"># Make sure the lower and upper energy limits make sense</span>
    <span class="k">if</span> <span class="n">lo_en</span> <span class="o">&gt;</span> <span class="n">hi_en</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The lower energy limit must be less than or equal to the upper &quot;</span>
            <span class="s2">&quot;energy limit.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lo_en_val</span> <span class="o">=</span> <span class="n">lo_en</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">hi_en_val</span> <span class="o">=</span> <span class="n">hi_en</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Determine the appropriate absolute channel range for the given energy band</span>
    <span class="n">abs_chans</span> <span class="o">=</span> <span class="n">energy_to_pca_abs_chan</span><span class="p">(</span><span class="n">Quantity</span><span class="p">([</span><span class="n">lo_en</span><span class="p">,</span> <span class="n">hi_en</span><span class="p">]),</span> <span class="n">rsp_path</span><span class="p">)</span>
    <span class="c1"># Make sure the lower and upper channels (ABSOLUTE channel IDs, not Standard 2)</span>
    <span class="c1">#  are integers.</span>
    <span class="n">lo_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">abs_chans</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">hi_ch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">abs_chans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Set up the light curve file name - energy information is included in this file</span>
    <span class="c1">#  name because the Standard 2 data mode provides spectral information.</span>
    <span class="n">lc_out</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;rxte-pca-pcu</span><span class="si">{</span><span class="n">sel_pcu</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;en</span><span class="si">{</span><span class="n">lo_en_val</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hi_en_val</span><span class="si">}</span><span class="s2">keV-tb</span><span class="si">{</span><span class="n">time_bin_size</span><span class="si">}</span><span class="s2">s-lightcurve.fits&quot;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>
        <span class="c1"># Running pcaextlc2</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">pcaextlc2</span><span class="p">(</span>
            <span class="n">src_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtstd2.lis&quot;</span><span class="p">,</span>
            <span class="n">bkg_infile</span><span class="o">=</span><span class="s2">&quot;@FP_dtbkg2.lis&quot;</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="n">lc_out</span><span class="p">,</span>
            <span class="n">gtiandfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;rxte-pca-</span><span class="si">{</span><span class="n">cur_obs_id</span><span class="si">}</span><span class="s2">-gti.fits&quot;</span><span class="p">,</span>
            <span class="n">chmin</span><span class="o">=</span><span class="n">lo_ch</span><span class="p">,</span>
            <span class="n">chmax</span><span class="o">=</span><span class="n">hi_ch</span><span class="p">,</span>
            <span class="n">pculist</span><span class="o">=</span><span class="n">sel_pcu</span><span class="p">,</span>
            <span class="n">layerlist</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
            <span class="n">binsz</span><span class="o">=</span><span class="n">time_bin_size</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">energy_to_pca_abs_chan</span><span class="p">(</span><span class="n">en</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">,</span> <span class="n">rsp_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This simple function uses an RXTE-PCA spectral response file, and a notebook</span>
<span class="sd">    constant defining the absolute channel to Standard 2 channel mapping, to convert</span>
<span class="sd">    energy values to RXTE-PCA absolute channel (NOT Standard 2) values.</span>

<span class="sd">    :param Quantity en: The energy (or energies) to be converted to RXTE-PCA</span>
<span class="sd">        absolute channel (NOT Standard 2) values. Both scalar and non-scalar</span>
<span class="sd">        Astropy Quantity objects may be passed</span>
<span class="sd">    :param str rsp_path: Path to the relevant RXTE-PCA spectral response file.</span>
<span class="sd">    :return: RXTE-PCA absolute channel values corresponding to the input energy(s).</span>
<span class="sd">    :rtype: List</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Have to make sure the input energies are in keV, otherwise comparison to the</span>
    <span class="c1">#  response file&#39;s tables would be invalid</span>
    <span class="n">en</span> <span class="o">=</span> <span class="n">en</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span>

    <span class="c1"># We open the response file, as we need to get at the EBOUNDS table to be able</span>
    <span class="c1">#  to go from energy values to Standard 2 channels</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rsp_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">rspo</span><span class="p">:</span>
        <span class="n">en_tab</span> <span class="o">=</span> <span class="n">rspo</span><span class="p">[</span><span class="s2">&quot;EBOUNDS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># If the input energy is scalar, we make it a one-element Quantity array to</span>
        <span class="c1">#  make it easier to use numpy functions</span>
        <span class="k">if</span> <span class="n">en</span><span class="o">.</span><span class="n">isscalar</span><span class="p">:</span>
            <span class="n">en</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="n">en</span><span class="p">])</span>

        <span class="c1"># Vectorised way to find the rows of the EBOUNDS table whose E_MIN and E_MAX</span>
        <span class="c1">#  values contain our passed energy(s)</span>
        <span class="n">sel_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="n">en_tab</span><span class="p">[</span><span class="s2">&quot;E_MIN&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">en</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">en_tab</span><span class="p">[</span><span class="s2">&quot;E_MAX&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">en</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">std2_chans</span> <span class="o">=</span> <span class="n">en_tab</span><span class="p">[</span><span class="s2">&quot;CHANNEL&quot;</span><span class="p">][</span><span class="n">sel_ind</span><span class="p">]</span>

    <span class="c1"># Take the Standard 2 channels we found using the response file, and</span>
    <span class="c1">#  the use a dictionary (defined in the Global Setup - Constants section) to</span>
    <span class="c1">#  convert them to absolute channel values.</span>
    <span class="c1"># Some Standard 2 channels correspond to a range of absolute channel values, and</span>
    <span class="c1">#  in those cases we take the mean of the absolute channel range</span>
    <span class="n">abs_chans</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">STD2_ABS_CHAN_MAP</span><span class="p">[</span><span class="n">s2_ch</span><span class="p">])</span> <span class="k">for</span> <span class="n">s2_ch</span> <span class="ow">in</span> <span class="n">std2_chans</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">abs_chans</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The name of the source we&#39;re examining in this demonstration</span>
<span class="n">SRC_NAME</span> <span class="o">=</span> <span class="s2">&quot;IGR J17480–2446&quot;</span>

<span class="c1"># Controls the verbosity of all HEASoftPy tasks</span>
<span class="n">TASK_CHATTER</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Allowed PCA proportional counter unit (PCU) IDs</span>
<span class="n">ALLOWED_PCA_PCU_IDS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="c1"># PCA and HEXTE file-name-code to energy band mappings</span>
<span class="n">PCA_EN_BANDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">HEXTE_EN_BANDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Default time bin sizes of archived light curves</span>
<span class="n">DEFAULT_TIME_BINS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
    <span class="s2">&quot;HEXTE-0&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
    <span class="s2">&quot;HEXTE-1&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># The approximate FoV radii of the two instruments</span>
<span class="n">RXTE_AP_SIZES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">),</span>
    <span class="s2">&quot;HEXTE-0&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">),</span>
    <span class="s2">&quot;HEXTE-1&quot;</span><span class="p">:</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Horrible dictionary extracted</span>
<span class="c1">#  from https://heasarc.gsfc.nasa.gov/docs/xte/e-c_table.html</span>
<span class="n">STD2_ABS_CHAN_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="mi">4</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="mi">6</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="mi">7</span><span class="p">:</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="mi">8</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="mi">9</span><span class="p">:</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
    <span class="mi">10</span><span class="p">:</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="mi">12</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
    <span class="mi">13</span><span class="p">:</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
    <span class="mi">14</span><span class="p">:</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
    <span class="mi">15</span><span class="p">:</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span>
    <span class="mi">16</span><span class="p">:</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="mi">17</span><span class="p">:</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
    <span class="mi">18</span><span class="p">:</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
    <span class="mi">19</span><span class="p">:</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span>
    <span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
    <span class="mi">21</span><span class="p">:</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
    <span class="mi">22</span><span class="p">:</span> <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
    <span class="mi">23</span><span class="p">:</span> <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span>
    <span class="mi">24</span><span class="p">:</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
    <span class="mi">25</span><span class="p">:</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
    <span class="mi">26</span><span class="p">:</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="mi">27</span><span class="p">:</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
    <span class="mi">28</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
    <span class="mi">29</span><span class="p">:</span> <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span>
    <span class="mi">30</span><span class="p">:</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">),</span>
    <span class="mi">31</span><span class="p">:</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
    <span class="mi">32</span><span class="p">:</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span>
    <span class="mi">33</span><span class="p">:</span> <span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">37</span><span class="p">),</span>
    <span class="mi">34</span><span class="p">:</span> <span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">38</span><span class="p">),</span>
    <span class="mi">35</span><span class="p">:</span> <span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">39</span><span class="p">),</span>
    <span class="mi">36</span><span class="p">:</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
    <span class="mi">37</span><span class="p">:</span> <span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span>
    <span class="mi">38</span><span class="p">:</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
    <span class="mi">39</span><span class="p">:</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">43</span><span class="p">),</span>
    <span class="mi">40</span><span class="p">:</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">),</span>
    <span class="mi">41</span><span class="p">:</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span>
    <span class="mi">42</span><span class="p">:</span> <span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">46</span><span class="p">),</span>
    <span class="mi">43</span><span class="p">:</span> <span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span>
    <span class="mi">44</span><span class="p">:</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">48</span><span class="p">),</span>
    <span class="mi">45</span><span class="p">:</span> <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">49</span><span class="p">),</span>
    <span class="mi">46</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="mi">47</span><span class="p">:</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">),</span>
    <span class="mi">48</span><span class="p">:</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">52</span><span class="p">),</span>
    <span class="mi">49</span><span class="p">:</span> <span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">53</span><span class="p">),</span>
    <span class="mi">50</span><span class="p">:</span> <span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">),</span>
    <span class="mi">51</span><span class="p">:</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">),</span>
    <span class="mi">52</span><span class="p">:</span> <span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">),</span>
    <span class="mi">53</span><span class="p">:</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">),</span>
    <span class="mi">54</span><span class="p">:</span> <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">63</span><span class="p">),</span>
    <span class="mi">55</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">),</span>
    <span class="mi">56</span><span class="p">:</span> <span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span>
    <span class="mi">57</span><span class="p">:</span> <span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
    <span class="mi">58</span><span class="p">:</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span>
    <span class="mi">59</span><span class="p">:</span> <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">73</span><span class="p">),</span>
    <span class="mi">60</span><span class="p">:</span> <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
    <span class="mi">61</span><span class="p">:</span> <span class="p">(</span><span class="mi">76</span><span class="p">,</span> <span class="mi">77</span><span class="p">),</span>
    <span class="mi">62</span><span class="p">:</span> <span class="p">(</span><span class="mi">78</span><span class="p">,</span> <span class="mi">79</span><span class="p">),</span>
    <span class="mi">63</span><span class="p">:</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">),</span>
    <span class="mi">64</span><span class="p">:</span> <span class="p">(</span><span class="mi">82</span><span class="p">,</span> <span class="mi">83</span><span class="p">),</span>
    <span class="mi">65</span><span class="p">:</span> <span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">85</span><span class="p">),</span>
    <span class="mi">66</span><span class="p">:</span> <span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="mi">87</span><span class="p">),</span>
    <span class="mi">67</span><span class="p">:</span> <span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="mi">89</span><span class="p">),</span>
    <span class="mi">68</span><span class="p">:</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">),</span>
    <span class="mi">69</span><span class="p">:</span> <span class="p">(</span><span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">),</span>
    <span class="mi">70</span><span class="p">:</span> <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="mi">95</span><span class="p">),</span>
    <span class="mi">71</span><span class="p">:</span> <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">97</span><span class="p">),</span>
    <span class="mi">72</span><span class="p">:</span> <span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="mi">73</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">),</span>
    <span class="mi">74</span><span class="p">:</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">),</span>
    <span class="mi">75</span><span class="p">:</span> <span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">),</span>
    <span class="mi">76</span><span class="p">:</span> <span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="mi">107</span><span class="p">),</span>
    <span class="mi">77</span><span class="p">:</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">),</span>
    <span class="mi">78</span><span class="p">:</span> <span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">111</span><span class="p">),</span>
    <span class="mi">79</span><span class="p">:</span> <span class="p">(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">),</span>
    <span class="mi">80</span><span class="p">:</span> <span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">115</span><span class="p">),</span>
    <span class="mi">81</span><span class="p">:</span> <span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">117</span><span class="p">),</span>
    <span class="mi">82</span><span class="p">:</span> <span class="p">(</span><span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">),</span>
    <span class="mi">83</span><span class="p">:</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">),</span>
    <span class="mi">84</span><span class="p">:</span> <span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
    <span class="mi">85</span><span class="p">:</span> <span class="p">(</span><span class="mi">124</span><span class="p">,</span> <span class="mi">125</span><span class="p">),</span>
    <span class="mi">86</span><span class="p">:</span> <span class="p">(</span><span class="mi">126</span><span class="p">,</span> <span class="mi">127</span><span class="p">),</span>
    <span class="mi">87</span><span class="p">:</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">),</span>
    <span class="mi">88</span><span class="p">:</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">131</span><span class="p">),</span>
    <span class="mi">89</span><span class="p">:</span> <span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="mi">133</span><span class="p">),</span>
    <span class="mi">90</span><span class="p">:</span> <span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="mi">135</span><span class="p">),</span>
    <span class="mi">91</span><span class="p">:</span> <span class="p">(</span><span class="mi">136</span><span class="p">,</span> <span class="mi">138</span><span class="p">),</span>
    <span class="mi">92</span><span class="p">:</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span> <span class="mi">141</span><span class="p">),</span>
    <span class="mi">93</span><span class="p">:</span> <span class="p">(</span><span class="mi">142</span><span class="p">,</span> <span class="mi">144</span><span class="p">),</span>
    <span class="mi">94</span><span class="p">:</span> <span class="p">(</span><span class="mi">145</span><span class="p">,</span> <span class="mi">147</span><span class="p">),</span>
    <span class="mi">95</span><span class="p">:</span> <span class="p">(</span><span class="mi">148</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="mi">96</span><span class="p">:</span> <span class="p">(</span><span class="mi">151</span><span class="p">,</span> <span class="mi">153</span><span class="p">),</span>
    <span class="mi">97</span><span class="p">:</span> <span class="p">(</span><span class="mi">154</span><span class="p">,</span> <span class="mi">156</span><span class="p">),</span>
    <span class="mi">98</span><span class="p">:</span> <span class="p">(</span><span class="mi">157</span><span class="p">,</span> <span class="mi">159</span><span class="p">),</span>
    <span class="mi">99</span><span class="p">:</span> <span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">162</span><span class="p">),</span>
    <span class="mi">100</span><span class="p">:</span> <span class="p">(</span><span class="mi">163</span><span class="p">,</span> <span class="mi">165</span><span class="p">),</span>
    <span class="mi">101</span><span class="p">:</span> <span class="p">(</span><span class="mi">166</span><span class="p">,</span> <span class="mi">168</span><span class="p">),</span>
    <span class="mi">102</span><span class="p">:</span> <span class="p">(</span><span class="mi">169</span><span class="p">,</span> <span class="mi">171</span><span class="p">),</span>
    <span class="mi">103</span><span class="p">:</span> <span class="p">(</span><span class="mi">172</span><span class="p">,</span> <span class="mi">174</span><span class="p">),</span>
    <span class="mi">104</span><span class="p">:</span> <span class="p">(</span><span class="mi">175</span><span class="p">,</span> <span class="mi">177</span><span class="p">),</span>
    <span class="mi">105</span><span class="p">:</span> <span class="p">(</span><span class="mi">178</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
    <span class="mi">106</span><span class="p">:</span> <span class="p">(</span><span class="mi">181</span><span class="p">,</span> <span class="mi">183</span><span class="p">),</span>
    <span class="mi">107</span><span class="p">:</span> <span class="p">(</span><span class="mi">184</span><span class="p">,</span> <span class="mi">186</span><span class="p">),</span>
    <span class="mi">108</span><span class="p">:</span> <span class="p">(</span><span class="mi">187</span><span class="p">,</span> <span class="mi">189</span><span class="p">),</span>
    <span class="mi">109</span><span class="p">:</span> <span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span>
    <span class="mi">110</span><span class="p">:</span> <span class="p">(</span><span class="mi">193</span><span class="p">,</span> <span class="mi">195</span><span class="p">),</span>
    <span class="mi">111</span><span class="p">:</span> <span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">198</span><span class="p">),</span>
    <span class="mi">112</span><span class="p">:</span> <span class="p">(</span><span class="mi">199</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span>
    <span class="mi">113</span><span class="p">:</span> <span class="p">(</span><span class="mi">202</span><span class="p">,</span> <span class="mi">204</span><span class="p">),</span>
    <span class="mi">114</span><span class="p">:</span> <span class="p">(</span><span class="mi">205</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span>
    <span class="mi">115</span><span class="p">:</span> <span class="p">(</span><span class="mi">208</span><span class="p">,</span> <span class="mi">210</span><span class="p">),</span>
    <span class="mi">116</span><span class="p">:</span> <span class="p">(</span><span class="mi">211</span><span class="p">,</span> <span class="mi">213</span><span class="p">),</span>
    <span class="mi">117</span><span class="p">:</span> <span class="p">(</span><span class="mi">214</span><span class="p">,</span> <span class="mi">216</span><span class="p">),</span>
    <span class="mi">118</span><span class="p">:</span> <span class="p">(</span><span class="mi">217</span><span class="p">,</span> <span class="mi">219</span><span class="p">),</span>
    <span class="mi">119</span><span class="p">:</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">222</span><span class="p">),</span>
    <span class="mi">120</span><span class="p">:</span> <span class="p">(</span><span class="mi">223</span><span class="p">,</span> <span class="mi">225</span><span class="p">),</span>
    <span class="mi">121</span><span class="p">:</span> <span class="p">(</span><span class="mi">226</span><span class="p">,</span> <span class="mi">228</span><span class="p">),</span>
    <span class="mi">122</span><span class="p">:</span> <span class="p">(</span><span class="mi">229</span><span class="p">,</span> <span class="mi">231</span><span class="p">),</span>
    <span class="mi">123</span><span class="p">:</span> <span class="p">(</span><span class="mi">232</span><span class="p">,</span> <span class="mi">234</span><span class="p">),</span>
    <span class="mi">124</span><span class="p">:</span> <span class="p">(</span><span class="mi">235</span><span class="p">,</span> <span class="mi">237</span><span class="p">),</span>
    <span class="mi">125</span><span class="p">:</span> <span class="p">(</span><span class="mi">238</span><span class="p">,</span> <span class="mi">241</span><span class="p">),</span>
    <span class="mi">126</span><span class="p">:</span> <span class="p">(</span><span class="mi">242</span><span class="p">,</span> <span class="mi">245</span><span class="p">),</span>
    <span class="mi">127</span><span class="p">:</span> <span class="p">(</span><span class="mi">246</span><span class="p">,</span> <span class="mi">249</span><span class="p">),</span>
    <span class="mi">128</span><span class="p">:</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">DOWN_EXCLUDE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;ace&quot;</span><span class="p">,</span> <span class="s2">&quot;clock&quot;</span><span class="p">,</span> <span class="s2">&quot;eds&quot;</span><span class="p">,</span> <span class="s2">&quot;fds&quot;</span><span class="p">,</span> <span class="s2">&quot;gsace&quot;</span><span class="p">,</span> <span class="s2">&quot;ifog&quot;</span><span class="p">,</span> <span class="s2">&quot;ipsdu&quot;</span><span class="p">,</span> <span class="s2">&quot;pse&quot;</span><span class="p">,</span> <span class="s2">&quot;spsdu&quot;</span><span class="p">,</span> <span class="s2">&quot;stdprod&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------- Configure global package settings --------------</span>
<span class="c1"># Raise Python exceptions if a heasoftpy task fails</span>
<span class="c1"># TODO Remove once this becomes a default in heasoftpy</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">allow_failure</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Set up the method for spawning processes.</span>
<span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>

<span class="c1"># ------------- Setting how many cores we can use --------------</span>
<span class="n">NUM_CORES</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">total_cores</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

<span class="k">if</span> <span class="n">NUM_CORES</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">NUM_CORES</span> <span class="o">=</span> <span class="n">total_cores</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;If manually overriding &#39;NUM_CORES&#39;, you must set it to an integer value.&quot;</span>
    <span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">NUM_CORES</span> <span class="o">&gt;</span> <span class="n">total_cores</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;If manually overriding &#39;NUM_CORES&#39;, the value must be less than or &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;equal to the total available cores (</span><span class="si">{</span><span class="n">total_cores</span><span class="si">}</span><span class="s2">).&quot;</span>
    <span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>

<span class="c1"># -------------- Set paths and create directories --------------</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;../../../_data&quot;</span><span class="p">):</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;../../../_data/RXTE/&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;RXTE/&quot;</span>

<span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>

<span class="c1"># Make sure the download directory exists.</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Setup path and directory into which we save output files from this example.</span>
<span class="n">OUT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;RXTE_output&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<hr class="docutils" />
<section id="finding-the-data">
<h2>1. Finding the data<a class="headerlink" href="#finding-the-data" title="Link to this heading">#</a></h2>
<p>To identify relevant RXTE data, we could use <a class="reference external" href="https://heasarc.gsfc.nasa.gov/xamin/">Xamin</a>, the HEASARC web portal, the Virtual Observatory (VO) python client <code class="docutils literal notranslate"><span class="pre">pyvo</span></code>, or <strong>the Astroquery module</strong> (our choice for this demonstration).</p>
<section id="using-astroquery-to-find-the-rxte-observation-summary-master-table">
<h3>Using Astroquery to find the RXTE observation summary (master) table<a class="headerlink" href="#using-astroquery-to-find-the-rxte-observation-summary-master-table" title="Link to this heading">#</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code> object from Astroquery, we can easily search through all of HEASARC’s catalog holdings. In this
case we need to find what we refer to as a ‘master’ catalog/table, which summarizes all RXTE observations present in
our archive. We can do this by passing the <code class="docutils literal notranslate"><span class="pre">master=True</span></code> keyword argument to the <code class="docutils literal notranslate"><span class="pre">list_catalogs</span></code> method.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_name</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">list_catalogs</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="s2">&quot;xte&quot;</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<span class="n">table_name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.str_(&#39;xtemaster&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="identifying-rxte-observations-of-igr-j174802446-t5x2">
<h3>Identifying RXTE observations of IGR J17480–2446/T5X2<a class="headerlink" href="#identifying-rxte-observations-of-igr-j174802446-t5x2" title="Link to this heading">#</a></h3>
<p>Now that we have identified the HEASARC table that contains information on RXTE pointings, we’re going to search
it for observations of <strong>T5X2</strong>.</p>
<p>For convenience, we pull the coordinate of T5X2/IGR J17480–2446 from the <a class="reference external" href="https://cds.unistra.fr/">Strasbourg astronomical Data Center (CDS)</a> name
resolver functionality built into Astropy’s <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> class. A constant containing the name of the target was created in
the ‘Global Setup: Constants’ section of this notebook:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SRC_NAME</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;IGR J17480–2446&#39;
</pre></div>
</div>
</div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> class, we can fetch the coordinates for our target:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the coordinate for our source</span>
<span class="n">rel_coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="n">SRC_NAME</span><span class="p">)</span>
<span class="c1"># Turn it into a straight Astropy quantity, which will be useful later</span>
<span class="n">rel_coord_quan</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="n">rel_coord</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">rel_coord</span><span class="o">.</span><span class="n">dec</span><span class="p">])</span>
<span class="n">rel_coord</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    (267.0201292, -24.7802417)&gt;
</pre></div>
</div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Each HEASARC catalog has its own default search radius, which you can retrieve
using <code class="docutils literal notranslate"><span class="pre">Heasarc.get_default_radius(catalog_name)</span></code> - you should carefully consider the
search radius you use for your own science case!</p>
</div>
<p>Then we can use the <code class="docutils literal notranslate"><span class="pre">query_region</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code> to search for relevant RXTE observations:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_obs</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span><span class="n">rel_coord</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
<span class="n">all_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=160</i>
<table id="table140655731674432" class="table-striped table-bordered table-condensed">
<thead><tr><th>obsid</th><th>prnb</th><th>status</th><th>pi_lname</th><th>pi_fname</th><th>target_name</th><th>ra</th><th>dec</th><th>time</th><th>duration</th><th>exposure</th><th>__row</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>deg</th><th>deg</th><th>d</th><th>s</th><th>s</th><th></th></tr></thead>
<thead><tr><th>object</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th></tr></thead>
<tr><td></td><td>93055</td><td>accepted</td><td>ALTAMIRANO</td><td>DIEGO</td><td>EXO1745-248</td><td>267.2333</td><td>-24.8950</td><td>--</td><td>--</td><td>--</td><td>70727</td></tr>
<tr><td>50054-06-01-01</td><td>50054</td><td>archived</td><td>ZHANG</td><td>WILLIAM</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51749.63341</td><td>5820</td><td>2429</td><td>71046</td></tr>
<tr><td>50054-06-01-00</td><td>50054</td><td>archived</td><td>ZHANG</td><td>WILLIAM</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51746.43203</td><td>6047</td><td>3434</td><td>71047</td></tr>
<tr><td>50138-03-01-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51738.18831</td><td>3260</td><td>1680</td><td>71048</td></tr>
<tr><td>50138-03-01-01</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51738.73752</td><td>3217</td><td>1735</td><td>71049</td></tr>
<tr><td>50138-03-02-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51740.0494</td><td>2940</td><td>1064</td><td>71050</td></tr>
<tr><td>50138-03-02-01</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51740.11606</td><td>541</td><td>--</td><td>71051</td></tr>
<tr><td>50138-03-03-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51741.44572</td><td>5237</td><td>3378</td><td>71052</td></tr>
<tr><td>50138-03-04-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51742.50841</td><td>4596</td><td>3477</td><td>71053</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>96316-01-16-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55684.96769</td><td>2770</td><td>1917</td><td>71196</td></tr>
<tr><td>96316-01-17-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55691.58411</td><td>4860</td><td>1667</td><td>71197</td></tr>
<tr><td>96316-01-18-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55697.92324</td><td>4419</td><td>2101</td><td>71198</td></tr>
<tr><td>96316-01-19-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55704.84321</td><td>4554</td><td>2130</td><td>71199</td></tr>
<tr><td>96316-01-20-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55711.75772</td><td>3631</td><td>1622</td><td>71200</td></tr>
<tr><td>96316-01-21-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55718.35848</td><td>4744</td><td>2013</td><td>71201</td></tr>
<tr><td>96316-01-22-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55725.37816</td><td>3388</td><td>2213</td><td>71202</td></tr>
<tr><td>96316-01-23-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55731.20844</td><td>4067</td><td>2078</td><td>71203</td></tr>
<tr><td>96316-01-24-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55739.64314</td><td>4437</td><td>1933</td><td>71204</td></tr>
</table></div></div></div>
</div>
<p>We can immediately see that the first entry in the <code class="docutils literal notranslate"><span class="pre">all_obs</span></code> table does not have
an ObsID, and is also missing other crucial information such as when the observation
was taken, and how long the exposure was. This is because a proposal was accepted, but
the data were never taken. In this case it’s likely because the proposal was for a
target of opportunity (ToO), and the trigger conditions were never met.</p>
<p>All that said, we should filter our table of observations to ensure that only real
observations are included. The easiest way to do that is probably to require that
the exposure time entry is greater than zero:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_obs</span> <span class="o">=</span> <span class="n">all_obs</span><span class="p">[</span><span class="n">all_obs</span><span class="p">[</span><span class="s2">&quot;exposure&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">valid_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=154</i>
<table id="table140655648782816" class="table-striped table-bordered table-condensed">
<thead><tr><th>obsid</th><th>prnb</th><th>status</th><th>pi_lname</th><th>pi_fname</th><th>target_name</th><th>ra</th><th>dec</th><th>time</th><th>duration</th><th>exposure</th><th>__row</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>deg</th><th>deg</th><th>d</th><th>s</th><th>s</th><th></th></tr></thead>
<thead><tr><th>object</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th></tr></thead>
<tr><td>50054-06-01-01</td><td>50054</td><td>archived</td><td>ZHANG</td><td>WILLIAM</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51749.63341</td><td>5820</td><td>2429</td><td>71046</td></tr>
<tr><td>50054-06-01-00</td><td>50054</td><td>archived</td><td>ZHANG</td><td>WILLIAM</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51746.43203</td><td>6047</td><td>3434</td><td>71047</td></tr>
<tr><td>50138-03-01-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51738.18831</td><td>3260</td><td>1680</td><td>71048</td></tr>
<tr><td>50138-03-01-01</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51738.73752</td><td>3217</td><td>1735</td><td>71049</td></tr>
<tr><td>50138-03-02-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51740.0494</td><td>2940</td><td>1064</td><td>71050</td></tr>
<tr><td>50138-03-03-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51741.44572</td><td>5237</td><td>3378</td><td>71052</td></tr>
<tr><td>50138-03-04-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51742.50841</td><td>4596</td><td>3477</td><td>71053</td></tr>
<tr><td>50138-03-05-00</td><td>50138</td><td>archived</td><td>SWANK</td><td>JEAN</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51743.57614</td><td>4176</td><td>3038</td><td>71054</td></tr>
<tr><td>50054-06-02-01</td><td>50054</td><td>archived</td><td>ZHANG</td><td>WILLIAM</td><td>EXO_1745-248</td><td>267.0225</td><td>-24.7819</td><td>51756.25972</td><td>4793</td><td>3539</td><td>71055</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>96316-01-16-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55684.96769</td><td>2770</td><td>1917</td><td>71196</td></tr>
<tr><td>96316-01-17-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55691.58411</td><td>4860</td><td>1667</td><td>71197</td></tr>
<tr><td>96316-01-18-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55697.92324</td><td>4419</td><td>2101</td><td>71198</td></tr>
<tr><td>96316-01-19-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55704.84321</td><td>4554</td><td>2130</td><td>71199</td></tr>
<tr><td>96316-01-20-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55711.75772</td><td>3631</td><td>1622</td><td>71200</td></tr>
<tr><td>96316-01-21-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55718.35848</td><td>4744</td><td>2013</td><td>71201</td></tr>
<tr><td>96316-01-22-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55725.37816</td><td>3388</td><td>2213</td><td>71202</td></tr>
<tr><td>96316-01-23-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55731.20844</td><td>4067</td><td>2078</td><td>71203</td></tr>
<tr><td>96316-01-24-00</td><td>96316</td><td>archived</td><td>ALTAMIRANO</td><td>DIEGO</td><td>TERZAN_5</td><td>267.0208</td><td>-24.7800</td><td>55739.64314</td><td>4437</td><td>1933</td><td>71204</td></tr>
</table></div></div></div>
</div>
<p>Then, by converting the ‘time’ column of the valid observations table into an Astropy
<code class="docutils literal notranslate"><span class="pre">Time</span></code> object, and using the <code class="docutils literal notranslate"><span class="pre">min()</span></code> and <code class="docutils literal notranslate"><span class="pre">max()</span></code> methods, we can see that the
observations we’ve selected come from a period of over 10 years.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_obs_times</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">valid_obs</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)</span>
<span class="n">valid_obs_datetimes</span> <span class="o">=</span> <span class="n">valid_obs_times</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">valid_obs_datetimes</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">valid_obs_datetimes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000-07-13 04:31:09.984000
2011-11-19 14:08:29.472000
</pre></div>
</div>
</div>
</div>
<p>To reduce the run time of this demonstration, we’ll select observations taken before
the 19th of October 2010. There are a significant number of observations taken after
this date, but the light curves are not as featureful and interesting
as those taken before.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cut_valid_obs</span> <span class="o">=</span> <span class="n">valid_obs</span><span class="p">[</span><span class="n">valid_obs_times</span> <span class="o">&lt;</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2010-10-19&quot;</span><span class="p">)]</span>
<span class="n">rel_obsids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cut_valid_obs</span><span class="p">[</span><span class="s2">&quot;obsid&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_obsids</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>62
</pre></div>
</div>
</div>
</div>
<section id="constructing-an-adql-query-advanced-alternative">
<h4>Constructing an ADQL query [<strong>advanced alternative</strong>]<a class="headerlink" href="#constructing-an-adql-query-advanced-alternative" title="Link to this heading">#</a></h4>
<p><strong>Alternatively</strong>, if you wished to place extra constraints on the search, you could use the more complex but more powerful
<code class="docutils literal notranslate"><span class="pre">query_tap</span></code> method to pass a full Astronomical Data Query Language (ADQL) query. This demonstration runs the same
spatial query as before but also includes a stringent exposure time requirement; you might do this to try and only
select the highest signal-to-noise observations.</p>
<p>Note that we call the <code class="docutils literal notranslate"><span class="pre">to_table</span></code> method on the result of the query to convert the result into an Astropy table, which
is the form required to pass to the <code class="docutils literal notranslate"><span class="pre">locate_data</span></code> method (see the next section).</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;SELECT * &quot;</span>
    <span class="s2">&quot;from </span><span class="si">{c}</span><span class="s2"> as cat &quot;</span>
    <span class="s2">&quot;where contains(point(&#39;ICRS&#39;,cat.ra,cat.dec), circle(&#39;ICRS&#39;,</span><span class="si">{ra}</span><span class="s2">,</span><span class="si">{dec}</span><span class="s2">,0.0033))=1 &quot;</span>
    <span class="s2">&quot;and cat.exposure &gt; 0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">ra</span><span class="o">=</span><span class="n">rel_coord</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">rel_coord</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">table_name</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">alt_obs</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">query_tap</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="n">alt_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=153</i>
<table id="table140655651285776" class="table-striped table-bordered table-condensed">
<thead><tr><th>__row</th><th>pi_lname</th><th>pi_fname</th><th>pi_no</th><th>prnb</th><th>cycle</th><th>subject_category</th><th>target_name</th><th>time_awarded</th><th>ra</th><th>dec</th><th>priority</th><th>tar_no</th><th>obsid</th><th>time</th><th>duration</th><th>exposure</th><th>status</th><th>scheduled_date</th><th>observed_date</th><th>processed_date</th><th>archived_date</th><th>hexte_anglea</th><th>hexte_angleb</th><th>hexte_dwella</th><th>hexte_dwellb</th><th>hexte_energya</th><th>hexte_energyb</th><th>hexte_modea</th><th>hexte_modeb</th><th>pca_config1</th><th>pca_config2</th><th>pca_config3</th><th>pca_config4</th><th>pca_config5</th><th>pca_config6</th><th>lii</th><th>bii</th><th>__x_ra_dec</th><th>__y_ra_dec</th><th>__z_ra_dec</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>s</th><th>deg</th><th>deg</th><th></th><th></th><th></th><th>d</th><th>s</th><th>s</th><th></th><th>d</th><th>d</th><th>d</th><th>d</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>deg</th><th>deg</th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>object</th><th>int32</th><th>int32</th><th>int16</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>int16</th><th>int16</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>object</th><th>float64</th><th>float64</th><th>int32</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>71046</td><td>ZHANG</td><td>WILLIAM</td><td>164</td><td>50054</td><td>5</td><td>LMXB</td><td>EXO_1745-248</td><td>200000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>6</td><td>50054-06-01-01</td><td>51749.63341</td><td>5820</td><td>2429</td><td>archived</td><td>51749.63341</td><td>51749.63341</td><td>--</td><td>52129</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX0F</td><td>E_8US_256_DX0F</td><td>STANDARD1</td><td>STANDARD2</td><td>E_125US_64M_0_1S</td><td>TLA_1S_10_249_1S_10000_F</td><td>CB_125US_1M_0_249_H</td><td>IDLE</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71047</td><td>ZHANG</td><td>WILLIAM</td><td>164</td><td>50054</td><td>5</td><td>LMXB</td><td>EXO_1745-248</td><td>200000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>6</td><td>50054-06-01-00</td><td>51746.43203</td><td>6047</td><td>3434</td><td>archived</td><td>51746.43203</td><td>51746.43203</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX0F</td><td>E_8US_256_DX0F</td><td>STANDARD1</td><td>STANDARD2</td><td>E_125US_64M_0_1S</td><td>TLA_1S_10_249_1S_10000_F</td><td>CB_125US_1M_0_249_H</td><td>IDLE</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71048</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-01-00</td><td>51738.18831</td><td>3260</td><td>1680</td><td>archived</td><td>51738.18831</td><td>51738.18831</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71049</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-01-01</td><td>51738.73752</td><td>3217</td><td>1735</td><td>archived</td><td>51738.73752</td><td>51738.73752</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71050</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-02-00</td><td>51740.0494</td><td>2940</td><td>1064</td><td>archived</td><td>51740.0494</td><td>51740.0494</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71052</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-03-00</td><td>51741.44572</td><td>5237</td><td>3378</td><td>archived</td><td>51741.44572</td><td>51741.44572</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71053</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-04-00</td><td>51742.50841</td><td>4596</td><td>3477</td><td>archived</td><td>51742.50841</td><td>51742.50841</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71054</td><td>SWANK</td><td>JEAN</td><td>168</td><td>50138</td><td>5</td><td>OTHER</td><td>EXO_1745-248</td><td>15000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>3</td><td>50138-03-05-00</td><td>51743.57614</td><td>4176</td><td>3038</td><td>archived</td><td>51743.57614</td><td>51743.57614</td><td>--</td><td>52122</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX1F</td><td>E_8US_256_DX1F</td><td>STANDARD1</td><td>STANDARD2</td><td>TLA_1S_10_249_1S_5000_F</td><td>CB_125US_1M_0_249_H</td><td>CB_8MS_64M_0_249_H</td><td>E_125US_64M_0_1S</td><td>3.8381</td><td>1.6836</td><td>-0.906683970297968</td><td>-0.0471604275070132</td><td>-0.419165924285443</td></tr>
<tr><td>71055</td><td>ZHANG</td><td>WILLIAM</td><td>164</td><td>50054</td><td>5</td><td>LMXB</td><td>EXO_1745-248</td><td>200000.0</td><td>267.0225</td><td>-24.7819</td><td>1</td><td>6</td><td>50054-06-02-01</td><td>51756.25972</td><td>4793</td><td>3539</td><td>archived</td><td>51756.25972</td><td>51756.25972</td><td>--</td><td>52151</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8US_256_DX0F</td><td>E_8US_256_DX0F</td><td>STANDARD1</td><td>STANDARD2</td><td>E_125US_64M_0_1S</td><td>TLA_1S_10_249_1S_10000_F</td><td>CB_125US_1M_0_249_H</td><td>IDLE</td><td>3.8381</td><td>1.6836</td><td>-0.906684262535712</td><td>-0.0471604427075212</td><td>-0.419165290444834</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>71196</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>1920.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-16-00</td><td>55684.96769</td><td>2770</td><td>1917</td><td>archived</td><td>55684.96769</td><td>55684.96769</td><td>55693</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71197</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>1670.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-17-00</td><td>55691.58411</td><td>4860</td><td>1667</td><td>archived</td><td>55691.58411</td><td>55691.58411</td><td>55699</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71198</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>2100.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-18-00</td><td>55697.92324</td><td>4419</td><td>2101</td><td>archived</td><td>55697.92324</td><td>55697.92324</td><td>55705</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71199</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>2130.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-19-00</td><td>55704.84321</td><td>4554</td><td>2130</td><td>archived</td><td>55704.84321</td><td>55704.84321</td><td>55712</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71200</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>1620.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-20-00</td><td>55711.75772</td><td>3631</td><td>1622</td><td>archived</td><td>55711.75772</td><td>55711.75772</td><td>55719</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71201</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>2010.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-21-00</td><td>55718.35848</td><td>4744</td><td>2013</td><td>archived</td><td>55718.35848</td><td>55718.35848</td><td>55726</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71202</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>2210.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-22-00</td><td>55725.37816</td><td>3388</td><td>2213</td><td>archived</td><td>55725.37816</td><td>55725.37816</td><td>55733</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71203</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>2080.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-23-00</td><td>55731.20844</td><td>4067</td><td>2078</td><td>archived</td><td>55731.20844</td><td>55731.20844</td><td>55739</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
<tr><td>71204</td><td>ALTAMIRANO</td><td>DIEGO</td><td>530</td><td>96316</td><td>15</td><td>LMXB</td><td>TERZAN_5</td><td>1930.0</td><td>267.0208</td><td>-24.7800</td><td>0</td><td>1</td><td>96316-01-24-00</td><td>55739.64314</td><td>4437</td><td>1933</td><td>archived</td><td>55739.64314</td><td>55739.64314</td><td>55749</td><td>--</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>DEFAULT</td><td>E_8us_256_DX1F</td><td>E_8us_256_DX1F</td><td>GOODXENON1_2S</td><td>GOODXENON2_2S</td><td>D_1US_0_249_1024_64S_F</td><td>STANDARD1B</td><td>STANDARD2F</td><td>D_1US_0_249_1024_64S_F</td><td>3.8389</td><td>1.6859</td><td>-0.906696760092206</td><td>-0.0471877504630087</td><td>-0.419135182780613</td></tr>
</table></div></div></div>
</div>
</section>
</section>
<section id="using-astroquery-to-fetch-datalinks-to-rxte-datasets">
<h3>Using Astroquery to fetch datalinks to RXTE datasets<a class="headerlink" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets" title="Link to this heading">#</a></h3>
<p>We’ve already figured out which HEASARC table to pull RXTE observation information from, and then used that table
to identify specific observations that might be relevant to our target source (T5X2). Our next step is to pinpoint
the exact locations of each observation’s data files.</p>
<p>Just as in the last two steps, we’re going to make use of Astroquery. The difference is, rather than dealing with tables of
observations, we now need to construct ‘datalinks’ to places where specific files for each observation are stored. In
this demonstration we’re going to pull data from the HEASARC ‘S3 bucket’, an Amazon-hosted open-source dataset
containing all of HEASARC’s data holdings.</p>
<p>For our use case, we’re going to exclude any data links that point to data directories containing <strong>non-pointing</strong> portions
of RXTE observations; in practise that means data collected during slewing before and after the observation of our
target. Slewing data can be more difficult to work with, so for this demonstration we’re going to ignore it. The
data links tell us which directories contain such data through the final character of the directory name:</p>
<ul class="simple">
<li><p><strong>A</strong> - Slewing data from before the observation.</p></li>
<li><p><strong>Z</strong> - Slewing data from after the observation.</p></li>
<li><p><strong>S</strong> - Data taken in scan mode.</p></li>
<li><p><strong>R</strong> - Data taken in a raster grid mode.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/start_guide.html">HEASARC page</a> details the standard contents of
RXTE observation directories, as well as the standard names of files and sub-directories. Section 3.3 explains
the meanings of the characters we discussed above.</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_links</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">locate_data</span><span class="p">(</span><span class="n">cut_valid_obs</span><span class="p">,</span> <span class="s2">&quot;xtemaster&quot;</span><span class="p">)</span>

<span class="c1"># Drop rows with duplicate AWS links</span>
<span class="n">data_links</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">data_links</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s2">&quot;aws&quot;</span><span class="p">)</span>

<span class="c1"># Drop rows that represent directories of slewing, scanning, or raster scanning</span>
<span class="c1">#  observation data</span>
<span class="n">non_pnting</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">data_links</span><span class="p">[</span><span class="s2">&quot;aws&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Z/&quot;</span><span class="p">,</span> <span class="s2">&quot;A/&quot;</span><span class="p">,</span> <span class="s2">&quot;S/&quot;</span><span class="p">,</span> <span class="s2">&quot;R/&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="o">==</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">data_links</span> <span class="o">=</span> <span class="n">data_links</span><span class="p">[</span><span class="n">non_pnting</span><span class="p">]</span>

<span class="n">data_links</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=10</i>
<table id="table140655651840384" class="table-striped table-bordered table-condensed">
<thead><tr><th>ID</th><th>access_url</th><th>sciserver</th><th>aws</th><th>content_length</th><th>error_message</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>byte</th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>str50</th><th>str63</th><th>int64</th><th>object</th></tr></thead>
<tr><td>ivo://nasa.heasarc/xtemaster?71049</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03-01-01/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03-01-01/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03-01-01/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71050</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03-02-00/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03-02-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03-02-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71052</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03-03-00/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03-03-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03-03-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71053</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03-04-00/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03-04-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03-04-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71054</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03-05-00/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03-05-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03-05-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71048</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO5/P50138//50138-03/</td><td>/FTP/xte/data/archive/AO5/P50138/50138-03/</td><td>s3://nasa-heasarc/xte/data/archive/AO5/P50138/50138-03/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71147</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO7/P70412//70412-01-01-00/</td><td>/FTP/xte/data/archive/AO7/P70412/70412-01-01-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO7/P70412/70412-01-01-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71082</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO7/P70412//70412-01-02-00/</td><td>/FTP/xte/data/archive/AO7/P70412/70412-01-02-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO7/P70412/70412-01-02-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71081</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO7/P70412//70412-01-03-00/</td><td>/FTP/xte/data/archive/AO7/P70412/70412-01-03-00/</td><td>s3://nasa-heasarc/xte/data/archive/AO7/P70412/70412-01-03-00/</td><td>--</td><td></td></tr>
<tr><td>ivo://nasa.heasarc/xtemaster?71081</td><td>https://heasarc.gsfc.nasa.gov/FTP/xte/data/archive/AO7/P70412//70412-01/</td><td>/FTP/xte/data/archive/AO7/P70412/70412-01/</td><td>s3://nasa-heasarc/xte/data/archive/AO7/P70412/70412-01/</td><td>--</td><td></td></tr>
</table></div></div></div>
</div>
</section>
</section>
<section id="acquiring-the-data">
<h2>2. Acquiring the data<a class="headerlink" href="#acquiring-the-data" title="Link to this heading">#</a></h2>
<p>We now know where the relevant RXTE light curves are stored in the HEASARC S3 bucket and will proceed to download
them for local use.</p>
<section id="the-easiest-way-to-download-data">
<h3>The easiest way to download data<a class="headerlink" href="#the-easiest-way-to-download-data" title="Link to this heading">#</a></h3>
<p>At this point, you may wish to simply download the entire set of files for all the observations you’ve identified.
That is easily achieved using Astroquery, with the <code class="docutils literal notranslate"><span class="pre">download_data</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code>, we just need to pass
the datalinks we found in the previous step.</p>
<p>We demonstrate this approach using the first three entries in the datalinks table, but in the following sections will
demonstrate a more complicated, but targeted, approach that will let us download the light curve files only:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Heasarc</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data_links</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Downloading data AWS S3 ... [astroquery.heasarc.core]
INFO: Enabling anonymous cloud data access ... [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-01/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/ [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-01/ [astroquery.heasarc.core]
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-only-the-archived-rxte-light-curves">
<h3>Downloading only the archived RXTE light curves<a class="headerlink" href="#downloading-only-the-archived-rxte-light-curves" title="Link to this heading">#</a></h3>
<p>Rather than downloading all files for all our observations, we will now <em>only</em> fetch those that are directly
relevant to what we want to do in this notebook - this method is a little more involved than using Astroquery, but
it is more efficient and flexible.</p>
<p>We make use of a Python module called <code class="docutils literal notranslate"><span class="pre">s3fs</span></code>, which allows us to interact with files stored on Amazon’s S3
platform through Python commands.</p>
<p>We create an <code class="docutils literal notranslate"><span class="pre">S3FileSystem</span></code> object, which lets us interact with the S3 bucket as if it were a filesystem.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Note the <code class="docutils literal notranslate"><span class="pre">anon=True</span></code> argument, as attempting access to the HEASARC S3 bucket will fail without it!</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we identify the specific files we want to download. The datalink table tells us the AWS S3 ‘path’ (the Uniform
Resource Identifier, or URI) to each observation’s data directory, the <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/start_guide.html#directories">RXTE documentation</a>
tells us that the automatically generated data products are stored in a subdirectory called ‘stdprod’, and the
<a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes/stdprod_guide.html">RXTE Guest Observer Facility (GOF) standard product guide</a>
shows us that the <strong>net</strong> light curves are named as:</p>
<ul class="simple">
<li><p><strong>xp{ObsID}_n2{energy-band}.lc</strong> - PCA</p></li>
<li><p><strong>xh{ObsID}_n{array-number}{energy-band}.lc</strong> - HEXTE</p></li>
</ul>
<p>We set up file patterns for the light curves we’re interested in, and then use the <code class="docutils literal notranslate"><span class="pre">expand_path</span></code> method of
our previously set-up S3 filesystem object to find all the files stored at each data-link’s destination that match the pattern. This is useful because the
RXTE datalinks we found might include sections of a particular observation that do not have standard products
generated, for instance, the slewing periods before/after the telescope was aligned on target.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_patts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xp*_n2*.lc.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;xh*_n0*.lc.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;xh*_n1*.lc.gz&quot;</span><span class="p">]</span>

<span class="n">all_file_patt</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_uri</span><span class="p">,</span> <span class="s2">&quot;stdprod&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">base_uri</span> <span class="ow">in</span> <span class="n">data_links</span><span class="p">[</span><span class="s2">&quot;aws&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">lc_patts</span>
<span class="p">]</span>

<span class="n">val_file_uris</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">all_file_patt</span><span class="p">)</span>
<span class="n">val_file_uris</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/stdprod/xp95437010100_n2a.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/stdprod/xp95437010100_n2b.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/stdprod/xp95437010100_n2c.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/stdprod/xp95437010100_n2d.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-01-00/stdprod/xp95437010100_n2e.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/stdprod/xp95437010200_n2a.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/stdprod/xp95437010200_n2b.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/stdprod/xp95437010200_n2c.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/stdprod/xp95437010200_n2d.lc.gz&#39;,
 &#39;nasa-heasarc/xte/data/archive/AO14/P95437/95437-01-02-00/stdprod/xp95437010200_n2e.lc.gz&#39;]
</pre></div>
</div>
</div>
</div>
<p>Now we can just use the <code class="docutils literal notranslate"><span class="pre">get</span></code> method of our S3 filesystem object to download all the valid light curve files!</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;rxte_pregen_lc&quot;</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val_file_uris</span><span class="p">,</span> <span class="n">lc_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="examining-the-archived-rxte-light-curves">
<h2>3. Examining the archived RXTE light curves<a class="headerlink" href="#examining-the-archived-rxte-light-curves" title="Link to this heading">#</a></h2>
<p>We just downloaded a lot of light curve files (over <strong>500</strong>) - they are a set of light
curves collected by PCA, HEXTE-0, and HEXTE-1 in several different energy bands, and now we ideally
want to organize and examine them.</p>
<section id="collecting-like-light-curves-together">
<h3>Collecting like light curves together<a class="headerlink" href="#collecting-like-light-curves-together" title="Link to this heading">#</a></h3>
<p>Our first step is to pool together the file names that represent T5X2 light curves from a
particular instrument in a particular energy band. Once we know which files belong together, we
can easily visualize both the short and long-term variability of our source.</p>
<p>The information required to identify the light curve’s originating instrument is contained in the file names:</p>
<ul class="simple">
<li><p>File name beginning with ‘<strong>xp</strong>’ - created from PCA data.</p></li>
<li><p>File name beginning with ‘<strong>xh</strong>’ - created from HEXTE data.</p></li>
<li><p>If the file name begins with ‘<strong>xh</strong>’ and the string after the ObsID and underscore is formatted as *0* then it is from the HEXTE-0 cluster.</p></li>
<li><p>Likewise, if it is formatted as *1* it is from the HEXTE-1 cluster</p></li>
</ul>
<p>The file names also contain a reference to the energy band of the light curve:</p>
<ul class="simple">
<li><p><strong>PCA</strong> - final character before the file extension:</p>
<ul>
<li><p><strong>a</strong>: 2–9 keV</p></li>
<li><p><strong>b</strong>: 2-4 keV</p></li>
<li><p><strong>c</strong>: 4-9 keV</p></li>
<li><p><strong>d</strong>: 9-20 keV</p></li>
<li><p><strong>e</strong>: 20-40 keV</p></li>
</ul>
</li>
<li><p><strong>HEXTE</strong> - final character before the file extension:</p>
<ul>
<li><p><strong>a</strong>: 15–30 keV</p></li>
<li><p><strong>b</strong>: 30-60 keV</p></li>
<li><p><strong>c</strong>: 60-250 keV</p></li>
</ul>
</li>
</ul>
<p>We have already encoded this information in a function defined in the ‘Global Setup: Functions’ section
near the top of this notebook, it takes a file name and returns the instrument, energy band, and ObsID.</p>
<p>For instance:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collect the names of all the light curve files we downloaded</span>
<span class="n">all_lc_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">lc_file_path</span><span class="p">)</span>

<span class="c1"># The path of the file we&#39;re using to demonstrate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">all_lc_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Call the function to extract instrument, energy band, and ObsID from an</span>
<span class="c1">#  RXTE light curve name</span>
<span class="n">rxte_lc_inst_band_obs</span><span class="p">(</span><span class="n">all_lc_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xp95437010100_n2a.lc.gz
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;PCA&#39;, &lt;Quantity [2., 9.] keV&gt;, &#39;95437010100&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-the-light-curve-files-into-python">
<h3>Loading the light curve files into Python<a class="headerlink" href="#loading-the-light-curve-files-into-python" title="Link to this heading">#</a></h3>
<p>HEASARC-archived RXTE light curves are stored as standard fits files, so the file
contents can be read in to memory using the Astropy <code class="docutils literal notranslate"><span class="pre">fits.open()</span></code> function.</p>
<p>For the purposes of this demonstration, however, we are not going to directly use
Astropy’s fits-file features. Instead, we will use the <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code> data product class
implemented in the ‘<a class="reference external" href="https://github.com/DavidT3/XGA">X-ray: Generate and Analyse (XGA)</a>’ Python module, as it provides a
convenient interface to much of the relevant information stored in a light curve
file. The <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code> class also includes useful functions to visualize the
light curves.</p>
<p>As we iterate through the downloaded RXTE light curves and set up an XGA
LightCurve instance for each, we take the additional step of grouping
light curves with the same energy band and instrument.</p>
<p>They are stored in a nested dictionary, with top level keys corresponding to the
instrument from which the light curves were generated, and the lower level keys
being the standard energy bands for each instrument. Light curves are appended to
a list, in the order that the files were listed, for each instrument-energy band
combination.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">like_lcs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">PCA_EN_BANDS</span><span class="o">.</span><span class="n">values</span><span class="p">()},</span>
    <span class="s2">&quot;HEXTE-0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">HEXTE_EN_BANDS</span><span class="o">.</span><span class="n">values</span><span class="p">()},</span>
    <span class="s2">&quot;HEXTE-1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">HEXTE_EN_BANDS</span><span class="o">.</span><span class="n">values</span><span class="p">()},</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">cur_lc_file</span> <span class="ow">in</span> <span class="n">all_lc_files</span><span class="p">:</span>
    <span class="n">cur_lc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lc_file_path</span><span class="p">,</span> <span class="n">cur_lc_file</span><span class="p">)</span>

    <span class="n">cur_inst</span><span class="p">,</span> <span class="n">cur_en_band</span><span class="p">,</span> <span class="n">cur_oi</span> <span class="o">=</span> <span class="n">rxte_lc_inst_band_obs</span><span class="p">(</span><span class="n">cur_lc_file</span><span class="p">)</span>
    <span class="n">cur_lc</span> <span class="o">=</span> <span class="n">LightCurve</span><span class="p">(</span>
        <span class="n">cur_lc_path</span><span class="p">,</span>
        <span class="n">cur_oi</span><span class="p">,</span>
        <span class="n">cur_inst</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">rel_coord_quan</span><span class="p">,</span>
        <span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;arcmin&quot;</span><span class="p">),</span>
        <span class="n">RXTE_AP_SIZES</span><span class="p">[</span><span class="n">cur_inst</span><span class="p">],</span>
        <span class="n">cur_en_band</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">cur_en_band</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">DEFAULT_TIME_BINS</span><span class="p">[</span><span class="n">cur_inst</span><span class="p">],</span>
        <span class="n">telescope</span><span class="o">=</span><span class="s2">&quot;RXTE&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">like_lcs</span><span class="p">[</span><span class="n">cur_inst</span><span class="p">][</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">cur_en_band</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_lc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examining-long-term-variability">
<h3>Examining long-term variability<a class="headerlink" href="#examining-long-term-variability" title="Link to this heading">#</a></h3>
<p>As we noted earlier, the RXTE observations that we selected were taken over the course
of more than 10 years, and as such we have the opportunity to explore how the X-ray
emission of T5X2 has altered in the long term (long term to a human anyway).</p>
<p>This is another reason that we chose to read in our archived light curves as XGA
LightCurve objects; they make it easy to manage a large collection of light curves
taken over a long period of time, organize them, and then extract some insights.</p>
<p>A list of XGA LightCurve objects can be used to set up another type of XGA
product, an <code class="docutils literal notranslate"><span class="pre">AggregateLightCurve</span></code>, which handles the management of a large, unwieldy
set of light curves. It will ensure that the light curves are sorted by time, will check
that they have consistent energy bands and time bins, and also provide a simple
way to access the data of all the constituent light curves together.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AggregateLightCurve</span></code> class also includes convenient visualization functions.</p>
<p>If the archived RXTE-PCA and HEXTE light curves had the same time bin size and energy
bands, we would be able to put them all into a single <code class="docutils literal notranslate"><span class="pre">AggregateLightCurve</span></code>, providing
convenient access to the data of all the light curves at once. We would also be able to
include light curves from other telescopes, which would also be sorted and made easily
accessible by the AggregateLightCurve object.</p>
<p>However, as the time bin sizes and energy bands are not consistent between these
instruments, we’ll have to set up a few different <code class="docutils literal notranslate"><span class="pre">AggregateLightCurve</span></code> objects:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Very ugly definition of a nested dictionary of AggregateLightCurve objects</span>
<span class="n">agg_lcs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PCA&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="n">AggregateLightCurve</span><span class="p">(</span>
            <span class="n">like_lcs</span><span class="p">[</span><span class="s2">&quot;PCA&quot;</span><span class="p">][</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">PCA_EN_BANDS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="s2">&quot;HEXTE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="n">AggregateLightCurve</span><span class="p">(</span>
            <span class="n">like_lcs</span><span class="p">[</span><span class="s2">&quot;HEXTE-0&quot;</span><span class="p">][</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
            <span class="o">+</span> <span class="n">like_lcs</span><span class="p">[</span><span class="s2">&quot;HEXTE-1&quot;</span><span class="p">][</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">HEXTE_EN_BANDS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">agg_lcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;PCA&#39;: {&#39;2.0-9.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea11d0a0&gt;,
  &#39;2.0-4.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea52ac30&gt;,
  &#39;4.0-9.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecf6ec1f10&gt;,
  &#39;9.0-20.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecf15993a0&gt;,
  &#39;20.0-40.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecf21d1a00&gt;},
 &#39;HEXTE&#39;: {&#39;15.0-30.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea67fb90&gt;,
  &#39;30.0-60.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea352840&gt;,
  &#39;60.0-250.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea6c8170&gt;}}
</pre></div>
</div>
</div>
</div>
</section>
<section id="interacting-with-aggregate-light-curves">
<h3>Interacting with aggregate light curves<a class="headerlink" href="#interacting-with-aggregate-light-curves" title="Link to this heading">#</a></h3>
<p>What you want to do with your aggregated light curve and the long-term variability
that it describes (depending on what your source is and how many times it was
observed, of course) will depend heavily on your particular science case.</p>
<p>We will now demonstrate how to access and interact with the data, using the 2–9 keV
PCA aggregate light curve as an example.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span> <span class="o">=</span> <span class="n">agg_lcs</span><span class="p">[</span><span class="s2">&quot;PCA&quot;</span><span class="p">][</span><span class="s2">&quot;2.0-9.0keV&quot;</span><span class="p">]</span>
<span class="n">demo_agg_lc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea11d0a0&gt;
</pre></div>
</div>
</div>
</div>
<section id="which-observations-contributed-data">
<h4>Which observations contributed data?<a class="headerlink" href="#which-observations-contributed-data" title="Link to this heading">#</a></h4>
<p>As <code class="docutils literal notranslate"><span class="pre">AggregateLightCurve</span></code>s are particularly well suited for providing an interface to
the time variability of a source that has been observed many times, such as T5X2, we
might conceivably lose track of which observations (denoted by their ObsID)
contributed data.</p>
<p>In this demonstration, for instance, we just identified the relevant observations and
downloaded them, without closely examining which ObsIDs we were actually using.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">obs_ids</span></code> property will return a dictionary that stores the relevant ObsIDs, with
the dictionary keys being the names of the telescopes from which the data were taken:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">obs_ids</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RXTE&#39;: [&#39;50138030100&#39;, &#39;50138030101&#39;, &#39;50138030200&#39;, &#39;50138030300&#39;,
          &#39;50138030400&#39;, &#39;50138030500&#39;, &#39;50054060100&#39;, &#39;50054060101&#39;,
          &#39;50054060200&#39;, &#39;50054060201&#39;, &#39;50054060202&#39;, &#39;50054060300&#39;,
          &#39;50054060301&#39;, &#39;50054060401&#39;, &#39;50054060402&#39;, &#39;50054060400&#39;,
          &#39;50054060403&#39;, &#39;50054060500&#39;, &#39;50054060501&#39;, &#39;50054060600&#39;,
          &#39;50054060601&#39;, &#39;50054060700&#39;, &#39;50054060701&#39;, &#39;50054060802&#39;,
          &#39;50054060900&#39;, &#39;50054060901&#39;, &#39;50054061000&#39;, &#39;50054061001&#39;,
          &#39;50054061100&#39;, &#39;50054061101&#39;, &#39;50054061102&#39;, &#39;50054061200&#39;,
          &#39;50054061201&#39;, &#39;50054061203&#39;, &#39;50054061202&#39;, &#39;50054061300&#39;,
          &#39;50054061301&#39;, &#39;50054061400&#39;, &#39;50054061401&#39;, &#39;50054061500&#39;,
          &#39;50054061501&#39;, &#39;50054061502&#39;, &#39;50054061503&#39;, &#39;70412010100&#39;,
          &#39;70412010200&#39;, &#39;70412010300&#39;, &#39;95437010100&#39;, &#39;95437010200&#39;,
          &#39;95437010201&#39;, &#39;95437010300&#39;, &#39;95437010301&#39;, &#39;95437010302&#39;,
          &#39;95437010303&#39;, &#39;95437010400&#39;, &#39;95437010401&#39;, &#39;95437010500&#39;,
          &#39;95437010501&#39;, &#39;954370106000&#39;, &#39;95437010600&#39;]}
</pre></div>
</div>
</div>
</div>
<p>Both the telescope names and the instruments associated with each ObsID are
accessible through their own properties:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">telescopes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;RXTE&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">instruments</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RXTE&#39;: {&#39;50054060100&#39;: [&#39;PCA&#39;],
          &#39;50054060101&#39;: [&#39;PCA&#39;],
          &#39;50054060200&#39;: [&#39;PCA&#39;],
          &#39;50054060201&#39;: [&#39;PCA&#39;],
          &#39;50054060202&#39;: [&#39;PCA&#39;],
          &#39;50054060300&#39;: [&#39;PCA&#39;],
          &#39;50054060301&#39;: [&#39;PCA&#39;],
          &#39;50054060400&#39;: [&#39;PCA&#39;],
          &#39;50054060401&#39;: [&#39;PCA&#39;],
          &#39;50054060402&#39;: [&#39;PCA&#39;],
          &#39;50054060403&#39;: [&#39;PCA&#39;],
          &#39;50054060500&#39;: [&#39;PCA&#39;],
          &#39;50054060501&#39;: [&#39;PCA&#39;],
          &#39;50054060600&#39;: [&#39;PCA&#39;],
          &#39;50054060601&#39;: [&#39;PCA&#39;],
          &#39;50054060700&#39;: [&#39;PCA&#39;],
          &#39;50054060701&#39;: [&#39;PCA&#39;],
          &#39;50054060802&#39;: [&#39;PCA&#39;],
          &#39;50054060900&#39;: [&#39;PCA&#39;],
          &#39;50054060901&#39;: [&#39;PCA&#39;],
          &#39;50054061000&#39;: [&#39;PCA&#39;],
          &#39;50054061001&#39;: [&#39;PCA&#39;],
          &#39;50054061100&#39;: [&#39;PCA&#39;],
          &#39;50054061101&#39;: [&#39;PCA&#39;],
          &#39;50054061102&#39;: [&#39;PCA&#39;],
          &#39;50054061200&#39;: [&#39;PCA&#39;],
          &#39;50054061201&#39;: [&#39;PCA&#39;],
          &#39;50054061202&#39;: [&#39;PCA&#39;],
          &#39;50054061203&#39;: [&#39;PCA&#39;],
          &#39;50054061300&#39;: [&#39;PCA&#39;],
          &#39;50054061301&#39;: [&#39;PCA&#39;],
          &#39;50054061400&#39;: [&#39;PCA&#39;],
          &#39;50054061401&#39;: [&#39;PCA&#39;],
          &#39;50054061500&#39;: [&#39;PCA&#39;],
          &#39;50054061501&#39;: [&#39;PCA&#39;],
          &#39;50054061502&#39;: [&#39;PCA&#39;],
          &#39;50054061503&#39;: [&#39;PCA&#39;],
          &#39;50138030100&#39;: [&#39;PCA&#39;],
          &#39;50138030101&#39;: [&#39;PCA&#39;],
          &#39;50138030200&#39;: [&#39;PCA&#39;],
          &#39;50138030300&#39;: [&#39;PCA&#39;],
          &#39;50138030400&#39;: [&#39;PCA&#39;],
          &#39;50138030500&#39;: [&#39;PCA&#39;],
          &#39;70412010100&#39;: [&#39;PCA&#39;],
          &#39;70412010200&#39;: [&#39;PCA&#39;],
          &#39;70412010300&#39;: [&#39;PCA&#39;],
          &#39;95437010100&#39;: [&#39;PCA&#39;],
          &#39;95437010200&#39;: [&#39;PCA&#39;],
          &#39;95437010201&#39;: [&#39;PCA&#39;],
          &#39;95437010300&#39;: [&#39;PCA&#39;],
          &#39;95437010301&#39;: [&#39;PCA&#39;],
          &#39;95437010302&#39;: [&#39;PCA&#39;],
          &#39;95437010303&#39;: [&#39;PCA&#39;],
          &#39;95437010400&#39;: [&#39;PCA&#39;],
          &#39;95437010401&#39;: [&#39;PCA&#39;],
          &#39;95437010500&#39;: [&#39;PCA&#39;],
          &#39;95437010501&#39;: [&#39;PCA&#39;],
          &#39;95437010600&#39;: [&#39;PCA&#39;],
          &#39;954370106000&#39;: [&#39;PCA&#39;]}}
</pre></div>
</div>
</div>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">associated_instruments</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RXTE&#39;: [&#39;PCA&#39;]}
</pre></div>
</div>
</div>
</div>
</section>
<section id="retrieving-constituent-light-curves">
<h4>Retrieving constituent light curves<a class="headerlink" href="#retrieving-constituent-light-curves" title="Link to this heading">#</a></h4>
<p>Though the AggregateLightCurve object provides a convenient way to access the data
of all the light curves that it contains, you might sometimes want to retrieve
the individual LightCurve objects.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">get_lightcurves()</span></code> method, you can retrieve LightCurve objects for
particular time chunks:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xga.products.lightcurve.LightCurve at 0x7fecea390830&gt;
</pre></div>
</div>
</div>
</div>
<p>If the AggregateLightCurve contains data from multiple instruments, telescopes, or
ObsIDs, then the <code class="docutils literal notranslate"><span class="pre">inst</span></code>, <code class="docutils literal notranslate"><span class="pre">telescope</span></code>, and <code class="docutils literal notranslate"><span class="pre">obs_id</span></code> arguments can be passed.</p>
</section>
<section id="accessing-all-data">
<h4>Accessing all data<a class="headerlink" href="#accessing-all-data" title="Link to this heading">#</a></h4>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Quantity [  94.79163,   72.70727,   96.5273 , ..., 1238.7705 , 1230.9957 ,
            1212.9932 ] ct / s&gt;,
 &lt;Quantity [2.505628, 2.216513, 2.526862, ..., 8.773673, 8.746537, 8.682692] ct / s&gt;,
 array([2.06081059e+08, 2.06081075e+08, 2.06081091e+08, ...,
        5.30035603e+08, 5.30035619e+08, 5.30035635e+08], shape=(13915,)),
 array([ 0,  0,  0, ..., 58, 58, 58], shape=(13915,)))
</pre></div>
</div>
</div>
</div>
</section>
<section id="accessing-data-for-a-specific-time-interval">
<h4>Accessing data for a specific time interval<a class="headerlink" href="#accessing-data-for-a-specific-time-interval" title="Link to this heading">#</a></h4>
<p>This part of the demonstration will show you how to access data within specific
time intervals of interest - we define the following start and stop times based
on an interesting time window discussed in <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_wind_start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2010-10-16 09:00:00&quot;</span><span class="p">)</span>
<span class="n">demo_agg_wind_stop</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2010-10-18 12:00:00&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>An AggregateLightCurve’s constituent products are organized into discrete
‘time chunks’, defined by a start and stop time that do not overlap with any other
‘time chunk’. Time chunks are sorted so that their ‘time chunk ID’, which uniquely
identifies them, represents where they are in the sorted list of time
chunks (i.e., time chunk <strong>1</strong> contains data taken after time chunk <strong>0</strong>, and so on).</p>
<p>Looking at the <code class="docutils literal notranslate"><span class="pre">time_chunk_ids</span></code> property shows us how many time chunks this
set of PCA light curves is divided into:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">time_chunk_ids</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
       51, 52, 53, 54, 55, 56, 57, 58])
</pre></div>
</div>
</div>
</div>
<p>The time intervals represented by those IDs are also accessible, with the first column
containing the start time of the time chunk, and the second column containing the
stop time. This information is available both in the form of seconds
from the reference time (<code class="docutils literal notranslate"><span class="pre">time_chunks</span></code>), and the other in the form of explicit
datetime objects (<code class="docutils literal notranslate"><span class="pre">datetime_chunks</span></code>):</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">time_chunks</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[[2.0608106 \times 10^{8},~2.0608268 \times 10^{8}],~
 [2.0612836 \times 10^{8},~2.0613007 \times 10^{8}],~
 [2.0624176 \times 10^{8},~2.0624268 \times 10^{8}],~
 [2.0636232 \times 10^{8},~2.0636559 \times 10^{8}],~
 [2.0645415 \times 10^{8},~2.0645743 \times 10^{8}],~
 [2.0654637 \times 10^{8},~2.0654925 \times 10^{8}],~
 [2.0679276 \times 10^{8},~2.0679605 \times 10^{8}],~
 [2.0706928 \times 10^{8},~2.0707156 \times 10^{8}],~
 [2.0738388 \times 10^{8},~2.0738724 \times 10^{8}],~
 [2.0764215 \times 10^{8},~2.0764557 \times 10^{8}]] \; \mathrm{s}\]</div>
</div>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[datetime.datetime(2000, 7, 13, 4, 45, 15, 562431),
        datetime.datetime(2000, 7, 13, 5, 12, 11, 562431)],
       [datetime.datetime(2000, 7, 13, 17, 53, 31, 562431),
        datetime.datetime(2000, 7, 13, 18, 22, 3, 562431)],
       [datetime.datetime(2000, 7, 15, 1, 23, 39, 562431),
        datetime.datetime(2000, 7, 15, 1, 38, 51, 562431)],
       [datetime.datetime(2000, 7, 16, 10, 52, 59, 562431),
        datetime.datetime(2000, 7, 16, 11, 47, 23, 562431)],
       [datetime.datetime(2000, 7, 17, 12, 23, 23, 562431),
        datetime.datetime(2000, 7, 17, 13, 18, 3, 562431)],
       [datetime.datetime(2000, 7, 18, 14, 0, 27, 562431),
        datetime.datetime(2000, 7, 18, 14, 48, 27, 562431)],
       [datetime.datetime(2000, 7, 21, 10, 26, 51, 562431),
        datetime.datetime(2000, 7, 21, 11, 21, 47, 562431)],
       [datetime.datetime(2000, 7, 24, 15, 15, 39, 562431),
        datetime.datetime(2000, 7, 24, 15, 53, 31, 562431)],
       [datetime.datetime(2000, 7, 28, 6, 38, 51, 562431),
        datetime.datetime(2000, 7, 28, 7, 34, 51, 562431)],
       [datetime.datetime(2000, 7, 31, 6, 23, 23, 562431),
        datetime.datetime(2000, 7, 31, 7, 20, 27, 562431)]], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">obs_ids_within_interval()</span></code> method to identify which observations
took place within a given time interval:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">obs_ids_within_interval</span><span class="p">(</span><span class="n">demo_agg_wind_start</span><span class="p">,</span> <span class="n">demo_agg_wind_stop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RXTE&#39;: [&#39;95437010400&#39;,
  &#39;95437010401&#39;,
  &#39;95437010500&#39;,
  &#39;95437010501&#39;,
  &#39;954370106000&#39;]}
</pre></div>
</div>
</div>
</div>
<p>The default behavior of this method is to
return ObsIDs of observations that overlap with the interval, but if you
pass <code class="docutils literal notranslate"><span class="pre">over_run=False</span></code> then only ObsIDs of observations that took place entirely within
the specified interval will be returned:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">obs_ids_within_interval</span><span class="p">(</span>
    <span class="n">demo_agg_wind_start</span><span class="p">,</span> <span class="n">demo_agg_wind_stop</span><span class="p">,</span> <span class="n">over_run</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;RXTE&#39;: [&#39;95437010400&#39;, &#39;95437010401&#39;, &#39;95437010500&#39;, &#39;95437010501&#39;]}
</pre></div>
</div>
</div>
</div>
<p>That method makes use of the <code class="docutils literal notranslate"><span class="pre">time_chunk_ids_within_interval()</span></code> method, which you can
use in exactly the same way to retrieve the time chunk IDs that are part of a given
time interval:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">time_chunk_ids_within_interval</span><span class="p">(</span><span class="n">demo_agg_wind_start</span><span class="p">,</span> <span class="n">demo_agg_wind_stop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([53, 54, 55, 56, 57])
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-aggregated-light-curves">
<h4>Visualizing aggregated light curves<a class="headerlink" href="#visualizing-aggregated-light-curves" title="Link to this heading">#</a></h4>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">view()</span></code> method to quickly produce a plot of the aggregated light curve, but if your
dataset covers a particularly long time period, you can end up with a very unhelpful figure:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/1251ebb4b9da11699200d49209de920c79b0c45a9f4c4fb1be70869cb5689db1.png" src="../../../_images/1251ebb4b9da11699200d49209de920c79b0c45a9f4c4fb1be70869cb5689db1.png" />
</div>
</div>
<p>To address the problems with the last figure, we could increase its size by passing a custom value to
the <code class="docutils literal notranslate"><span class="pre">figsize</span></code> argument (e.g. (30, 6)), or you could specify a particular time window to focus on:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demo_agg_lc</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
    <span class="n">interval_start</span><span class="o">=</span><span class="n">demo_agg_wind_start</span><span class="p">,</span>
    <span class="n">interval_end</span><span class="o">=</span><span class="n">demo_agg_wind_stop</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/70e105850516d5a738fb175f2207a7c8aea7b9e255194b21b9ebb10c4ad6305c.png" src="../../../_images/70e105850516d5a738fb175f2207a7c8aea7b9e255194b21b9ebb10c4ad6305c.png" />
</div>
</div>
</section>
</section>
</section>
<section id="generating-new-rxte-pca-light-curves">
<h2>4. Generating new RXTE-PCA light curves<a class="headerlink" href="#generating-new-rxte-pca-light-curves" title="Link to this heading">#</a></h2>
<p>The time bin size of archived RXTE light curves is relatively coarse, particularly compared to the time resolution
that the PCA and HEXTE instruments can achieve. Given the type of object we are investigating, we might reasonably
expect that significant emission variations might be happening at smaller time scales than our time bin size.</p>
<p>Our inspiration for this demonstration, the work by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>,
generated RXTE-PCA light curves with different time bin sizes (2-second and 1-second bins) to search for different features.</p>
<p>Also, while light curves generated within several different energy bands are included in the RXTE archive, many
science cases will require that light curves be generated in very specific energy bands.</p>
<p>The archived light curves have gotten our exploration of T5X2’s variable X-ray emission off to an excellent start, but
clearly we also need to be able to generate new versions that are tailored to our specific requirements.</p>
<p>This section of the notebook will go through the steps required to make RXTE-PCA light curves from scratch, focusing
on the two requirements mentioned above; smaller time bins, and control over light curve energy bands.</p>
<section id="downloading-specific-files-for-our-rxte-observations">
<h3>Downloading specific files for our RXTE observations<a class="headerlink" href="#downloading-specific-files-for-our-rxte-observations" title="Link to this heading">#</a></h3>
<p>Unfortunately, our first step is to spend even more time downloading data from the RXTE archive, as we previously
targeted only the archived light curve files. Making new light curves requires all the original data and many spacecraft
files.</p>
<p>The RXTE archive does not contain equivalents of the pre-cleaned event files found in many other HEASARC-hosted
high-energy telescope archives, which is why we will have to perform the calibration and reduction processes from scratch.</p>
<p>We could use the Astroquery <code class="docutils literal notranslate"><span class="pre">Heasarc.download_data()</span></code> object to download whole directories for all observations, just as
we demonstrated in the first part of Section 2, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Heasarc</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data_links</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
<p>However, to save some downloading time and storage space, we will take a slightly more complex approach
and download only the files we’re going to need to reprocess the observations and generate new light curves.</p>
<p>We defined a list of files and directories that we <em><strong>do not need</strong></em> to download (<code class="docutils literal notranslate"><span class="pre">DOWN_EXCLUDE</span></code>) in the
‘Global Setup: Constants’ section near the top of the notebook, and we will use it in combination with
the <code class="docutils literal notranslate"><span class="pre">s3fs</span></code> Python module to list and filter the files in each observation’s directory.</p>
<p>Then we will use <code class="docutils literal notranslate"><span class="pre">s3fs</span></code> to download just those files that we need:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dl</span> <span class="ow">in</span> <span class="n">data_links</span><span class="p">:</span>
    <span class="n">cur_uri</span> <span class="o">=</span> <span class="n">dl</span><span class="p">[</span><span class="s2">&quot;aws&quot;</span><span class="p">]</span>
    <span class="n">all_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="n">s3</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span>
            <span class="n">cur_uri</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">down_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">all_cont</span><span class="p">,</span> <span class="n">DOWN_EXCLUDE</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">down_cont</span> <span class="o">=</span> <span class="n">all_cont</span><span class="p">[</span><span class="n">down_mask</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">infer_oi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cur_uri</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">cur_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">infer_oi</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cur_out</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cur_down_cont</span> <span class="ow">in</span> <span class="n">down_cont</span><span class="p">:</span>
        <span class="n">s3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cur_down_cont</span><span class="p">,</span> <span class="n">cur_out</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We note that it is generally recommended to reprocess high-energy event lists taken
from HEASARC mission archives from scratch, as it means that the latest calibration and filtering
procedures can be applied.</p>
</div>
</section>
<section id="running-the-rxte-pca-preparation-pipeline">
<h3>Running the RXTE-PCA preparation pipeline<a class="headerlink" href="#running-the-rxte-pca-preparation-pipeline" title="Link to this heading">#</a></h3>
<p>A convenient pipeline to prepare RXTE-PCA data for use is included in the HEASoft
package - <code class="docutils literal notranslate"><span class="pre">pcaprepobsid</span></code>. It will take us from raw RXTE-PCA data to the science-ready
data and filter files required to generate light curves in a later step - the PCA team
recommended the default configuration of the pipeline for general scientific use.</p>
<p>Now we have to talk about the slightly unusual nature of RXTE-PCA observations; the
PCA proportional counter units could be simultaneously read out in various
‘data modes’. That meant that some limitations of the detectors and electronics could
be mitigated by using data from the different modes in different parts of your
analysis.</p>
<p>At least 10 different data modes could be requested by the observer, but the
‘Standard-1’ and ‘Standard-2’ modes were active for every observation.</p>
<p>The RXTE-PCA instrument had very high temporal and moderate spectral
resolutions, but both could not be true at the same time. The ‘Standard-1’ and
‘Standard-2’ modes ‘binned’ the readout from the detectors in two different ways:</p>
<ul class="simple">
<li><p><strong>Standard 1</strong> - accumulated the combined readout from all detector channels, with a time resolution of 0.125 seconds.</p></li>
<li><p><strong>Standard 2</strong> - accumulated the 256 detector channels binned into 129 ‘Standard 2’ channels, with a time resolution of 16 seconds.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Standard-2 data mode is the most commonly used and supported.</p>
</div>
<p>We are using the HEASoftPy interface to the <code class="docutils literal notranslate"><span class="pre">pcaprepobsid</span></code> task, but wrap it in
another function (defined in the ‘Global Setup’ section) that makes it easier for us
to run the processing of different observation’s PCA data in parallel.</p>
<p>As the initial processing of raw data is the step in any analysis most likely
to error, we have made sure that the wrapper function returns information on whether
the processing failed, the logs, and the relevant ObsID. That makes
it easy for us to identify problem ObsIDs.</p>
<p>Now we run the pipeline for all of our selected RXTE observations:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">arg_combs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">oi</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">oi</span><span class="p">),</span> <span class="n">rel_coord</span><span class="p">]</span> <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span><span class="p">]</span>
    <span class="n">pipe_result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">process_rxte_pca</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>

<span class="n">pca_pipe_problem_ois</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">all_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">all_out</span> <span class="ow">in</span> <span class="n">pipe_result</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="ow">or</span> <span class="s2">&quot;Task pcaprepobsid 1.4 terminating with status -1&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_out</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">]</span>
<span class="n">rel_obsids</span> <span class="o">=</span> <span class="p">[</span><span class="n">oi</span> <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span> <span class="k">if</span> <span class="n">oi</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pca_pipe_problem_ois</span><span class="p">]</span>

<span class="n">pca_pipe_problem_ois</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/heasoft/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2038) is multi-threaded, use of fork() may lead to deadlocks in the child.
  self.pid = os.fork()
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;50054-06-08-00&#39;, &#39;50054-06-08-01&#39;, &#39;50054-06-08-03&#39;, &#39;50054-06-08-04&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-up-rxte-pca-good-time-interval-gti-files">
<h3>Setting up RXTE-PCA good time interval (GTI) files<a class="headerlink" href="#setting-up-rxte-pca-good-time-interval-gti-files" title="Link to this heading">#</a></h3>
<p>The RXTE-PCA data for our observations of T5X2 are now (sort of) ready for use!</p>
<p>Though the observation data files have been prepared, we do still need to define
‘good time interval’ (GTI) files for each observation. These will combine the filter
file produced by <code class="docutils literal notranslate"><span class="pre">pcaprepobsid</span></code>, which is determined by various spacecraft orbit and
electronics housekeeping considerations, with another user-defined filtering expression.</p>
<p>The user-defined filter is highly customizable, but we will use the expression
recommended (see the note below for the source of this recommendation) to
apply ‘basic’ screening to RXTE-PCA observations of a bright target:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recommended filtering expression from RXTE cookbook pages</span>
<span class="n">filt_expr</span> <span class="o">=</span> <span class="s2">&quot;(ELV &gt; 4) .AND. (OFFSET &lt; 0.1) .AND. (NUM_PCU_ON &gt; 0 .AND. NUM_PCU_ON &lt; 6)&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Breaking down the terms of the filter expression:</p>
<ul class="simple">
<li><p><strong>ELV &gt; 4</strong> - Ensures that the target is above the Earth’s horizon. More conservative limits (e.g. &gt; 10) will make sure that ‘bright earth’ is fully screened out, but this value is sufficient for many cases.</p></li>
<li><p><strong>OFFSET &lt; 0.1</strong> - Makes sure that PCA is pointed at the target to within 0.1 degrees.</p></li>
<li><p><strong>NUM_PCU_ON &gt; 0 .AND. NUM_PCU_ON &lt; 6</strong> - Ensures that at least one of the five proportional counter units is active.</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>An <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes2/Screening.html?QuickLinksMenu=/vo/">in-depth discussion</a> of how
to screen/filter RXTE-PCA data is available on the HEASARC website.</p>
</div>
<p>Now that we’ve settled on the filtering expression, the <code class="docutils literal notranslate"><span class="pre">maketime</span></code> HEASoft task can
be used to make the final GTI files for each observation. Another wrapper function to
the HEASoftPy <code class="docutils literal notranslate"><span class="pre">maketime</span></code> interface is declared, and we again execute the task in parallel:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">arg_combs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">oi</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">oi</span><span class="p">),</span> <span class="n">filt_expr</span><span class="p">]</span> <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span><span class="p">]</span>
    <span class="n">gti_result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">gen_pca_gti</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="new-light-curves-within-custom-energy-bounds">
<h3>New light curves within custom energy bounds<a class="headerlink" href="#new-light-curves-within-custom-energy-bounds" title="Link to this heading">#</a></h3>
<p>Recall that we want to generate two categories of custom light curves; those within
custom energy bands, and those with time resolution better than 16 seconds.</p>
<p>We’ll tackle the custom energy band light curves first, as they use the more common
data mode, ‘Standard-2’. The generation of these light curves will be
straightforward, as HEASoft includes a task called <code class="docutils literal notranslate"><span class="pre">pcaextlc2</span></code> for exactly this
purpose.</p>
<p>As previously mentioned, the RXTE-PCA instrument is made up of five separate
proportional counter units (PCUs). The state and reliability of those PCUs varied
significantly over the lifetime of the mission, so we do not necessarily use want to
use data from all five.</p>
<p>PCU 2 was considered the most reliable, and so we are going to use that for our newly
generated light curves.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chos_pcu_id</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default behaviour of PCA light curve generation functions in HEASoft is to use all
available PCUs, in which case a combined light curve is produced. We have set up
our wrapper functions for the light curve generation tasks so that a single PCU
or a list of PCUs can be passed.</p>
</div>
<p>The slight sticking point is that <code class="docutils literal notranslate"><span class="pre">pcaextlc2</span></code> takes arguments of upper and
lower <strong>absolute channel</strong> limits to specify which band the output light curve should be
generated within. Our particular science case will inform us which <strong>energy</strong> bands
we should look at, but we have to convert them to channels ourselves.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>It is important to make a distinction between RXTE-PCA <strong>‘Standard-2’</strong> channels (which
have values between 0 and 128) and PCA’s <strong>absolute</strong> channels (which have values between
0 and 255). Standard-2 is a <em>binned</em> data mode, and its channels represent combinations
of absolute channels.</p>
</div>
<p>We need to convert our energy bands (whatever we decide they will be) to the
equivalent <strong>absolute</strong> channels. HEASARC <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/e-c_table.html">provides a table</a> that describes the
mapping of absolute channels to ‘Standard-2’ channels and energies at different
epochs in the life of the telescope.</p>
<p>You could quite easily use this to convert from your target energy band to the
absolute channel limits, but when dealing with many archival observations from
different epochs, it is more convenient to implement a more automated solution.</p>
<section id="building-rxte-pca-response-files">
<h4>Building RXTE-PCA response files<a class="headerlink" href="#building-rxte-pca-response-files" title="Link to this heading">#</a></h4>
<p>That automated method of converting from energy to channel involves:</p>
<ol class="arabic simple">
<li><p>Generating new RXTE-PCA response files for each observation</p></li>
<li><p>Using the “EBOUNDS” table of responses to move from energy to ‘Standard-2’ channel</p></li>
<li><p>Finally, using the known binning of ‘Standard-2’ channels to arrive at the absolute channel limits.</p></li>
</ol>
<p>We note that as some, but not all, ‘Standard-2’ channels correspond to a range
of absolute channels, the mean value of the absolute channel range is used, and rounded
down to the nearest integer for the lower limit, and rounded up to the nearest integer
for the upper limit.</p>
<p>Rather than using the HEASoft tool specifically for generating RXTE-PCA RMFs, we
cheat a little and use the HEASoft tool designed to produce spectra (and supporting
files) from RXTE-PCA data; <code class="docutils literal notranslate"><span class="pre">pcaextspect2</span></code>.</p>
<p>The advantage of this is that <code class="docutils literal notranslate"><span class="pre">pcaextspect2</span></code> will automatically handle the combination
of responses from different PCUs, which would not be necessary for our use of PCU 2, but
makes it easier to use multiple PCUs if you choose.</p>
<p>As with the other HEASoft tasks, we write a wrapper function for the HEASoftPy
interface in order to run the task in parallel:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">arg_combs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">oi</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">oi</span><span class="p">),</span> <span class="n">chos_pcu_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span><span class="p">]</span>
    <span class="n">rsp_result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">gen_pca_s2_spec_resp</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The response files produced by <code class="docutils literal notranslate"><span class="pre">pcaextspect2</span></code> are a combination of the ARF and RMF
products commonly seen in high energy astrophysics data.</p>
</div>
<p>To make the next step easier, we set up a template for the path to the response files
we just generated:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsp_path_temp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{oi}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;rxte-pca-pcu</span><span class="si">{sp}</span><span class="s2">-</span><span class="si">{oi}</span><span class="s2">.rsp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generating-the-light-curves">
<h4>Generating the light curves<a class="headerlink" href="#generating-the-light-curves" title="Link to this heading">#</a></h4>
<p>Now that the response files have been generated, we can create our new light curves!</p>
<p>The first step is to decide on the lower and upper limits of the energy band(s) we want
the light curve(s) to be drawn from. We also define the time bin size to use, remembering
that the ‘Standard-2’ data mode required for applying energy bounds has
a minimum time resolution of 16 seconds.</p>
<p>We choose to build light curves in three custom energy bands:</p>
<ul class="simple">
<li><p>2-10 keV</p></li>
<li><p>10-30 keV</p></li>
<li><p>2-60 keV</p></li>
</ul>
<p>These selections are fairly arbitrary and aren’t physically justified, but yours
should be informed by your science case. If you are using this code as a template
for your own analysis, you could add more energy bands to the <code class="docutils literal notranslate"><span class="pre">new_lc_en_bnds</span></code> list,
and they would be generated as well.</p>
<p>We choose a time bin size of 16 seconds, as this is a bright source and we wish
for the best possible temporal resolution.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_lc_en_bnds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Quantity</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="n">Quantity</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
    <span class="n">Quantity</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">en_time_bin_size</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can run the <code class="docutils literal notranslate"><span class="pre">pcaextlc2</span></code> task to generate the light curves. We note that the
wrapper function we create for the HEASoftPy interface to <code class="docutils literal notranslate"><span class="pre">pcaextlc2</span></code> includes
extra processing steps that use the supplied lower and upper energy limits and
response file to determine the absolute channel limits. Please examine the
wrapper function defined in the ‘Global Setup’ section for more details.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">form_sel_pcu</span> <span class="o">=</span> <span class="n">pca_pcu_check</span><span class="p">(</span><span class="n">chos_pcu_id</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">arg_combs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="n">oi</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">oi</span><span class="p">),</span>
            <span class="o">*</span><span class="n">cur_bnds</span><span class="p">,</span>
            <span class="n">rsp_path_temp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oi</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">sp</span><span class="o">=</span><span class="n">form_sel_pcu</span><span class="p">),</span>
            <span class="n">en_time_bin_size</span><span class="p">,</span>
            <span class="n">chos_pcu_id</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span>
        <span class="k">for</span> <span class="n">cur_bnds</span> <span class="ow">in</span> <span class="n">new_lc_en_bnds</span>
    <span class="p">]</span>
    <span class="n">lc_en_result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">gen_pca_s2_light_curve</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we set up a template for the path to the light curves we just generated:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_path_temp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{oi}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;rxte-pca-pcu</span><span class="si">{sp}</span><span class="s2">-</span><span class="si">{oi}</span><span class="s2">-en</span><span class="si">{lo}</span><span class="s2">_</span><span class="si">{hi}</span><span class="s2">keV-tb</span><span class="si">{tb}</span><span class="s2">s-lightcurve.fits&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-the-light-curves-into-python">
<h4>Loading the light curves into Python<a class="headerlink" href="#loading-the-light-curves-into-python" title="Link to this heading">#</a></h4>
<p>Our shiny new custom-energy-band light curves can be loaded into convenient XGA LightCurve
objects, just as the archived light curves were - they will once again provide a
convenient interface to the data, and some nice visualization capabilities.</p>
<p>As we set up the energy bands in which to generate new light curves as a list of
Astropy quantities (which you may add to or remove from for your own purposes), and we
know the format of the output file names (as we set that up), we can dynamically
load in those light curves.</p>
<p>Iterating through the energy bounds, and the relevant ObsIDs, every new light curve
file gets its own LightCurve object, and is then appended to a list in a dictionary
with energy bands as keys.</p>
<p>From there, one aggregate light curve per energy band is set up and also stored in a
dictionary for easy (and dynamic) access:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_en_bnd_lcs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">cur_bnd</span> <span class="ow">in</span> <span class="n">new_lc_en_bnds</span><span class="p">:</span>
    <span class="n">cur_bnd_key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2">keV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">cur_bnd</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">gen_en_bnd_lcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cur_bnd_key</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span><span class="p">:</span>
        <span class="n">cur_lc_path</span> <span class="o">=</span> <span class="n">lc_path_temp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">oi</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span>
            <span class="n">sp</span><span class="o">=</span><span class="n">form_sel_pcu</span><span class="p">,</span>
            <span class="n">tb</span><span class="o">=</span><span class="n">en_time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">lo</span><span class="o">=</span><span class="n">cur_bnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">hi</span><span class="o">=</span><span class="n">cur_bnd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cur_lc</span> <span class="o">=</span> <span class="n">LightCurve</span><span class="p">(</span>
            <span class="n">cur_lc_path</span><span class="p">,</span>
            <span class="n">oi</span><span class="p">,</span>
            <span class="s2">&quot;PCA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">rel_coord_quan</span><span class="p">,</span>
            <span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;arcmin&quot;</span><span class="p">),</span>
            <span class="n">RXTE_AP_SIZES</span><span class="p">[</span><span class="s2">&quot;PCA&quot;</span><span class="p">],</span>
            <span class="o">*</span><span class="n">cur_bnd</span><span class="p">,</span>
            <span class="n">en_time_bin_size</span><span class="p">,</span>
            <span class="n">telescope</span><span class="o">=</span><span class="s2">&quot;RXTE&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gen_en_bnd_lcs</span><span class="p">[</span><span class="n">cur_bnd_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_lc</span><span class="p">)</span>

<span class="c1"># Set up the aggregate light curves</span>
<span class="n">agg_gen_en_bnd_lcs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">cur_bnd_key</span><span class="p">:</span> <span class="n">AggregateLightCurve</span><span class="p">(</span><span class="n">cur_bnd_lcs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cur_bnd_key</span><span class="p">,</span> <span class="n">cur_bnd_lcs</span> <span class="ow">in</span> <span class="n">gen_en_bnd_lcs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Show the structure of the agg_gen_en_bnd_lcs dictionary</span>
<span class="n">agg_gen_en_bnd_lcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;2.0-10.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fecea1b7980&gt;,
 &#39;10.0-30.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fee4d9b1070&gt;,
 &#39;2.0-60.0keV&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fee4da0b3b0&gt;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-new-custom-energy-band-light-curves">
<h4>Visualizing new custom-energy-band light curves<a class="headerlink" href="#visualizing-new-custom-energy-band-light-curves" title="Link to this heading">#</a></h4>
<p>The first thing to do is to take a look at one of our new light curves to make sure
that (on the surface at least) everything looks reasonably sensible.</p>
<p>You should really examine the whole aggregation of new light curves in a particular
energy band, but for demonstrative purposes we’ll look at a two-week time window:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;2.0-10.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">interval_start</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-07-13 05:00:00&quot;</span><span class="p">),</span>
    <span class="n">interval_end</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-08-03&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f9205a93e5d5f4b8a5b8ca1eb68d5f4db6fd2ca18fbfb5bb9d76be8be49d9193.png" src="../../../_images/f9205a93e5d5f4b8a5b8ca1eb68d5f4db6fd2ca18fbfb5bb9d76be8be49d9193.png" />
</div>
</div>
</section>
<section id="calculating-and-examining-hardness-ratio-curves">
<h4>Calculating and examining hardness ratio curves<a class="headerlink" href="#calculating-and-examining-hardness-ratio-curves" title="Link to this heading">#</a></h4>
<p>Being able to generate light curves within energy bands of our choice will be a
useful tool for many science cases; for instance, sometimes you wish to target
particular emission mechanisms that produce X-ray photons of a certain energy.</p>
<p>Sometimes you take a broader view and simply want to know if the variation in
emission is distinct between the ‘soft’ X-ray band to the ‘hard’ X-ray band (exactly what
defines ‘hard’ and ‘soft’ will vary depending on your specialization, the telescope
you’re using, and sometimes just how you feel on a particular day).</p>
<p>In either case it is often useful to visualize a ‘hardness curve’ which shows how the
‘hardness ratio’ of two energy bands changes with time. There are multiple definitions
of the hardness ratio, but for our purposes we’ll use:</p>
<div class="math notranslate nohighlight">
\[\rm{HR}_{{H:S}} = \frac{F_{H} - F_{S}}{F_{H} + F_{S}}.\]</div>
<p>Where <span class="math notranslate nohighlight">\(\rm{HR}_{{H:S}}\)</span> is the hard-to-soft band ratio, <span class="math notranslate nohighlight">\(F_{H}\)</span> is the flux in the hard band,
and <span class="math notranslate nohighlight">\(F_{S}\)</span> is the flux in the soft band.</p>
<p>Hardness curves can be considered as a short-cut to the sort of information extracted from
time-resolved spectroscopy (which is outside the scope of this tutorial).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Our calculation of hardness ratio is fairly simplistic - there are better approaches
that take into account the often-Poissian nature of X-ray light curve data points, and
calculate uncertainties on the ratio. See the
<a class="reference external" href="https://cxc.cfa.harvard.edu/csc/columns/spectral_properties.html">Chandra Source Catalog hardness ratio</a> page for an example.</p>
</div>
<p>We will choose a single observation to visualize the hardness ratio curve for, just for
ease of viewing; there is no reason you could not use the same approach for all
observations.</p>
<p>Three energy-bands were chosen when we generated the new light curves earlier in this
section, and we will choose the 2.0–10 keV as the soft band, and the 10.0–30 keV as
the hard band:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hard_rat_ch_id</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">lo_en_demo_lc</span> <span class="o">=</span> <span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;2.0-10.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">hard_rat_ch_id</span><span class="p">)</span>
<span class="n">hi_en_demo_lc</span> <span class="o">=</span> <span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;10.0-30.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">hard_rat_ch_id</span><span class="p">)</span>

<span class="n">hard_rat</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span> <span class="o">-</span> <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span> <span class="o">+</span> <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The figure we produce plots the two light curves on the same axis, and then the calculated hardness curve
on a second axis below. As such, we can both see the original behaviors evident in the light curves, and how
the hardness ratio changes for those behaviors.</p>
<p>We find that the hardness ratio is effectively constant for much of the chosen
observation, and that the approximately constant value indicates that more
emission is detected in the soft band than the hard.</p>
<p>Interestingly, when we see a very large increase in emission from a burst, the hardness
ratio drops significantly, becoming even more negative. Thinking back to the hardness
ratio definition, it is clear that these large bursts emit more photons in the
soft-band (2–10 keV in this case) than the hard-band (10–30 keV).</p>
<p>Interpreting this sort of behavior is heavily dependent on your science case and the
astrophysics involved in whatever object you are studying. However, our initial hypothesis
here might be that the large bursts originate from a different mechanism than the
smaller variations in emission we see elsewhere in the light curves.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Currently no convenient XGA method to define HardnessCurves and plot them, so</span>
<span class="c1">#  we&#39;ll do it manually</span>
<span class="c1"># Set up a two-panel figure, with the top panel taller than the bottom. Also</span>
<span class="c1">#  include sharex=col to join the x-axis (time) of the two panels</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">)</span>
<span class="c1"># Shrink the vertical gap between the panels to zero</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Set up ticks for both axes</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ax_arr</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot the light curves on the same axis (top panel)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2"> keV RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">energy_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">energy_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkcyan&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">-</span><span class="si">{1}</span><span class="s2"> keV RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">energy_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">hi_en_demo_lc</span><span class="o">.</span><span class="n">energy_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="c1"># Add a legend to distinguish between the two light curves</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="c1"># Set up the y-axis label</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count Rate [ct s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Plot the previously-calculated hardness curve on the bottom panel</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lo_en_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">hard_rat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">)</span>
<span class="c1"># Label the y-axis</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Hardness Ratio&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># Label the x-axis. Note that we didn&#39;t do this for the light curve axis</span>
<span class="c1">#  because the vertical gap between the two panels is zero, and they</span>
<span class="c1">#  share the same x-axis anyway</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Format the datetimes on the x-axis in an easier-to-read way</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/16c4f54c0901429aedced31c17d88546a427763c9df324a1a9ae655dc7b91a83.png" src="../../../_images/16c4f54c0901429aedced31c17d88546a427763c9df324a1a9ae655dc7b91a83.png" />
</div>
</div>
</section>
</section>
<section id="new-light-curves-with-high-temporal-resolution">
<h3>New light curves with high temporal resolution<a class="headerlink" href="#new-light-curves-with-high-temporal-resolution" title="Link to this heading">#</a></h3>
<p>Addressing our other reason for generating new light curves, we can now use the
‘Standard-1’ data mode to achieve a much finer temporal resolution than the ‘Standard-2’ mode.</p>
<p>We select a time bin size of 2 seconds to match the temporal resolution of the
RXTE-PCA light curves that <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>
used to identify T5X2 bursts:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_lc_time_bin_sizes</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is still considerably oversampling the potential time resolution for ‘Standard-1’
data, as it is binned into 0.125 second chunks.</p>
<section id="generating-new-light-curves">
<h4>Generating new light curves<a class="headerlink" href="#generating-new-light-curves" title="Link to this heading">#</a></h4>
<p>Unlike when we made new light curves within a custom energy band, we don’t need to
worry about converting from energy to channels as, unfortunately, ‘Standard-1’ data
does not contain any spectral information.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Though ‘Standard-1’ data contains no spectral information (as it consists of the
combined readout from all detector channels) the <code class="docutils literal notranslate"><span class="pre">pcaextlc1</span></code> HEASoft task does
take minimum and maximum channel arguments - <strong>do not use them</strong>.</p>
</div>
<p>Here we wrap and run the <code class="docutils literal notranslate"><span class="pre">pcaextlc1</span></code> task in parallel, just as we did <code class="docutils literal notranslate"><span class="pre">pcaextlc2</span></code> in the last section:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">form_sel_pcu</span> <span class="o">=</span> <span class="n">pca_pcu_check</span><span class="p">(</span><span class="n">chos_pcu_id</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">arg_combs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="n">oi</span><span class="p">,</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">oi</span><span class="p">),</span>
            <span class="n">cur_tsz</span><span class="p">,</span>
            <span class="n">chos_pcu_id</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span>
        <span class="k">for</span> <span class="n">cur_tsz</span> <span class="ow">in</span> <span class="n">new_lc_time_bin_sizes</span>
    <span class="p">]</span>
    <span class="n">lc_result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">gen_pca_s1_light_curve</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/heasoft/lib/python3.12/multiprocessing/popen_fork.py:66: DeprecationWarning: This process (pid=2038) is multi-threaded, use of fork() may lead to deadlocks in the child.
  self.pid = os.fork()
</pre></div>
</div>
</div>
</div>
<p>Finally, we set up a template for the path to the light curves we just generated:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_hi_res_path_temp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{oi}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;rxte-pca-pcu</span><span class="si">{sp}</span><span class="s2">-</span><span class="si">{oi}</span><span class="s2">-enALL-tb</span><span class="si">{tb}</span><span class="s2">s-lightcurve.fits&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h4>Loading the light curves into Python<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Just as we did for the archived light curves and the newly generated energy-bound
light curves, we will load the new files into XGA LightCurve objects, and from there
into an AggregateLightCurve per time-bin-size:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_hi_time_res_lcs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">cur_tsz</span> <span class="ow">in</span> <span class="n">new_lc_time_bin_sizes</span><span class="p">:</span>
    <span class="n">cur_tsz_key</span> <span class="o">=</span> <span class="n">cur_tsz</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">gen_hi_time_res_lcs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cur_tsz_key</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="n">rel_obsids</span><span class="p">:</span>
        <span class="n">cur_lc_path</span> <span class="o">=</span> <span class="n">lc_hi_res_path_temp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">oi</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">sp</span><span class="o">=</span><span class="n">form_sel_pcu</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="n">cur_tsz</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

        <span class="n">cur_lc</span> <span class="o">=</span> <span class="n">LightCurve</span><span class="p">(</span>
            <span class="n">cur_lc_path</span><span class="p">,</span>
            <span class="n">oi</span><span class="p">,</span>
            <span class="s2">&quot;PCA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">rel_coord_quan</span><span class="p">,</span>
            <span class="n">Quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;arcmin&quot;</span><span class="p">),</span>
            <span class="n">RXTE_AP_SIZES</span><span class="p">[</span><span class="s2">&quot;PCA&quot;</span><span class="p">],</span>
            <span class="n">Quantity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
            <span class="n">Quantity</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;keV&quot;</span><span class="p">),</span>
            <span class="n">cur_tsz</span><span class="p">,</span>
            <span class="n">telescope</span><span class="o">=</span><span class="s2">&quot;RXTE&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gen_hi_time_res_lcs</span><span class="p">[</span><span class="n">cur_tsz_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_lc</span><span class="p">)</span>

<span class="c1"># Set up the aggregate light curves</span>
<span class="n">agg_gen_hi_time_res_lcs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">cur_tsz_key</span><span class="p">:</span> <span class="n">AggregateLightCurve</span><span class="p">(</span><span class="n">cur_tsz_lcs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cur_tsz_key</span><span class="p">,</span> <span class="n">cur_tsz_lcs</span> <span class="ow">in</span> <span class="n">gen_hi_time_res_lcs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Show the structure of the agg_gen_hi_time_res_lcs dictionary</span>
<span class="n">agg_gen_hi_time_res_lcs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;1.0s&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fee4cd12300&gt;,
 &#39;2.0s&#39;: &lt;xga.products.lightcurve.AggregateLightCurve at 0x7fee4d25ae40&gt;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-new-higher-time-resolution-light-curves">
<h4>Visualizing new higher time-resolution light curves<a class="headerlink" href="#visualizing-new-higher-time-resolution-light-curves" title="Link to this heading">#</a></h4>
<p>We can now visually examine the new higher-temporal-resolution light curves. It is
always good practice to visually examine your data, as it can help you spot any
potential problems, as well as any interesting features.</p>
<p>There are new light curves with both one-second and two-second time bins, but here we
will select the highest-resolution option to examine.</p>
<p>Rather than looking at the whole aggregate light curve, we choose a small date range
to increase the interpretability of the output figure:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agg_gen_hi_time_res_lcs</span><span class="p">[</span><span class="s2">&quot;1.0s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">interval_start</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-07-13 05:00:00&quot;</span><span class="p">),</span>
    <span class="n">interval_end</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-08-03&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2a9e5509676dc2dba40c6940074331f427570dc069a2dd7ee4abdcf4aaa90d54.png" src="../../../_images/2a9e5509676dc2dba40c6940074331f427570dc069a2dd7ee4abdcf4aaa90d54.png" />
</div>
</div>
<p>To give a sense of how the finer temporal bins might affect our interpretation of
our source’s (T5X2) time-varying behavior, we are going to plot a single
observation’s light curve generated with one, two, and sixteen second time bins.</p>
<p>The sixteen-second time bin light curve is in the same energy band as the two
fine-temporal-resolution light curves (2–60 keV), and was generated in the
“New light curves within custom energy bounds” section of this notebook.</p>
<p>We access the relevant aggregate light curves and extract a single light curve from
each - the selected light curves are all from the same time bin (thus observation), as
we wish to compare like-to-like:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tbin_comp_ch_id</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">onesec_demo_lc</span> <span class="o">=</span> <span class="n">agg_gen_hi_time_res_lcs</span><span class="p">[</span><span class="s2">&quot;1.0s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">tbin_comp_ch_id</span><span class="p">)</span>
<span class="n">twosec_demo_lc</span> <span class="o">=</span> <span class="n">agg_gen_hi_time_res_lcs</span><span class="p">[</span><span class="s2">&quot;2.0s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">tbin_comp_ch_id</span><span class="p">)</span>

<span class="n">sixteensec_demo_lc</span> <span class="o">=</span> <span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;2.0-60.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">tbin_comp_ch_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plotting the light curves on the same axis is an excellent demonstration of
<strong>why</strong> we bothered to make new light curves with finer time binning in the first
place.</p>
<p>The default sixteen-second binning clearly obfuscates many of the smaller, shorter
timescale, variations in T5X2’s 2–60 keV X-ray emission. Larger features are still
clear, though broadened by the coarser time bins, but finer time bins reveal a lot
of interesting features:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># There is currently no XGA-native way to plot curves with different time bins</span>
<span class="c1">#  on the same axis, so we will do it ourselves</span>

<span class="c1"># Sets up a figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># Formats the number and appearance of the y and x axis ticks</span>
<span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot the three light curves, including count-rate uncertainties</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tan&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># We added labels to each plot, so will include a legend to help identify the</span>
<span class="c1">#  different curves</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="c1"># Label the axes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count Rate [ct s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># The x-axis data were in the form of datetimes, and we can use a matplotlib</span>
<span class="c1">#  formatted to ensure that the tick labels are displayed correctly</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="c1"># We also rotate the tick labels to make them easier to read</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="c1"># The overall view of one observation&#39;s light curve is still a little too broad</span>
<span class="c1">#  to really see the detailed differences that time bin size makes, so we will</span>
<span class="c1">#  also include an inset zoom.</span>
<span class="c1"># These are the zoom start and end times</span>
<span class="n">zoom_start</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-07-31 06:36:00&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>
<span class="n">zoom_end</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-07-31 06:39:00&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

<span class="c1"># Add an inset axes that the zoomed view will be plotted in</span>
<span class="c1">#  The list of numbers as the first argument defines the position of the lower left</span>
<span class="c1">#  corner, and the size, of the axis</span>
<span class="n">axins</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">zoom_start</span><span class="p">,</span> <span class="n">zoom_end</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="p">[],</span>
<span class="p">)</span>
<span class="c1"># Once again format the ticks</span>
<span class="n">axins</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to plot the same information again on the new axis</span>
<span class="n">axins</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tan&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">onesec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">twosec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
    <span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">count_rate_err</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> s RXTE-PCA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sixteensec_demo_lc</span><span class="o">.</span><span class="n">time_bin_size</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># We don&#39;t include axis labels on the inset zoom, as we found them to be</span>
<span class="c1">#  small, visually confusing, and ultimately not necessary due to the presence</span>
<span class="c1">#  of the main plot</span>

<span class="c1"># Adds nice boxes and lines between the zoomed region on the main axis and</span>
<span class="c1">#  the new inset axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/6b83b882cc7f48bf5760496f4bbfe0bdab75ff902b6ff6a523bd1055677ef1db.png" src="../../../_images/6b83b882cc7f48bf5760496f4bbfe0bdab75ff902b6ff6a523bd1055677ef1db.png" />
</div>
</div>
</section>
</section>
</section>
<section id="experimenting-with-an-automated-method-to-identify-bursts">
<h2>5. Experimenting with an automated method to identify bursts<a class="headerlink" href="#experimenting-with-an-automated-method-to-identify-bursts" title="Link to this heading">#</a></h2>
<p>For the final step of this demonstration, we will experiment with automated ways to
identify when T5X2 bursts occur. The work by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>
that inspired this tutorial identified bursts by manual inspection of light curves with
two-second time resolution.</p>
<p>Manual inspection by experts is often the most reliable way to identify features like
bursts, even though it is <em>possible</em> it may introduce unquantifiable human error and
biases.</p>
<p>Such manual inspection is unfortunately very time-consuming, and factors such as
decision fatigue (see <a class="reference external" href="https://www.tandfonline.com/doi/full/10.1080/17437199.2025.2513916">M. Maier et al. 2024</a>, for a review of decision fatigue
in medical decision-making) can cause a variation in the inspector’s performance
over the course of the task.</p>
<p>As such, and because it is an interesting thing to do with the light curves we have
just generated, we will attempt the same task algorithmically.</p>
<p>We match the light curves used for burst identification by
<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>,
choosing our new two-second time bin light curves to experiment with. An individual
light curve from that aggregated light curve is also selected for testing purposes:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">burst_id_demo_agg_lc</span> <span class="o">=</span> <span class="n">agg_gen_hi_time_res_lcs</span><span class="p">[</span><span class="s2">&quot;2.0s&quot;</span><span class="p">]</span>
<span class="n">burst_id_demo_lc</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="wavelet-transform-peak-finding">
<h3>Wavelet transform peak finding<a class="headerlink" href="#wavelet-transform-peak-finding" title="Link to this heading">#</a></h3>
<p>Continuous wavelet transform (CWT) peak finding is a relatively simple way to try and
find peaks in a time-varying signal, or indeed any one-dimensional data set.</p>
<p>The process involves convolving wavelets with the light curve and then identifying
data points that are above some threshold of signal-to-noise; by retrieving the time
information that corresponds to those peak data points, we can identify the times of
what we hope are bursts.</p>
<p>The idea behind the wavelet transform approach is that convolving a wavelet function
of a particular width will amplify features in the time series (light curve) that
are of similar widths and smooth out those features which are not.</p>
<p>It is possible, and often very beneficial, to convolve several different wavelet scales
with the same data to try and pull out features of different scales.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Another important use of wavelet transforms in high-energy astrophysics is as a
mechanism for source detection in X-ray images! There different wavelet scales
help to identify both point and extended sources.</p>
</div>
<p>Peak finding using CWTs is conveniently already implemented in the commonly used
<code class="docutils literal notranslate"><span class="pre">scipy</span></code> package, and here we will demonstrate its use on our new RXTE-PCA light curves.</p>
<section id="testing-on-a-single-light-curve">
<h4>Testing on a single light curve<a class="headerlink" href="#testing-on-a-single-light-curve" title="Link to this heading">#</a></h4>
<p>To validate how well this method appears to work on the time-varying emission from
T5X2, as observed with RXTE-PCA, we first run CWT peak finding on a single light curve.</p>
<p>Any peak detection algorithm will have configuration or parameters that are set
to control the behavior of the detection process.</p>
<p>The particular configuration you use will depend on several factors, including:</p>
<ul class="simple">
<li><p>Your science case; i.e., the features you’re searching for.</p></li>
<li><p>The nature of the data; is it high signal-to-noise? what is the light curve time resolution?</p></li>
<li><p>The level of contamination from false positives (and false negatives) you’re willing to tolerate.</p></li>
</ul>
<p>You may also have to do some ‘tuning’ where you experiment with different
values of the configuration parameters to produce what seems to be the highest
quality results.</p>
<p>All that said, please don’t take our choice of configuration as a recommendation for
how to use CWT peak finding in your own work!</p>
<p>We use the following configuration parameters:</p>
<ul class="simple">
<li><p>Wavelet widths of <strong>2</strong> and <strong>5</strong>; <strong>four</strong> and <strong>ten</strong> seconds respectively (for our 2-second-binned light curves)..</p></li>
<li><p>A minimum signal-to-noise of <strong>3</strong> for a convolved data point to be considered a peak.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The SciPy implementation of continuous wavelet transform peak-finding has more
configuration options than we have used here. Descriptions are available in the
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks_cwt.html">SciPy documentation</a>.</p>
</div>
<p>Running the peak-finding algorithm is as simple as:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wt_lc_demo_bursts</span> <span class="o">=</span> <span class="n">find_peaks_cwt</span><span class="p">(</span><span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">count_rate</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">min_snr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">wt_lc_demo_bursts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 142,  144,  328,  457,  458,  607, 1154, 1193, 1423, 1424, 1477,
       1501, 1627, 1683])
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>SciPy’s <code class="docutils literal notranslate"><span class="pre">find_peaks_cwt()</span></code> function returns indices of the array/list elements of
the input data that it defines as peaks. The peak indices can then be used to
extract the peak times from the light curve’s <code class="docutils literal notranslate"><span class="pre">time</span></code> or <code class="docutils literal notranslate"><span class="pre">datetime</span></code> properties.</p>
</div>
</section>
<section id="visualizing-peak-times-identified-for-the-single-light-curve">
<h4>Visualizing peak times identified for the single light curve<a class="headerlink" href="#visualizing-peak-times-identified-for-the-single-light-curve" title="Link to this heading">#</a></h4>
<p>Now we’ll look at the single light curve we just tested CWT peak finding on, making
a small addition of a vertical line the height of the axis at every time identified
as a ‘peak’.</p>
<p>The results are quite encouraging, with many peaks evident from manual inspection also
identified by CWT peak finding!</p>
<p>It isn’t perfect, as some obvious peaks in the emission are not automatically
identified, and some bursts appear to have multiple peaks erroneously associated with them.</p>
<p>Regardless, this technique is clearly a possibly promising avenue for automated burst
detection and with some tuning of the wavelet scales and signal-to-noise threshold,
could be made much more reliable. We also note that CWT is a simple and relatively
fast process, which brings its own advantages when applying it at scale.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a figure, specifying the size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>
<span class="c1"># Fetch the axis that was created along with it, so it can be passed to get_view()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c1"># This will populate the axis so that it looks like the light curve visualisations</span>
<span class="c1">#  we&#39;ve already been looking at</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;deeppink&quot;</span><span class="p">)</span>

<span class="c1"># Iterate through the possible peaks, and add them to our retrieved, populated, axes</span>
<span class="k">for</span> <span class="n">p_pos</span> <span class="ow">in</span> <span class="n">wt_lc_demo_bursts</span><span class="p">:</span>
    <span class="n">p_time</span> <span class="o">=</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">p_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">p_time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Setting the start and end times (in seconds relative to the beginning of</span>
<span class="c1">#  this light curve&#39;s observation) of the zoom-in region</span>
<span class="n">demo_wt_lc_zoom_start</span> <span class="o">=</span> <span class="mi">2800</span>
<span class="n">demo_wt_lc_zoom_end</span> <span class="o">=</span> <span class="mi">3200</span>

<span class="c1"># Adding an inset axes, in which we will have a zoomed view of a particular</span>
<span class="c1">#  part of the light curve.</span>
<span class="c1"># The first argument of a list of numbers defines the position of the lower left</span>
<span class="c1">#  corner of the inset axes, and its size</span>
<span class="n">axins</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
<span class="c1"># Configure the ticks on the new axis</span>
<span class="n">axins</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to replot the light curve data on the inset axis</span>
<span class="n">axins</span> <span class="o">=</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;deeppink&quot;</span><span class="p">,</span> <span class="n">custom_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Setting the time range of the zoomed view</span>
<span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">demo_wt_lc_zoom_start</span><span class="p">,</span> <span class="n">demo_wt_lc_zoom_end</span><span class="p">)</span>
<span class="c1"># Remove the pre-set axis labels, as they make the plot harder to read</span>
<span class="n">axins</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">axins</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Iterating through the peak times and plotting them again</span>
<span class="k">for</span> <span class="n">p_pos</span> <span class="ow">in</span> <span class="n">wt_lc_demo_bursts</span><span class="p">:</span>
    <span class="n">p_time</span> <span class="o">=</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">p_pos</span><span class="p">]</span> <span class="o">-</span> <span class="n">burst_id_demo_lc</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">axins</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">p_time</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/f996d717665b737c6d68c79426fe91ec68ffb9a6c7d6f048ca5aa4fef23a40fa.png" src="../../../_images/f996d717665b737c6d68c79426fe91ec68ffb9a6c7d6f048ca5aa4fef23a40fa.png" />
</div>
</div>
</section>
<section id="applying-wavelet-transform-peak-finding-to-the-whole-aggregated-light-curve">
<h4>Applying wavelet transform peak finding to the whole aggregated light curve<a class="headerlink" href="#applying-wavelet-transform-peak-finding-to-the-whole-aggregated-light-curve" title="Link to this heading">#</a></h4>
<p>Following our successful test of CWT peak finding on a single light curve, we will
try to apply it to the entire set of observations we have been looking at in this
tutorial!</p>
<p>As we’re using the two-second time bin aggregated light curve set up earlier in the
notebook, the single light curve we just tested on will be analyzed again, but given
the speed of CWT peak-finding, that is acceptable.</p>
<p>We do not change the CWT peak-finding configuration parameters from the settings used
for the single light curve test, given that the results seemed to be a promising start.</p>
<p>Extracting the count-rate and time (as seconds from reference time, and as datetimes) for
each data point in the two-second time bin AggregateLightCurve object is
straightforward, as is running the CWT peak-finding algorithm again:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wt_agg_demo_cr</span><span class="p">,</span> <span class="n">wt_agg_demo_cr_err</span><span class="p">,</span> <span class="n">wt_agg_demo_datetime</span><span class="p">,</span> <span class="n">wt_agg_demo_ch_id</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">date_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">wt_agg_demo_time</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">date_time</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Running the peak finder on the whole aggregated light curve</span>
<span class="n">wt_agg_lc_demo_bursts</span> <span class="o">=</span> <span class="n">find_peaks_cwt</span><span class="p">(</span><span class="n">wt_agg_demo_cr</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">min_snr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="storing-peak-information-in-a-pandas-dataframe">
<h4>Storing peak information in a Pandas DataFrame<a class="headerlink" href="#storing-peak-information-in-a-pandas-dataframe" title="Link to this heading">#</a></h4>
<p>If this were a ‘real’ analysis, we would likely want to write the peak finding results
to disk, so that they exist outside of memory in a more permanent form.</p>
<p>Here we will place the time and datetime of identified peaks into a Pandas
DataFrame, alongside the count rate and count rate uncertainty of the data point
identified as a peak, and the ID of the time chunk (which can be linked to an
observation) the peak occurred during.</p>
<p>As well as making it easy to save this information to disk (using the <code class="docutils literal notranslate"><span class="pre">to_csv()</span></code>
method), the new dataframe also provides a nice way of interacting with the data
within this notebook:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract useful information for each data point identified as a peak</span>
<span class="n">rel_tc_ids</span> <span class="o">=</span> <span class="n">wt_agg_demo_ch_id</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span>
<span class="n">rel_datetimes</span> <span class="o">=</span> <span class="n">wt_agg_demo_datetime</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span>
<span class="n">rel_times</span> <span class="o">=</span> <span class="n">wt_agg_demo_time</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span>
<span class="n">rel_crs</span> <span class="o">=</span> <span class="n">wt_agg_demo_cr</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">rel_cr_errs</span> <span class="o">=</span> <span class="n">wt_agg_demo_cr_err</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="c1"># Set up the data and column names required to declare the dataframe</span>
<span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">rel_tc_ids</span><span class="p">,</span> <span class="n">rel_datetimes</span><span class="p">,</span> <span class="n">rel_times</span><span class="p">,</span> <span class="n">rel_crs</span><span class="p">,</span> <span class="n">rel_cr_errs</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">out_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;burst_datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;burst_time&quot;</span><span class="p">,</span> <span class="s2">&quot;burst_cr&quot;</span><span class="p">,</span> <span class="s2">&quot;burst_cr_err&quot;</span><span class="p">]</span>

<span class="c1"># Make and save the dataframe</span>
<span class="n">wt_agg_lc_demo_burst_res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_cols</span><span class="p">)</span>
<span class="n">wt_agg_lc_demo_burst_res</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;cwt_peak_info.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># We will examine the dataframe in Jupyter as well</span>
<span class="n">wt_agg_lc_demo_burst_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_chunk_id</th>
      <th>burst_datetime</th>
      <th>burst_time</th>
      <th>burst_cr</th>
      <th>burst_cr_err</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2000-07-13 04:45:11.562431</td>
      <td>206081055.378431</td>
      <td>223.060604</td>
      <td>11.389885</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>2000-07-13 04:55:33.562431</td>
      <td>206081677.378431</td>
      <td>331.641458</td>
      <td>13.629187</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2000-07-13 05:03:45.562431</td>
      <td>206082169.378431</td>
      <td>1088.23267</td>
      <td>24.031044</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>2000-07-13 05:03:47.562431</td>
      <td>206082171.378431</td>
      <td>902.114175</td>
      <td>21.919986</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2000-07-13 17:57:31.562431</td>
      <td>206128595.378431</td>
      <td>379.813874</td>
      <td>14.583534</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>498</th>
      <td>57</td>
      <td>2010-10-18 15:45:53.562429</td>
      <td>530034299.378429</td>
      <td>1710.659429</td>
      <td>30.096882</td>
    </tr>
    <tr>
      <th>499</th>
      <td>57</td>
      <td>2010-10-18 15:56:59.562429</td>
      <td>530034965.378429</td>
      <td>1698.160325</td>
      <td>29.972881</td>
    </tr>
    <tr>
      <th>500</th>
      <td>57</td>
      <td>2010-10-18 16:00:37.562429</td>
      <td>530035183.378429</td>
      <td>1681.672984</td>
      <td>29.845354</td>
    </tr>
    <tr>
      <th>501</th>
      <td>57</td>
      <td>2010-10-18 16:10:25.562429</td>
      <td>530035771.378429</td>
      <td>1504.303014</td>
      <td>28.374562</td>
    </tr>
    <tr>
      <th>502</th>
      <td>57</td>
      <td>2010-10-18 16:10:31.562429</td>
      <td>530035777.378429</td>
      <td>1538.253902</td>
      <td>28.673094</td>
    </tr>
  </tbody>
</table>
<p>503 rows × 5 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="exploring-t5x2-properties-at-potential-burst-times">
<h3>Exploring T5X2 properties at potential burst times<a class="headerlink" href="#exploring-t5x2-properties-at-potential-burst-times" title="Link to this heading">#</a></h3>
<p>We now have a set of times that represent what we think might be X-ray bursts from T5X2! Whether we
arrived at them by manual inspection, or some automatic method, at this point we might want to make a
simple examination of some of T5X2’s properties at the times of the potential bursts.</p>
<p>As this demonstration is primarily about RXTE light curves, we will focus on what insights we can
draw from the products we already have available. If you were performing a full scientific analysis,
you might want to consider ‘time resolved spectroscopy’ (spectra are extracted from within a specific
time period of an observation).</p>
<section id="count-rates-at-potential-burst-times">
<h4>Count rates at potential burst times<a class="headerlink" href="#count-rates-at-potential-burst-times" title="Link to this heading">#</a></h4>
<p>Our first step is to examine the distribution of count rates (within the 2–60 keV band that the
high-time-resolution light curves were generated within) at the times identified by the peak-finding method.</p>
<p>T5X2 is a complex X-ray emitter, and work by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a> found
that the bursting caused by accretion of material onto the neutron star evolved over the course of their RXTE observations. One of
the most significant effects (and a key finding of their study) was that the persistent X-ray emission (the ‘base’
count rate when a burst is not occurring) increases as the bursts become more frequent.</p>
<p>This is indicative of a continuous process causing increased X-ray emission, fueled by a reservoir of material
built up from the high accretion rate onto T5X2, and only partially consumed by X-ray bursts from the neutron star.</p>
<p>As such, we might wonder if the distribution of count-rates at potential burst times (defined using CWT peak
finding in this case) is multi-modal, reflecting the different levels of persistent X-ray emission at different stages
in T5X2’s accretion?</p>
<p>Looking at this distribution, we can see that there appear to be at least two distinct populations of bursts, at
least when considering the burst-count-rates. This could represent two different modes of accretion and bursting,
just as was seen by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a>.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;burst_cr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count Rate [ct s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Count-rate at WT identified burst times&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/e43a85cfb80eaaec6aa23bc6c53c6b088b3ad5050f56215ddce72de191de255a.png" src="../../../_images/e43a85cfb80eaaec6aa23bc6c53c6b088b3ad5050f56215ddce72de191de255a.png" />
</div>
</div>
</section>
<section id="hardness-ratios-at-potential-burst-times">
<h4>Hardness ratios at potential burst times<a class="headerlink" href="#hardness-ratios-at-potential-burst-times" title="Link to this heading">#</a></h4>
<p>Given the different astrophysical processes that appear to be driving the persistent and bursting X-ray
emission by T5X2, it would also be interesting to look at the hardness ratio of the emission
at the potential burst times.</p>
<p>We discussed hardness ratios in the previous section, calculating and visualizing a ‘hardness curve’ from our
newly generated custom-energy-band light curves. Here we will pull in the unique information that
those light curves contain to help paint a picture of what T5X2 might be doing.</p>
<p>Unfortunately, we were only able to generate light curves within specific energy bands with a time resolution
of 16 seconds. This is a hard limitation of the RXTE-PCA instrument, as the ‘Standard-1’ data mode we
used to make our high-time-resolution (two-second time bin in this case) contains no spectral information at all.</p>
<p>To determine the hardness ratio at our potential burst times, we will have to compromise and interpolate
the much coarser 16-second binning of the hardness curve to our peak detection times. Doing this without
further thought is acceptable because this is a demonstration, but you should consider the potential
measurement effects interpolation could produce for your own science case.</p>
<p>Once again, using the <strong>2–10</strong> keV light curves as the soft band, and the <strong>10–30</strong> keV as the
hard band, we interpolate the hardness ratio at every time step of the <strong>two-second</strong> time resolution
light curves. Then the interpolated hardness ratio at the time of each potential burst is extracted:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lo_en_demo_agg_data</span> <span class="o">=</span> <span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;2.0-10.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">lo_en_demo_agg_cr</span> <span class="o">=</span> <span class="n">lo_en_demo_agg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lo_en_demo_agg_time</span> <span class="o">=</span> <span class="n">lo_en_demo_agg_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">hi_en_demo_agg_data</span> <span class="o">=</span> <span class="n">agg_gen_en_bnd_lcs</span><span class="p">[</span><span class="s2">&quot;10.0-30.0keV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">hi_en_demo_agg_cr</span> <span class="o">=</span> <span class="n">hi_en_demo_agg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">hi_en_demo_agg_time</span> <span class="o">=</span> <span class="n">hi_en_demo_agg_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Calculate the hardness ratio for all data points in the 16-second time bin</span>
<span class="c1">#  custom-energy-band light curves</span>
<span class="n">agg_lc_hard_rat</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi_en_demo_agg_cr</span> <span class="o">-</span> <span class="n">lo_en_demo_agg_cr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
    <span class="n">hi_en_demo_agg_cr</span> <span class="o">+</span> <span class="n">lo_en_demo_agg_cr</span>
<span class="p">)</span>

<span class="c1"># Now we interpolate the hardness curve onto the time grid of the high-time</span>
<span class="c1">#  resolution light curve</span>
<span class="n">wt_agg_lc_demo_interp_hard</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
    <span class="n">wt_agg_demo_time</span><span class="p">,</span> <span class="n">lo_en_demo_agg_time</span><span class="p">,</span> <span class="n">agg_lc_hard_rat</span>
<span class="p">)</span>

<span class="n">wt_agg_lc_demo_burst_hard</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_interp_hard</span><span class="p">[</span><span class="n">wt_agg_lc_demo_bursts</span><span class="p">]</span>
<span class="n">wt_agg_lc_demo_burst_hard</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[-0.38279584,~-0.38028888,~-0.57576907,~\dots,~-0.75438255,~-0.75336512,~-0.75518734] \; \mathrm{}\]</div>
</div>
</div>
<p>For later ease of access, we add the interpolated hardness ratios at burst times to the
peak information dataframe we created earlier:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;interp_hardness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_hard</span>
<span class="n">wt_agg_lc_demo_burst_res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_chunk_id</th>
      <th>burst_datetime</th>
      <th>burst_time</th>
      <th>burst_cr</th>
      <th>burst_cr_err</th>
      <th>interp_hardness</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2000-07-13 04:45:11.562431</td>
      <td>206081055.378431</td>
      <td>223.060604</td>
      <td>11.389885</td>
      <td>-0.382796</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>2000-07-13 04:55:33.562431</td>
      <td>206081677.378431</td>
      <td>331.641458</td>
      <td>13.629187</td>
      <td>-0.380289</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2000-07-13 05:03:45.562431</td>
      <td>206082169.378431</td>
      <td>1088.23267</td>
      <td>24.031044</td>
      <td>-0.575769</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>2000-07-13 05:03:47.562431</td>
      <td>206082171.378431</td>
      <td>902.114175</td>
      <td>21.919986</td>
      <td>-0.569407</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2000-07-13 17:57:31.562431</td>
      <td>206128595.378431</td>
      <td>379.813874</td>
      <td>14.583534</td>
      <td>-0.442290</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>498</th>
      <td>57</td>
      <td>2010-10-18 15:45:53.562429</td>
      <td>530034299.378429</td>
      <td>1710.659429</td>
      <td>30.096882</td>
      <td>-0.754274</td>
    </tr>
    <tr>
      <th>499</th>
      <td>57</td>
      <td>2010-10-18 15:56:59.562429</td>
      <td>530034965.378429</td>
      <td>1698.160325</td>
      <td>29.972881</td>
      <td>-0.749908</td>
    </tr>
    <tr>
      <th>500</th>
      <td>57</td>
      <td>2010-10-18 16:00:37.562429</td>
      <td>530035183.378429</td>
      <td>1681.672984</td>
      <td>29.845354</td>
      <td>-0.754383</td>
    </tr>
    <tr>
      <th>501</th>
      <td>57</td>
      <td>2010-10-18 16:10:25.562429</td>
      <td>530035771.378429</td>
      <td>1504.303014</td>
      <td>28.374562</td>
      <td>-0.753365</td>
    </tr>
    <tr>
      <th>502</th>
      <td>57</td>
      <td>2010-10-18 16:10:31.562429</td>
      <td>530035777.378429</td>
      <td>1538.253902</td>
      <td>28.673094</td>
      <td>-0.755187</td>
    </tr>
  </tbody>
</table>
<p>503 rows × 6 columns</p>
</div></div></div>
</div>
<p>Now that hardness ratios at potential burst times have been calculated, we
can plot their distribution (just as we did for count-rate), as well as how they
compare to the count-rate at the time of each potential burst.</p>
<p>We also include the relationship between the count-rate and interpolated ratio for
<strong>every</strong> data point in the two-second time-resolution aggregated light
curve (right hand panel), to give us an idea of their overall relationship.</p>
<p>There appear to be at least two distinct populations of bursts, in terms of their
hardness ratio; one with a median hardness of ~-0.5, and another, softer, population
with a median hardness of ~-0.75.</p>
<p>The relationship of potential burst hardness to count-rate is also interesting, with a
complex morphology that could be due to at least two different processes driving the
persistent and bursting X-ray emission by T5X2. The softer (more negative hardness
ratio) bursts appear to have a minimal dependence on the count rate, whereas the harder
segment of the hardness ratio distribution seems to become softer with increasing count rate.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hr_step</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">interp_hr_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
    <span class="n">wt_agg_lc_demo_burst_hard</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="n">wt_agg_lc_demo_burst_hard</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">hr_step</span><span class="p">,</span>
    <span class="n">hr_step</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ax_arr</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">wt_agg_lc_demo_burst_hard</span><span class="p">,</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">interp_hr_bins</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Interpolated Hardness Ratio&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Burst time interpolated HR&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">last_ax</span> <span class="o">=</span> <span class="n">ax_arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">mid_ax</span> <span class="o">=</span> <span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">last_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">wt_agg_demo_cr</span><span class="p">,</span>
    <span class="n">wt_agg_lc_demo_interp_hard</span><span class="p">,</span>
    <span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkseagreen&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Whole aggregated light curve&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">sharey</span><span class="p">(</span><span class="n">mid_ax</span><span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">sharex</span><span class="p">(</span><span class="n">mid_ax</span><span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">mid_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;burst_cr&quot;</span><span class="p">],</span>
    <span class="n">wt_agg_lc_demo_burst_hard</span><span class="p">,</span>
    <span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Burst time&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mid_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">last_ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;symlog&quot;</span><span class="p">)</span>

<span class="n">mid_ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">mid_ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;symlog&quot;</span><span class="p">)</span>

<span class="n">last_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">mid_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">mid_ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">last_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">mid_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Count Rate (2-60 keV) [ct s$^{-1}$]&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">last_ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;Interpolated Hardness Ratio&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Interpolated hardness ratio&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">mid_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">last_ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/d3775fc7e0aa61b82dc852f815d0c30236d92527b53b41819629d90ec2731a46.png" src="../../../_images/d3775fc7e0aa61b82dc852f815d0c30236d92527b53b41819629d90ec2731a46.png" />
</div>
</div>
</section>
<section id="visualizing-light-curves-of-potential-bursts-with-hardness-information">
<h4>Visualizing light curves of potential bursts with hardness information<a class="headerlink" href="#visualizing-light-curves-of-potential-bursts-with-hardness-information" title="Link to this heading">#</a></h4>
<p>We can also plot some of the light curves, with potential burst times highlighted, and
include the interpolated hardness of the emission at burst time, to place the
hardness information in context.</p>
<p>A subset of light curves is selected, chosen to show some interesting features and
highlight the performance of the peak-finding algorithm.</p>
<p>As the light curves will be plotted on separate figures, but we want a consistent hardness
color scale throughout, we set up a matplotlib color mapper that will take a hardness
ratio value and return a color. It is normalized using the minimum and maximum burst
hardness ratios of all the selected light curves.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">burst_sel_mask</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">45</span>
<span class="n">subset_wt_agg_lc_demo_burst_res</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="n">burst_sel_mask</span><span class="p">]</span>
<span class="n">subset_wt_agg_interp_burst_hardness</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_hard</span><span class="p">[</span><span class="n">burst_sel_mask</span><span class="p">]</span>

<span class="c1"># We want to normalise this colourmap to our specific data range</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">subset_wt_agg_interp_burst_hardness</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">subset_wt_agg_interp_burst_hardness</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<span class="p">)</span>
<span class="c1"># Now a mapper can be constructed so that we can take that information about</span>
<span class="c1">#  the cmap and normalisation and use it with our data to calculate colours</span>
<span class="n">cmap_mapper</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;turbo&quot;</span><span class="p">)</span>
<span class="c1"># This calculates the colours</span>
<span class="n">colours</span> <span class="o">=</span> <span class="n">cmap_mapper</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">subset_wt_agg_interp_burst_hardness</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we plot the selected light curves, with vertical lines indicating a potential
burst, and the color of the line communicating the interpolated hardness ratio:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cur_tc_id</span> <span class="ow">in</span> <span class="n">subset_wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">cur_lc</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">get_lightcurves</span><span class="p">(</span><span class="n">cur_tc_id</span><span class="p">)</span>
    <span class="n">sel_bursts</span> <span class="o">=</span> <span class="n">subset_wt_agg_lc_demo_burst_res</span><span class="p">[</span>
        <span class="n">subset_wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cur_tc_id</span>
    <span class="p">]</span>

    <span class="n">cur_burst_times</span> <span class="o">=</span> <span class="n">sel_bursts</span><span class="p">[</span><span class="s2">&quot;burst_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">cur_burst_colors</span> <span class="o">=</span> <span class="n">colours</span><span class="p">[</span>
        <span class="n">subset_wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cur_tc_id</span>
    <span class="p">]</span>

    <span class="c1"># Set up a figure, specifying the size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>
    <span class="c1"># Fetch the axis that was created along with it, so it can be passed to get_view()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="c1"># This will populate the axis so that it looks like the visualisations</span>
    <span class="c1">#  we&#39;ve been looking at</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">cur_lc</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;sandybrown&quot;</span><span class="p">)</span>

    <span class="c1"># Iterate through the possible peaks, and add them to our retrieved, populated, axes</span>
    <span class="k">for</span> <span class="n">b_time_ind</span><span class="p">,</span> <span class="n">b_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cur_burst_times</span><span class="p">):</span>
        <span class="n">b_time</span> <span class="o">=</span> <span class="n">b_time</span> <span class="o">-</span> <span class="n">cur_lc</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">b_time</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">cur_burst_colors</span><span class="p">[</span><span class="n">b_time_ind</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cmap_mapper</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
        <span class="s2">&quot;Interpolated Hardness Ratio&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/06bdbd882175cdbf5a0425f7af16c6a368bd6cfc56ad4dad7bf4e0d1f2015db0.png" src="../../../_images/06bdbd882175cdbf5a0425f7af16c6a368bd6cfc56ad4dad7bf4e0d1f2015db0.png" />
<img alt="../../../_images/23bf5209432dbdf41c59af856014b1ae41d1abc436189b7fa4c6d7ed63f76cf6.png" src="../../../_images/23bf5209432dbdf41c59af856014b1ae41d1abc436189b7fa4c6d7ed63f76cf6.png" />
<img alt="../../../_images/4baab1854dd0d48eccc594f93aa3462b0e24b7868f1301a2827eef5d3100e416.png" src="../../../_images/4baab1854dd0d48eccc594f93aa3462b0e24b7868f1301a2827eef5d3100e416.png" />
<img alt="../../../_images/067b3e608bfc9444ff79ea281b76beab9acf143bf967fc13618ef1efdd9e6cc8.png" src="../../../_images/067b3e608bfc9444ff79ea281b76beab9acf143bf967fc13618ef1efdd9e6cc8.png" />
<img alt="../../../_images/4f081d8e061ee2eb3c129f76b680d43b23abf8f95040d2280bb7ff413a774e5c.png" src="../../../_images/4f081d8e061ee2eb3c129f76b680d43b23abf8f95040d2280bb7ff413a774e5c.png" />
<img alt="../../../_images/2f144293bb4257be10fbd1f8c9b748bfb98b8673047240124a999795c5be4b43.png" src="../../../_images/2f144293bb4257be10fbd1f8c9b748bfb98b8673047240124a999795c5be4b43.png" />
<img alt="../../../_images/d0aabc8ead7651307a855cc765f764112c67a12e9d134e3c8ba421e3f13b4b9a.png" src="../../../_images/d0aabc8ead7651307a855cc765f764112c67a12e9d134e3c8ba421e3f13b4b9a.png" />
<img alt="../../../_images/6211a244cc7db6a81ca39fe5aa83cebc9f3aa03f1ef93a35b8b6f07e4bae53a0.png" src="../../../_images/6211a244cc7db6a81ca39fe5aa83cebc9f3aa03f1ef93a35b8b6f07e4bae53a0.png" />
<img alt="../../../_images/b796715d21e710faf0694b19c921c4356b591a9285c858908b7b5409a11754ae.png" src="../../../_images/b796715d21e710faf0694b19c921c4356b591a9285c858908b7b5409a11754ae.png" />
<img alt="../../../_images/100267cd17e7a35e2d7d08c2b17e77063e0d66a460680f2a8ee5e0aff31c49b3.png" src="../../../_images/100267cd17e7a35e2d7d08c2b17e77063e0d66a460680f2a8ee5e0aff31c49b3.png" />
<img alt="../../../_images/eeb4e9b3143bb4effd750f61ebb136da26ebdb049cb28b1e137e2435e65377b0.png" src="../../../_images/eeb4e9b3143bb4effd750f61ebb136da26ebdb049cb28b1e137e2435e65377b0.png" />
<img alt="../../../_images/0243e3c42eb10a2b62b44dcf7e31260b4aabf7d260974b6ce6a1eb61ae5540b3.png" src="../../../_images/0243e3c42eb10a2b62b44dcf7e31260b4aabf7d260974b6ce6a1eb61ae5540b3.png" />
</div>
</div>
</section>
</section>
<section id="number-and-frequency-of-potential-bursts">
<h3>Number and frequency of potential bursts<a class="headerlink" href="#number-and-frequency-of-potential-bursts" title="Link to this heading">#</a></h3>
<p>The number of bursts per unit time is another quantity that might be interesting
to look at, as there are several potential questions it might answer. For instance:</p>
<p>Does the burst frequency stay constant across our observations of T5X2, or does
it increase as we move into the phase of a continuous process increasing the base
emission of T5X2?</p>
<p>As it seems there might be two distinct populations of bursts (in terms of their
hardness ratio, and its relationship to count-rate), does the frequency of soft
and hard bursts change over the course of our observations?</p>
<p>We can use our peak-finding results, alongside information extracted from the light curves, to
get an idea of the potential burst frequency.</p>
<section id="how-many-peaks-did-we-find-in-each-time-chunk">
<h4>How many peaks did we find in each time chunk?<a class="headerlink" href="#how-many-peaks-did-we-find-in-each-time-chunk" title="Link to this heading">#</a></h4>
<p>To calculate the burst frequency, we need to start by determining how many bursts were
identified during each ‘time chunk’ of our aggregated light curve.</p>
<p>This is made easy by our previous decision to store the burst information in
a Pandas dataframe. We can use the <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code> method of “time_chunk_id”
column to count how many times each unique time chunk ID appears in that
column (recall that every row represents a potential burst).</p>
<p>The output of this is a Pandas <code class="docutils literal notranslate"><span class="pre">Series</span></code> with “time_chunk_id” index values and the number
of bursts with that time chunk ID as values.</p>
<p>We then order the series from lowest to highest time chunk ID:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">burst_per_chunk</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">burst_per_chunk</span> <span class="o">=</span> <span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">burst_per_chunk</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time_chunk_id
0      4
1      8
2      1
3      7
4     13
5      2
6      2
7      2
8     11
9      7
10    18
11    21
12     6
13     5
14     4
15    13
16     7
17     2
18     7
19    17
20     4
21     9
22     3
23     5
25    13
26     3
27     5
30     5
31     2
33     1
34     2
43    13
44    45
46     8
47    18
48    26
49    10
50     8
51     9
52    29
53    17
54    21
55    30
56    43
57    17
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The number of bursts detected per time chunk varies significantly, with some time
chunk IDs not even represented in the dataframe (meaning no peaks were detected).</p>
<p>We cannot draw too many conclusions from this yet, though, as the time chunks are
not guaranteed to be of equal length. Our next step has to be to calculate the
number of bursts per second for each time chunk.</p>
</section>
<section id="calculating-the-frequency-of-bursts">
<h4>Calculating the frequency of bursts<a class="headerlink" href="#calculating-the-frequency-of-bursts" title="Link to this heading">#</a></h4>
<p>In order to calculate the frequency of burst occurrence, we need to know the length
of time represented by each time chunk. This is easy to extract (using
the <code class="docutils literal notranslate"><span class="pre">time_chunk_lengths</span></code> property) from the two-second time resolution
AggregateLightCurve object we set up earlier, when we generated those light curves.</p>
<p>Knowing the lengths of time chunks isn’t enough by itself, though, as there is no guarantee that
we have data for the entire time period covered by a particular time chunk. Perhaps there
were issues with the detector, or the data from part of the observation did not pass our
screening criteria - either way, we can’t include such time periods, as we may
underestimate the burst frequency.</p>
<p>The good-time-intervals of each light curve (GTIs) will tell us whether there are any
time periods that we shouldn’t include in our total time chunk length determination.
GTI information is loaded in from light curve files, if available, and can again be
accessed through the AggregateLightCurve object.</p>
<p>In this instance, we can use the <code class="docutils literal notranslate"><span class="pre">time_chunk_good_fractions()</span></code> method of AggregateLightCurve to
retrieve the fraction of each time chunk that is within the GTIs of its light curve.</p>
<p>Multiplying the time chunk lengths by this fraction will give us the <strong>actual</strong> length
of time we should divide the number of bursts by to get the burst frequency:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_chunk_size</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">time_chunk_lengths</span>
    <span class="o">*</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">time_chunk_good_fractions</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">time_chunk_peak_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_chunk_size</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">time_chunk_peak_freq</span><span class="p">[</span><span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">time_chunk_size</span><span class="p">[</span><span class="n">burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">time_chunk_peak_freq</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.00246305, 0.00462963, 0.00099602, 0.00209205, 0.00377468,
       0.00068823, 0.00058997, 0.00084674, 0.00308989, 0.00202781,
       0.005625  , 0.00469379, 0.00129983, 0.00261233, 0.00208333,
       0.00102783, 0.00197294, 0.00104167, 0.00368809, 0.00332811,
       0.00294551, 0.00439453, 0.00089874, 0.00163613, 0.        ,
       0.00380117, 0.00086856, 0.00092353, 0.        , 0.        ,
       0.00216076, 0.00074405, 0.        , 0.00041118, 0.00067935,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.03494624, 0.01365291,
       0.        , 0.00260417, 0.00178678, 0.00257426, 0.00400641,
       0.002886  , 0.00281955, 0.00266055, 0.00274194, 0.00207428,
       0.00479386, 0.00397559, 0.00235066])
</pre></div>
</div>
</div>
</div>
<p>We can now plot the overall distribution of peak detection (which is hopefully
correlated with burst) frequencies. The majority of our time chunks appear to not have
any bursts detected, which could be a real finding, or a limitation of the automatic
peak-finding algorithm/configuration.</p>
<p>Disregarding those with zero bursts, the distribution of peak detection frequency
peaks at around 0.003 Hz, or 3 bursts per kilosecond. We also note the presence of some
outliers with much higher peak detection frequencies.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">time_chunk_peak_freq</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;powderblue&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency of peak detection [Hz]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/0999477f10a990555009c9de3bb934de8c9c3afd70ef994411f6a8c82ee0b6fd.png" src="../../../_images/0999477f10a990555009c9de3bb934de8c9c3afd70ef994411f6a8c82ee0b6fd.png" />
</div>
</div>
</section>
<section id="does-the-frequency-of-peak-identification-evolve-with-time">
<h4>Does the frequency of peak identification evolve with time?<a class="headerlink" href="#does-the-frequency-of-peak-identification-evolve-with-time" title="Link to this heading">#</a></h4>
<p>We have the frequency of peak detection for each time chunk, and so we can plot it
against the time chunk central time in order to see if the peak detection frequency
changes over the course of our observations.</p>
<p>First, we calculate the time chunk central times, using Python datetime objects because
matplotlib can be easily configured to display datetimes as axis labels:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datetime_chunk_halfwidths</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
<span class="p">)</span>
<span class="n">datetime_chunk_centers</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime_chunk_halfwidths</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can make the figure! As we are covering a time period of nearly ten years, and
we are using a continuous x-axis, the data points are very close together and somewhat
hard to interpret. As such, we include inset zooms into time-periods of interest.</p>
<p>We don’t see a dramatic difference in the peak detection frequencies at different times, though the
frequencies on the right-hand side of the plot, from 2010, seem to have more consistent
peak detection frequencies than those from 2001.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The x-axis data were in the form of datetimes, and we can use a matplotlib</span>
<span class="c1">#  formatted to ensure that the tick labels are displayed correctly</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="c1"># We also rotate the tick labels to make them easier to read</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency of peak detection [Hz]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># ----------- INSET ONE -----------</span>

<span class="n">inset_one_low_lim</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">inset_one_upp_lim</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-10-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

<span class="n">axins_one</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
<span class="c1"># Configure the ticks on the new axis</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to replot the light curve data on the inset axis</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Setting the time range of the zoomed view</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">inset_one_low_lim</span><span class="p">,</span> <span class="n">inset_one_upp_lim</span><span class="p">)</span>

<span class="n">axins_one</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins_one</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------- INSET TWO -----------</span>

<span class="n">inset_two_low_lim</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2010-10-11&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>
<span class="n">inset_two_upp_lim</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">axins_two</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.52</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
<span class="c1"># Configure the ticks on the new axis</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to replot the light curve data on the inset axis</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Setting the time range of the zoomed view</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">inset_two_low_lim</span><span class="p">,</span> <span class="n">inset_two_upp_lim</span><span class="p">)</span>

<span class="n">axins_two</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins_two</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/4bc4ec1f47ab3a2222fc1b815411410a229f65717cbd0a718327ce6184dbbc9b.png" src="../../../_images/4bc4ec1f47ab3a2222fc1b815411410a229f65717cbd0a718327ce6184dbbc9b.png" />
</div>
</div>
</section>
<section id="does-the-hardness-ratio-of-potential-bursts-evolve-with-time">
<h4>Does the hardness ratio of potential bursts evolve with time?<a class="headerlink" href="#does-the-hardness-ratio-of-potential-bursts-evolve-with-time" title="Link to this heading">#</a></h4>
<p>Considering that we may have identified two populations of bursts with
different hardness ratios, we can attempt to see if the occurrence frequency of
‘softer’ and ‘harder’ bursts changes over the course of our observations.</p>
<p>Based on the potential burst hardness ratio distribution visualization we created earlier, we choose
a boundary of -0.6 to split the bursts into ‘softer’ (less than -0.6) and ‘harder’ (greater than -0.6) groups.</p>
<p>We follow the same procedure as before to calculate the potential burst frequency, first for the ‘harder’ bursts:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hard_burst_res</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span>
    <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;interp_hardness&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">0.6</span>
<span class="p">]</span>
<span class="n">hard_burst_per_chunk</span> <span class="o">=</span> <span class="n">hard_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">hard_burst_per_chunk</span> <span class="o">=</span> <span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">time_chunk_hard_peak_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_chunk_size</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">time_chunk_hard_peak_freq</span><span class="p">[</span><span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">time_chunk_size</span><span class="p">[</span><span class="n">hard_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then for the ‘softer’ bursts:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">soft_burst_res</span> <span class="o">=</span> <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span>
    <span class="n">wt_agg_lc_demo_burst_res</span><span class="p">[</span><span class="s2">&quot;interp_hardness&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.6</span>
<span class="p">]</span>
<span class="n">soft_burst_per_chunk</span> <span class="o">=</span> <span class="n">soft_burst_res</span><span class="p">[</span><span class="s2">&quot;time_chunk_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">soft_burst_per_chunk</span> <span class="o">=</span> <span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">time_chunk_soft_peak_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_chunk_size</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">time_chunk_soft_peak_freq</span><span class="p">[</span><span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">time_chunk_size</span><span class="p">[</span><span class="n">soft_burst_per_chunk</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The distributions of potential burst frequency for the softer and harder bursts seem
fairly similar:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">time_chunk_hard_peak_freq</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">freq_bins</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkslategray&quot;</span><span class="p">,</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Hard&#39; peaks&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">time_chunk_soft_peak_freq</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">freq_bins</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span>
    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;stepfilled&quot;</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Soft&#39; peaks&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency of peak detection [Hz]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/57a86d4aeae1779a35e8e3d3ef1f5887b06434576324429d7195e5d8a463ead3.png" src="../../../_images/57a86d4aeae1779a35e8e3d3ef1f5887b06434576324429d7195e5d8a463ead3.png" />
</div>
</div>
<p>When we view the ‘harder’ and ‘softer’ burst frequencies as a function of time,
however, we see a stark division between the two sets of frequencies on the plot.</p>
<p>We observe that most of the time chunks with a non-zero ‘hard’ (&gt;-0.6) burst frequency
have a ‘soft’ (&lt;=-0.6) burst frequency of zero, and vice versa.</p>
<p>Not only that, but most of the non-zero <strong>‘hard’</strong> burst frequencies are found in the
earliest observations, and then most of the subsequent time chunks only have
non-zero <strong>‘soft’</strong> burst frequencies.</p>
<p>This may indicate that there <strong>is</strong> an evolution of the burst hardness ratio over
time, though more exploration of the data, the techniques we use, and the choice of
‘hardness’ boundary would be required to confidently state this.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_hard_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkslategray&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Hard&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_soft_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Soft&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The x-axis data were in the form of datetimes, and we can use a matplotlib</span>
<span class="c1">#  formatted to ensure that the tick labels are displayed correctly</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Hh-%Mm </span><span class="si">%d</span><span class="s2">-%b-%Y&quot;</span><span class="p">))</span>
<span class="c1"># We also rotate the tick labels to make them easier to read</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">):</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency of peak detection [Hz]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># ----------- INSET ONE -----------</span>

<span class="n">inset_one_low_lim</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">inset_one_upp_lim</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2000-10-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

<span class="n">axins_one</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
<span class="c1"># Configure the ticks on the new axis</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to replot the light curve data on the inset axis</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_hard_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkslategray&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Hard&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_soft_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Soft&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Setting the time range of the zoomed view</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">inset_one_low_lim</span><span class="p">,</span> <span class="n">inset_one_upp_lim</span><span class="p">)</span>

<span class="n">axins_one</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axins_one</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins_one</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ----------- INSET TWO -----------</span>

<span class="n">inset_two_low_lim</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2010-10-11&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>
<span class="n">inset_two_upp_lim</span> <span class="o">=</span> <span class="n">burst_id_demo_agg_lc</span><span class="o">.</span><span class="n">datetime_chunks</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">axins_two</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">inset_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.52</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(),</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[]</span>
<span class="p">)</span>
<span class="c1"># Configure the ticks on the new axis</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Have to replot the light curve data on the inset axis</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_hard_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkslategray&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Hard&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">datetime_chunk_centers</span><span class="p">,</span>
    <span class="n">time_chunk_soft_peak_freq</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">datetime_chunk_halfwidths</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;peru&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&#39;Soft&#39; peaks&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Setting the time range of the zoomed view</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">inset_two_low_lim</span><span class="p">,</span> <span class="n">inset_two_upp_lim</span><span class="p">)</span>

<span class="n">axins_two</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">axins_two</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">indicate_inset_zoom</span><span class="p">(</span><span class="n">axins_two</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/f62322400172e6e54a02959395be673a7202701b8e29d8dfcd569a416e1a9a19.png" src="../../../_images/f62322400172e6e54a02959395be673a7202701b8e29d8dfcd569a416e1a9a19.png" />
</div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this notebook<a class="headerlink" href="#about-this-notebook" title="Link to this heading">#</a></h2>
<p>Author: David J Turner, HEASARC Staff Scientist.</p>
<p>Author: Tess Jaffe, HEASARC Chief Archive Scientist.</p>
<p>Updated On: 2026-01-22</p>
<section id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/rxte.html">HEASARC RXTE mission page</a></p>
<p><a class="reference external" href="https://www.nasa.gov/universe/nasas-rxte-captures-thermonuclear-behavior-of-unique-neutron-star/">NASA press release on RXTE observations of T5X2</a></p>
<p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/recipes2/Screening.html?QuickLinksMenu=/vo/">HEASARC discussion of RXTE-PCA screening and filtering</a></p>
<p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xte/e-c_table.html">HEASARC RXTE-PCA energy-channel conversion table</a></p>
<p><a class="reference external" href="https://cxc.cfa.harvard.edu/ciao/dictionary/hardness_ratio.html">Chandra X-ray Center dictionary</a></p>
<p><a class="reference external" href="https://cxc.cfa.harvard.edu/csc/columns/spectral_properties.html">Chandra Source Catalog Hardness Ratio</a></p>
</section>
<section id="acknowledgements">
<h3>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h3>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012ApJ...748...82L/abstract">M. Linares et al. (2012)</a> - <em>Millihertz Quasi-periodic Oscillations and Thermonuclear Bursts from Terzan 5: A Showcase of Burning Regimes</em></p>
<p><a class="reference external" href="https://www.tandfonline.com/doi/full/10.1080/17437199.2025.2513916">M. Maier et al. (2024)</a> - <em>Systematic review of the effects of decision fatigue in healthcare professionals on medical decision-making</em></p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="analyze-rxte-spectra.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Exploring RXTE spectral observations of Eta Car</p>
      </div>
    </a>
    <a class="right-next"
       href="../nicer/nicer_index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">NICER</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-environments">Imports &amp; Environments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-data">1. Finding the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-find-the-rxte-observation-summary-master-table">Using Astroquery to find the RXTE observation summary (master) table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#identifying-rxte-observations-of-igr-j174802446-t5x2">Identifying RXTE observations of IGR J17480–2446/T5X2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-an-adql-query-advanced-alternative">Constructing an ADQL query [<strong>advanced alternative</strong>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-astroquery-to-fetch-datalinks-to-rxte-datasets">Using Astroquery to fetch datalinks to RXTE datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-the-data">2. Acquiring the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-easiest-way-to-download-data">The easiest way to download data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-only-the-archived-rxte-light-curves">Downloading only the archived RXTE light curves</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-the-archived-rxte-light-curves">3. Examining the archived RXTE light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collecting-like-light-curves-together">Collecting like light curves together</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-light-curve-files-into-python">Loading the light curve files into Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examining-long-term-variability">Examining long-term variability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interacting-with-aggregate-light-curves">Interacting with aggregate light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#which-observations-contributed-data">Which observations contributed data?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-constituent-light-curves">Retrieving constituent light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-all-data">Accessing all data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-data-for-a-specific-time-interval">Accessing data for a specific time interval</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-aggregated-light-curves">Visualizing aggregated light curves</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-new-rxte-pca-light-curves">4. Generating new RXTE-PCA light curves</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-specific-files-for-our-rxte-observations">Downloading specific files for our RXTE observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-rxte-pca-preparation-pipeline">Running the RXTE-PCA preparation pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-rxte-pca-good-time-interval-gti-files">Setting up RXTE-PCA good time interval (GTI) files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-light-curves-within-custom-energy-bounds">New light curves within custom energy bounds</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#building-rxte-pca-response-files">Building RXTE-PCA response files</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-light-curves">Generating the light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-light-curves-into-python">Loading the light curves into Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-new-custom-energy-band-light-curves">Visualizing new custom-energy-band light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-and-examining-hardness-ratio-curves">Calculating and examining hardness ratio curves</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#new-light-curves-with-high-temporal-resolution">New light curves with high temporal resolution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-new-light-curves">Generating new light curves</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Loading the light curves into Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-new-higher-time-resolution-light-curves">Visualizing new higher time-resolution light curves</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experimenting-with-an-automated-method-to-identify-bursts">5. Experimenting with an automated method to identify bursts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-transform-peak-finding">Wavelet transform peak finding</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-on-a-single-light-curve">Testing on a single light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-peak-times-identified-for-the-single-light-curve">Visualizing peak times identified for the single light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-wavelet-transform-peak-finding-to-the-whole-aggregated-light-curve">Applying wavelet transform peak finding to the whole aggregated light curve</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#storing-peak-information-in-a-pandas-dataframe">Storing peak information in a Pandas DataFrame</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-t5x2-properties-at-potential-burst-times">Exploring T5X2 properties at potential burst times</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#count-rates-at-potential-burst-times">Count rates at potential burst times</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hardness-ratios-at-potential-burst-times">Hardness ratios at potential burst times</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-light-curves-of-potential-bursts-with-hardness-information">Visualizing light curves of potential bursts with hardness information</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#number-and-frequency-of-potential-bursts">Number and frequency of potential bursts</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-peaks-did-we-find-in-each-time-chunk">How many peaks did we find in each time chunk?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-frequency-of-bursts">Calculating the frequency of bursts</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#does-the-frequency-of-peak-identification-evolve-with-time">Does the frequency of peak identification evolve with time?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#does-the-hardness-ratio-of-potential-bursts-evolve-with-time">Does the hardness ratio of potential bursts evolve with time?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By HEASARC developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026, HEASARC developers.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>