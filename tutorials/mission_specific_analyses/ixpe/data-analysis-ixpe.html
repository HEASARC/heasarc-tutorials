
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting started with preprocessed IXPE data &#8212; HEASARC Tutorial Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=79d33dc3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-R7YGYK7HYQ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-R7YGYK7HYQ');
            </script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/mission_specific_analyses/ixpe/data-analysis-ixpe';</script>
    <link rel="icon" href="../../../_static/heasarc_favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Swift" href="../swift/swift_index.html" />
    <link rel="prev" title="IXPE" href="ixpe_index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p class='beta-banner'>The HEASARC tutorials resource is in <strong>BETA</strong> and may be subject to significant changes.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/heasarc_logo.png" class="logo__image only-light" alt="High Energy Astrophysics Science Archive Research Center - Home"/>
    <script>document.write(`<img src="../../../_static/heasarc_logo.png" class="logo__image only-dark" alt="High Energy Astrophysics Science Archive Research Center - Home"/>`);</script>
  
  
    <p class="title logo__title">v0.1</p>
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/HEASARC/heasarc-tutorials" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../about/about_index.html">About</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../about/authors.html">Contributors</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developing skills with HEASARC services</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../heasarc_service_skills/sciserver-data-find-download.html">Using PyVO to find and acquire HEASARC data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mission specific tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../nustar/nustar_index.html">NuSTAR</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nustar/data-analysis-nustar.html">Analyzing a single NuSTAR observation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../rxte/rxte_index.html">RXTE</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../rxte/analyze-rxte-spectra.html">Exploring RXTE spectral observations of Eta Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rxte/analyze-rxte-lightcurves.html">Using archived and newly generated RXTE light curves</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nicer/nicer_index.html">NICER</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nicer/data-analysis-nicer.html">Getting started with NICER data</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="ixpe_index.html">IXPE</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Getting started with preprocessed IXPE data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../swift/swift_index.html">Swift</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../swift/getting-started-swift-xrt.html">Getting started with Swift-XRT</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful high-energy tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy_index.html">HEASoftPy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/heasoftpy/heasoftpy-getting-started.html">Getting started with HEASoftPy</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas_index.html">pySAS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../useful_high_energy_tools/pysas/pysas-short-intro.html">Short introduction to pySAS</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/edit/main/tutorials/mission_specific_analyses/ixpe/data-analysis-ixpe.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/HEASARC/heasarc-tutorials/issues/new?title=Issue%20on%20page%20%2Ftutorials/mission_specific_analyses/ixpe/data-analysis-ixpe.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/tutorials/mission_specific_analyses/ixpe/data-analysis-ixpe.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Getting started with preprocessed IXPE data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-ixpe-data-files-for-01004701">1. Downloading the IXPE data files for 01004701</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-structure-of-ixpe-data">2. Exploring the structure of IXPE data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-spectro-polarimetric-data-products">3. Extracting spectro-polarimetric data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-source-and-background-regions">Defining source and background regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-extractor-tool">Running the extractor tool</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-response-files">Obtaining response files</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-response-versions">Setting response versions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-quzcif-to-get-the-response-files">Using <code class="docutils literal notranslate"><span class="pre">quzcif</span></code> to get the response files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-spectro-polarimetric-data-into-pyxspec-and-fitting-a-model">4. Loading spectro-polarimetric data into pyXspec and fitting a model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-pyxspec">Configuring PyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-spectra-into-pyxspec">Reading the spectra into pyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-energy-range-to-fit">Selecting the energy range to fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-spectro-polarimetric-model">Setting up the spectro-polarimetric model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-model-fit-through-pyxspec">Running the model fit through pyXspec</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">5. Visualizing the results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-traditional-x-ray-spectrum">A ‘traditional’ X-ray spectrum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polarization-angle-vs-energy">Polarization angle vs. energy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-results-from-xspec">6. Interpreting the results from XSPEC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-flux-and-calculating-mdp">Determining the flux and calculating MDP</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="getting-started-with-preprocessed-ixpe-data">
<h1>Getting started with preprocessed IXPE data<a class="headerlink" href="#getting-started-with-preprocessed-ixpe-data" title="Link to this heading">#</a></h1>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<p>By the end of this tutorial, you will be able to:</p>
<ul class="simple">
<li><p>Find and access preprocessed (“level 2”) IXPE data.</p></li>
<li><p>Extract events from source and background regions.</p></li>
<li><p>Perform an initial spectro-polarimetric fit to the IXPE data.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook is intended to get you started using and analyzing observations taken by the
Imaging X-ray Polarimetry Explorer (IXPE); a NASA X-ray telescope that can measure the polarization of
incident X-ray photons, in addition to their position, arrival time, and energy.</p>
<p>IXPE’s primary purpose is to study the polarization of emission from a variety of X-ray sources, and it is the first
NASA X-ray telescope dedicated to polarization studies. These capabilities mean that IXPE data are, in some respects,
unlike those of other X-ray telescopes (Chandra, XMM, eROSITA, etc.), and special care needs to be taken when
analyzing them.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>We highly recommend that new users read both the IXPE quick start guide and the recommendations
for statistical treatment of IXPE data documentments - links can be found in the ‘additional resources’ section of
this notebook.</p>
</div>
<p>We do not require the reprocessing of data for this example, the preprocessed (“level 2”) data products are sufficient.</p>
<p>If you need to reprocess the data, IXPE tools are available in the <code class="docutils literal notranslate"><span class="pre">heasoftpy</span></code> Python package.</p>
<section id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The IXPE ObsID, 01004701, of the data we will process (an observation of a blazar, <strong>Mrk 501</strong>).</p></li>
</ul>
</section>
<section id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Newly generated IXPE spectra-polarimetric data products and supporting files.</p></li>
<li><p>Visualizations of count-rate spectra.</p></li>
<li><p>Visualizations of polarization spectra.</p></li>
</ul>
</section>
<section id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Link to this heading">#</a></h3>
<p>As of 15th January 2026, this notebook takes ~90s to run to completion on Fornax using the ‘Default Astrophysics’ image and the ‘small’ server with 8GB RAM/ 2 cores.</p>
</section>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">heasoftpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hsp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xspec</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.heasarc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Heasarc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FuncFormatter</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="global-setup">
<h2>Global Setup<a class="headerlink" href="#global-setup" title="Link to this heading">#</a></h2>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extract_spec</span><span class="p">(</span><span class="n">inst</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that will use HEASoftPy to extract a source or background spectrum</span>
<span class="sd">    from an IXPE Level 2 event file.</span>

<span class="sd">    :param inst: The instrument name (e.g. &#39;det1&#39;, &#39;det2&#39;, &#39;det3&#39;)</span>
<span class="sd">    :param region_file: The region file to use for extraction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spec_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">OUT_PATH</span><span class="p">,</span>
        <span class="s2">&quot;ixpe_</span><span class="si">{i}</span><span class="s2">_</span><span class="si">{r}</span><span class="s2">_.pha&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">inst</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">r</span><span class="o">=</span><span class="n">region_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">region_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">region_file</span><span class="p">)</span>

    <span class="c1"># Setting &#39;allow_failure=False&#39; means exceptions will be raised if the call fails</span>
    <span class="k">with</span> <span class="n">hsp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">local_pfiles_context</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">extractor</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">evt_file_paths</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span>
            <span class="n">binlc</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
            <span class="n">eventsout</span><span class="o">=</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="n">imgfile</span><span class="o">=</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="n">fitsbinlc</span><span class="o">=</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="n">phafile</span><span class="o">=</span><span class="n">spec_out</span><span class="p">,</span>
            <span class="n">regionfile</span><span class="o">=</span><span class="n">region_file</span><span class="p">,</span>
            <span class="n">timefile</span><span class="o">=</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="n">stokes</span><span class="o">=</span><span class="s2">&quot;NEFF&quot;</span><span class="p">,</span>
            <span class="n">polwcol</span><span class="o">=</span><span class="s2">&quot;W_MOM&quot;</span><span class="p">,</span>
            <span class="n">tcol</span><span class="o">=</span><span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
            <span class="n">ecol</span><span class="o">=</span><span class="s2">&quot;PI&quot;</span><span class="p">,</span>
            <span class="n">xcolf</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
            <span class="n">xcolh</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
            <span class="n">ycolf</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">ycolh</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">noprompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">clobber</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="constants">
<h3>Constants<a class="headerlink" href="#constants" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IXPE ObsID that we will use for this example.</span>
<span class="n">OBS_ID</span> <span class="o">=</span> <span class="s2">&quot;01004701&quot;</span>
<span class="n">SRC_NAME</span> <span class="o">=</span> <span class="s2">&quot;Mrk 501&quot;</span>

<span class="c1"># The name of the HEASARC table that logs all IXPE observations</span>
<span class="n">HEASARC_TABLE_NAME</span> <span class="o">=</span> <span class="s2">&quot;ixmaster&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------- Configure global package settings --------------</span>
<span class="c1"># Raise Python exceptions if a heasoftpy task fails</span>
<span class="c1"># TODO Remove once this becomes a default in heasoftpy</span>
<span class="n">hsp</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">allow_failure</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Set up the method for spawning processes.</span>
<span class="n">mp</span><span class="o">.</span><span class="n">set_start_method</span><span class="p">(</span><span class="s2">&quot;fork&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>


<span class="c1"># ------------- Setting how many cores we can use --------------</span>
<span class="n">NUM_CORES</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">total_cores</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

<span class="k">if</span> <span class="n">NUM_CORES</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">NUM_CORES</span> <span class="o">=</span> <span class="n">total_cores</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;If manually overriding &#39;NUM_CORES&#39;, you must set it to an integer value.&quot;</span>
    <span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">NUM_CORES</span> <span class="o">&gt;</span> <span class="n">total_cores</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;If manually overriding &#39;NUM_CORES&#39;, the value must be less than or &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;equal to the total available cores (</span><span class="si">{</span><span class="n">total_cores</span><span class="si">}</span><span class="s2">).&quot;</span>
    <span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>


<span class="c1"># -------------- Set paths and create directories --------------</span>
<span class="c1"># Set up the path of the directory into which we will download IXPE data</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;../../../_data&quot;</span><span class="p">):</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../../../_data&quot;</span><span class="p">),</span> <span class="s2">&quot;IXPE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="s2">&quot;IXPE/&quot;</span>

<span class="c1"># Whatever the data directory is, make sure it is absolute.</span>
<span class="n">ROOT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>

<span class="c1"># Make sure the download directory exists.</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Setup path and directory into which we save output files from this example.</span>
<span class="n">OUT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;IXPE_output&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># --------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<hr class="docutils" />
<section id="downloading-the-ixpe-data-files-for-01004701">
<h2>1. Downloading the IXPE data files for 01004701<a class="headerlink" href="#downloading-the-ixpe-data-files-for-01004701" title="Link to this heading">#</a></h2>
<p>We’ve already decided on the IXPE observation we’re going to use for this example - as such we don’t need an
explorative stage where we use the name of our target, and its coordinates, to find an appropriate observation.</p>
<p>What we do need to know is where the data are stored, and to retrieve a link that we can use to download them - we
can achieve this using the IXPE summary table of observations, accessed using <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>.</p>
<p>The name of the observation table is stored in the <code class="docutils literal notranslate"><span class="pre">HEASARC_TABLE_NAME</span></code> constant, set up in the collapsed ‘Global Setup: Constants’ subsection above:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HEASARC_TABLE_NAME</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ixmaster&#39;
</pre></div>
</div>
</div>
</div>
<p>First, we construct a simple astronomical data query language (ADQL) query to find the row of the observation summary table
that corresponds to our chosen ObsID. This retrieves every column of the row whose ObsID matches the one we’re looking for:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;SELECT * &quot;</span>
    <span class="s2">&quot;from </span><span class="si">{c}</span><span class="s2"> as cat &quot;</span>
    <span class="s2">&quot;where cat.obsid=&#39;</span><span class="si">{oi}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oi</span><span class="o">=</span><span class="n">OBS_ID</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">HEASARC_TABLE_NAME</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">query</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;SELECT * from ixmaster as cat where cat.obsid=&#39;01004701&#39;&quot;
</pre></div>
</div>
</div>
</div>
<p>The query is then executed, and the returned value is converted to an Astropy table (necessary for the next step):</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_line</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">query_tap</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
<span class="n">obs_line</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1</i>
<table id="table140151207492976" class="table-striped table-bordered table-condensed">
<thead><tr><th>__row</th><th>obsid</th><th>name</th><th>ra</th><th>dec</th><th>lii</th><th>bii</th><th>roll_angle_req</th><th>time</th><th>end_time</th><th>fcw_1</th><th>fcw_2</th><th>fcw_3</th><th>exposure_1</th><th>exposure_2</th><th>exposure_3</th><th>ontime_1</th><th>ontime_2</th><th>ontime_3</th><th>processing_date</th><th>public_date</th><th>software_version</th><th>obs_type</th><th>coordinated</th><th>issue_flag</th><th>status</th><th>caldb_version</th><th>comments</th><th>prnb</th><th>title</th><th>pi_names</th><th>abstract</th><th>subject_category</th><th>category_code</th><th>priority</th><th>cycle</th><th>__x_ra_dec</th><th>__y_ra_dec</th><th>__z_ra_dec</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>deg</th><th>d</th><th>d</th><th></th><th></th><th></th><th>s</th><th>s</th><th>s</th><th>s</th><th>s</th><th>s</th><th>d</th><th>d</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th><th>object</th><th>object</th><th>int16</th><th>object</th><th>object</th><th>object</th><th>int32</th><th>object</th><th>object</th><th>object</th><th>object</th><th>int16</th><th>object</th><th>int16</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>285</td><td>01004701</td><td>MRK 501</td><td>253.4676</td><td>39.7602</td><td>63.6001</td><td>38.8591</td><td>--</td><td>59769.97458428</td><td>59772.04337753</td><td>open</td><td>open</td><td>open</td><td>97794.9257</td><td>96095.4274</td><td>97827.2522</td><td>97916.2185</td><td>96245.1984</td><td>97940.3379</td><td>59780.72141469</td><td>59788</td><td>Hea_10Mar2022_V6.30_IXPE_21JUNE2022_1.5</td><td>proposed</td><td></td><td>0</td><td>archived</td><td></td><td></td><td>--</td><td></td><td>IXPE Team</td><td></td><td>Bla</td><td>7</td><td>3</td><td>1</td><td>-0.736947981589561</td><td>-0.218747312767553</td><td>0.639575863825431</td></tr>
</table></div></div></div>
</div>
<p>From there we can easily identify the ‘data link’ that we need to download the actual data files - we simply pass the query return
to the <code class="docutils literal notranslate"><span class="pre">locate_data</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code>:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_links</span> <span class="o">=</span> <span class="n">Heasarc</span><span class="o">.</span><span class="n">locate_data</span><span class="p">(</span><span class="n">obs_line</span><span class="p">,</span> <span class="n">HEASARC_TABLE_NAME</span><span class="p">)</span>
<span class="n">data_links</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1</i>
<table id="table140145642440512" class="table-striped table-bordered table-condensed">
<thead><tr><th>ID</th><th>access_url</th><th>sciserver</th><th>aws</th><th>content_length</th><th>error_message</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>byte</th><th></th></tr></thead>
<thead><tr><th>object</th><th>object</th><th>str31</th><th>str44</th><th>int64</th><th>object</th></tr></thead>
<tr><td>ivo://nasa.heasarc/ixmaster?285</td><td>https://heasarc.gsfc.nasa.gov/FTP/ixpe/data/obs/01//01004701/</td><td>/FTP/ixpe/data/obs/01/01004701/</td><td>s3://nasa-heasarc/ixpe/data/obs/01/01004701/</td><td>1203321946</td><td></td></tr>
</table></div></div></div>
</div>
<p>This data link can be passed straight into the <code class="docutils literal notranslate"><span class="pre">download_data</span></code> method of <code class="docutils literal notranslate"><span class="pre">Heasarc</span></code>, and our observation data files
will be downloaded into the directory specified by <code class="docutils literal notranslate"><span class="pre">ROOT_DATA_DIR</span></code>.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Heasarc</span><span class="o">.</span><span class="n">download_data</span><span class="p">(</span><span class="n">data_links</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;aws&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">ROOT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Downloading data AWS S3 ... [astroquery.heasarc.core]
INFO: Enabling anonymous cloud data access ... [astroquery.heasarc.core]
INFO: downloading s3://nasa-heasarc/ixpe/data/obs/01/01004701/ [astroquery.heasarc.core]
</pre></div>
</div>
</div>
</div>
<p>Finally, we’ll take a quick look at the contents and structure of the downloaded data.</p>
<p>It should contain the standard IXPE data files, which include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event_l1</span></code> - This directory houses ‘level 1’ event files, which contain raw, unprocessed, event data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_l2</span></code> - The ‘level 2’ event files (processed and ready for use) are stored here.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auxil</span></code> - Contains auxiliary data files, such as exposure maps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hk</span></code> - Contains house-keeping data such as orbit files etc.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There may also be a <code class="docutils literal notranslate"><span class="pre">README</span></code> file in the root directory of the downloaded data - if this is the case, you should
read it carefully, as it will contain information about any known issues with the processing of the data.</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">OBS_ID_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">OBS_ID</span><span class="p">)</span>
<span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OBS_ID_PATH</span><span class="si">}</span><span class="s2">/*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/home/jovyan/project/_data/IXPE/01004701/auxil&#39;,
 &#39;/home/jovyan/project/_data/IXPE/01004701/event_l1&#39;,
 &#39;/home/jovyan/project/_data/IXPE/01004701/event_l2&#39;,
 &#39;/home/jovyan/project/_data/IXPE/01004701/hk&#39;]
</pre></div>
</div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>For a complete description of data formats of IXPE data directories, see the support documentation on the <a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/ixpe/analysis/#supportdoc">IXPE Website</a>.</p>
</div>
</section>
<section id="exploring-the-structure-of-ixpe-data">
<h2>2. Exploring the structure of IXPE data<a class="headerlink" href="#exploring-the-structure-of-ixpe-data" title="Link to this heading">#</a></h2>
<p>The ‘event_l2’ directory contains three event files, one per IXPE detector. We’re going to put
the full paths to these files in a directory, with the keys being ‘det1’, ‘det2’, and ‘det3’; this will save us
some inelegant string formatting every time we want to access them:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l2_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ROOT_DATA_DIR</span><span class="p">,</span> <span class="n">OBS_ID</span><span class="p">,</span> <span class="s2">&quot;event_l2&quot;</span><span class="p">)</span>
<span class="n">l2_path_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">l2_path</span><span class="p">)</span>

<span class="n">evt_file_paths</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;det</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;det&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l2_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">l2_path_files</span>
<span class="p">}</span>

<span class="n">evt_file_paths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;det1&#39;: &#39;/home/jovyan/project/_data/IXPE/01004701/event_l2/ixpe01004701_det1_evt2_v01.fits.gz&#39;,
 &#39;det2&#39;: &#39;/home/jovyan/project/_data/IXPE/01004701/event_l2/ixpe01004701_det2_evt2_v01.fits.gz&#39;,
 &#39;det3&#39;: &#39;/home/jovyan/project/_data/IXPE/01004701/event_l2/ixpe01004701_det3_evt2_v01.fits.gz&#39;}
</pre></div>
</div>
</div>
</div>
<p>Now, we’ll quickly examine the structure of the event files using a HEASoft tool called <code class="docutils literal notranslate"><span class="pre">fstruct</span></code> - rather than
going to the command line, we will simply use a HEASoftPy interface:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">fstruct</span><span class="p">(</span><span class="n">infile</span><span class="o">=</span><span class="n">evt_file_paths</span><span class="p">[</span><span class="s2">&quot;det1&quot;</span><span class="p">],</span> <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  No. Type     EXTNAME      BITPIX Dimensions(columns)      PCOUNT  GCOUNT
 
   0  PRIMARY                  8     0                           0    1
   1  BINTABLE EVENTS          8     48(10) 101073               0    1
 
      Column Name                Format     Dims       Units     TLMIN  TLMAX
      1 TRG_ID                     J
      2 TIME                       D                   s
      3 STATUS                     16X
      4 STATUS2                    16X
      5 PI                         J                   chan          0      374
      6 W_MOM                      E
      7 X                          E                   pixel         1      600
      8 Y                          E                   pixel         1      600
      9 Q                          D
     10 U                          D
 
   2  BINTABLE GTI             8     16(2) 95                    0    1
 
      Column Name                Format     Dims       Units     TLMIN  TLMAX
      1 START                      D
      2 STOP                       D
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-spectro-polarimetric-data-products">
<h2>3. Extracting spectro-polarimetric data products<a class="headerlink" href="#extracting-spectro-polarimetric-data-products" title="Link to this heading">#</a></h2>
<p>Here we get to the fun part - the creation and analysis of some IXPE data products!</p>
<section id="defining-source-and-background-regions">
<h3>Defining source and background regions<a class="headerlink" href="#defining-source-and-background-regions" title="Link to this heading">#</a></h3>
<p>To obtain source and background spectra from the ‘level 2’ files, we need to define source and background regions for
the extraction.</p>
<p>Defining regions can be done in a number of ways, using automated source finding tools, drawing them onto
images using <a class="reference external" href="https://sites.google.com/cfa.harvard.edu/saoimageds9">SAOImage DS9</a>, or (as we show here) by manually constructing region files.</p>
<p>In this case we define the source region as a <span class="math notranslate nohighlight">\(60^{\prime\prime}\)</span> circle centered on Mrk 501.</p>
<p>The background region is an annulus with an inner radius of <span class="math notranslate nohighlight">\(132^{\prime\prime}\)</span> and outer radius <span class="math notranslate nohighlight">\(252^{\prime\prime}\)</span>.</p>
<p>The region files should be independently defined for each telescope; in this example, the source location has the same celestial coordinates within 0.25” for all three detectors, so a single source and a single background region can be used.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;src.reg&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">srco</span><span class="p">:</span>
    <span class="n">srco</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;circle(16:53:51.766,+39:45:44.41,60.000&quot;)&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;bck.reg&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bcko</span><span class="p">:</span>
    <span class="n">bcko</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;annulus(16:53:51.766,+39:45:44.41,132.000&quot;,252.000&quot;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-the-extractor-tool">
<h3>Running the extractor tool<a class="headerlink" href="#running-the-extractor-tool" title="Link to this heading">#</a></h3>
<p>Spectro-polarimetric data products will be extracted using another HEASoft tool called <code class="docutils literal notranslate"><span class="pre">extractor</span></code>. Again, we will
use the HEASoftPy interface rather than running directly in the command line.</p>
<p>Our goal is to extract I, Q, and U spectra (within the source and background regions defined above) from
IXPE ‘level 2’ event lists, for every detector. That means there will be three source spectra, and three
background spectra, per detector.</p>
<p>Help information for all HEASoftPy tools can be displayed using the <code class="docutils literal notranslate"><span class="pre">help()</span></code> function:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">hsp</span><span class="o">.</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function extractor in module heasoftpy.fcn:

extractor(args=None, **kwargs)
    Parameters
    ----------
    exitnow            :  Exit now: (default: no)
    filename     (Req) :  Input file name: (default: good.evt)
    eventsout    (Req) :  Name of output events file: (default: NONE)
    imgfile      (Req) :  Image output file name: (default: none)
    binf               :  Rebinning factor for region selection: (default: 1)
    fullimage          :  Output image is full-size? (default: yes)
    phafile      (Req) :  PHA output FITS file name: (default: test.pha)
    specbin            :  Binning factor for spectrum: (default: 1)
    wtmapb             :  Build a WMAP for the spectrum? (default: yes)
    wtmapfix           :  Set WMAP pixels outside selected region to -1? (default: yes)
    swmapx             :  Invert X axis when converting WMAP to IMAGE coordinates (default: no)
    swmapy             :  Invert Y axis when converting WMAP to IMAGE coordinates (default: no)
    binh               :  Rebinning factor for WMAP histogram selection: (default: 1)
    wmapver            :  HDUVERS number for the output WMAP format (default: 2)
    fitsbinlc    (Req) :  Name of fits binned light curve: (default: NONE)
    qdpfile            :  QDP light curve output file name: (default: NONE)
    binlc        (Req) :  Bin size for light curve: (default: 64)
    lcthresh           :  Light curve threshold: (default: 1.0)
    lcthwarn           :  Light curve threshold warning: (default: 3.0)
    lcstart            :  Light curve start time (in GTI units): (default: -1.0)
    lctzero            :  Set TIMEZERO keyword to first bin of lightcurve?: (default: yes)
    unbinlc            :  Name of unbinned light curve: (default: NONE)
    regionfile   (Req) :  Region file name: (default: test.reg)
    timefile     (Req) :  Time selection file name: (default: none)
    adjustgti          :  Adjust output GTIs to match frame boundaries?: (default: no)
    gtinam             :  Name of the GTI extension in the time selection file: (default: GTI)
    xcolf        (Req) :  Name of X column for image creation/region selection: (default: DETX)
    ycolf        (Req) :  Name of Y column for image creation/region selection: (default: DETY)
    zcolf              :  Name of column for Z axis of image: (default: NONE)
    xint               :  Digitization for image X-axis (unbinned coordinates): (default: 1.0)
    yint               :  Digitization for image Y-axis (unbinned coordinates): (default: 1.0)
    tcol         (Req) :  Name of TIME column: (default: TIME)
    ecol         (Req) :  Name of ENERGY column: (default: PI)
    stokes       (Req) :  Stokes parameter option NONE/NEFF/SIMPLE/UNWEIGHTED: (default: NONE)
    polwcol            :  Name of polarization weights column: (default: NONE)
    ccol               :  Name of the column used to index multiple GTIs: (default: CCD_ID)
    gcol               :  Name of the GRADE or PATTERN column: (default: NONE)
    gstring            :  String defining filter on GRADE: (default: NONE)
    xcolh        (Req) :  Name of X column for WMAP histogram: (default: DETX)
    ycolh        (Req) :  Name of Y column for WMAP histogram: (default: DETY)
    gtitxt             :  Name of output GTI text file: (default: NONE)
    xronwn             :  Name of output XRONOS window file: (default: NONE)
    events             :  Name of the EVENTS extension: (default: EVENTS)
    gti                :  Name of the GTI extension in the event file: (default: STDGTI)
    timeorder          :  True if time ordered event files: (default: no)
    timeref            :  TJD time 0 in MJD: (default: 40000.0)
    tpixrpar           :  TIMEPIXR value to use if not in events file: (default: -999.0)
    usetpixrsel        :  Use TIMEPIXR correction when selecting events: (default: no)
    eventkey           :  File with list of keywords you don&#39;t want copied:&quot;&#39; (default: NONE)
    phamax             :  Keyword for maximum pha channel: (default: PHA_BINS)
    xfkey              :  Name of keyword for size of X for region: (default: NONE)
    yfkey              :  Name of keyword for size of Y for region: (default: NONE)
    xhkey              :  Name of keyword for size of X for WMAP histogram: (default: NONE)
    yhkey              :  Name of keyword for size of Y for WMAP histogram: (default: NONE)
    copyall            :  Copy all extensions? (default: no)
    clobber            :  Overwrite existing files? (default: yes)
    maxgti             :  Maximum number of GTIs: (default: 1000000)
    maxccd             :  Maximum number of chips: (default: 20)
    stride             :  Size of stride when reading input events: (default: 1000)
    mode               :   (default: ql)

    --------------------------------------------------
       fhelp-generated text
    --------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>To maximize efficiency, and take advantage of the multiple cores we have available, we set up a parallel processing
pool using the <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module. The call to <code class="docutils literal notranslate"><span class="pre">extractor</span></code> is wrapped in a function that takes the detector
number and the region file to generate the product within as arguments; the function is defined in the
‘Global Setup: Functions’ subsection near the top of the notebook.</p>
<p>Output files are saved in the <code class="docutils literal notranslate"><span class="pre">OUT_PATH</span></code> directory, which is set up in the ‘Global Setup: Constants’ subsection.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arg_combs</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">evt_file_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="s2">&quot;src.reg&quot;</span><span class="p">,</span> <span class="s2">&quot;bck.reg&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NUM_CORES</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">extract_spec</span><span class="p">,</span> <span class="n">arg_combs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Listing the files in the output directory is a good way to check that the extraction was successful, though the
HEASoftPy call will also raise exceptions if the extraction fails (as we passed <code class="docutils literal notranslate"><span class="pre">allow_failure=False</span></code>).</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;src.reg&#39;,
 &#39;bck.reg&#39;,
 &#39;ixpe_det3_bck_I.pha&#39;,
 &#39;ixpe_det1_bck_I.pha&#39;,
 &#39;ixpe_det2_src_I.pha&#39;,
 &#39;ixpe_det1_src_I.pha&#39;,
 &#39;ixpe_det2_bck_I.pha&#39;,
 &#39;ixpe_det3_src_I.pha&#39;,
 &#39;ixpe_det3_bck_Q.pha&#39;,
 &#39;ixpe_det1_bck_Q.pha&#39;,
 &#39;ixpe_det2_src_Q.pha&#39;,
 &#39;ixpe_det2_bck_Q.pha&#39;,
 &#39;ixpe_det1_src_Q.pha&#39;,
 &#39;ixpe_det3_src_Q.pha&#39;,
 &#39;ixpe_det3_bck_U.pha&#39;,
 &#39;ixpe_det2_src_U.pha&#39;,
 &#39;ixpe_det1_bck_U.pha&#39;,
 &#39;ixpe_det2_bck_U.pha&#39;,
 &#39;ixpe_det1_src_U.pha&#39;,
 &#39;ixpe_det3_src_U.pha&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtaining-response-files">
<h3>Obtaining response files<a class="headerlink" href="#obtaining-response-files" title="Link to this heading">#</a></h3>
<p>Performing any meaningful analysis of IXPE spectro-polarimetric data requires response files that describe the
sensitivity and characteristics of the instruments. These include the standard ‘Response Matrix File’ (RMF) and
‘Ancillary Response File’ (ARF) files, which map the detector channels to specific energies and describe how the
sensitivity of the detector changes with energy respectively; it also includes the non-standard ‘Modulation Response File’ (MRF)
files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The MRF is defined by the product of the energy-dependent modulation factor, <span class="math notranslate nohighlight">\(\mu\)</span>(E) and the ARF. The modulation
factor is what map the ‘photo-electron tracks’ measured by IXPE’s detectors to the physical polarization degree.</p>
</div>
<p>For a given IXPE detector, the ‘I’ spectrum requires different response files to the ‘Q’ and ‘U’ spectra.</p>
<ul class="simple">
<li><p><strong>I</strong> - The RMF and ARF describe the response.</p></li>
<li><p><strong>Q</strong> and <strong>U</strong> - The RMF and <em>MRF</em> describe the response.</p></li>
</ul>
<p>We’re going to fetch these files from the HEASARC CalDB, or rather we’ll fetch links to them, as we can use a remote
IXPE CalDB for our spectral analysis later. The HEASoft tool <code class="docutils literal notranslate"><span class="pre">quzcif</span></code> allows us to search the remote CalDB - we can
find out more about this tool examining the help information:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">hsp</span><span class="o">.</span><span class="n">quzcif</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function quzcif in module heasoftpy.fcn:

quzcif(args=None, **kwargs)
    Parameters
    ----------
    mission      (Req) :  Name of Mission (default: )
    instrument   (Req) :  Name of Instrument (default: )
    detector     (Req) :  Name of Detector (- if not required) (default: -)
    filter       (Req) :  Name of Filter (- if not required) (default: -)
    codename     (Req) :  Calibration Dataset Codename (default: )
    date         (Req) :  Requested Date in yyyy-mm-dd format (default: )
    time         (Req) :  Requested Time in hh:mm:ss format (default: )
    expr         (Req) :  Boolean selection expression for Boundary params(- if not required) (default: -)
    maxret             :  Maximum number of datasets to print to the screen (&lt;0: return all available rows) (default: -1)
    retrieve           :  Download remote file via ftp or http? (default: no)
    clobber            :  Overwrite existing output file? (default: no)
    chatter            :  Chatter flag (default: 0)
    quality            :  &#39;Quality value of &quot;good&quot; file (default = 0)&#39; (default: 0)
    nfound             :  Number of datasets found which match selection criteria (default: 0)
    mode               :   (default: ql)

    --------------------------------------------------
       fhelp-generated text
    --------------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>Note that the output of <code class="docutils literal notranslate"><span class="pre">hsp.quzcif</span></code> for a particular detector/file-type combination provides links to multiple files.</p>
<p>This is because there are three sets of response files, corresponding to the different weighting schemes, as well as
different versions of those files.</p>
<ul class="simple">
<li><p>For the ‘NEFF’ weighting, use ‘alpha07_<code class="docutils literal notranslate"><span class="pre">vv</span></code>’.</p></li>
<li><p>For the ‘SIMPLE’ weighting, use ‘alpha075simple_<code class="docutils literal notranslate"><span class="pre">vv</span></code>’.</p></li>
<li><p>For the ‘UNWEIGHTED’ version, use ‘20170101_<code class="docutils literal notranslate"><span class="pre">vv</span></code>’.</p></li>
</ul>
<p>Where <code class="docutils literal notranslate"><span class="pre">vv</span></code> is the version number of the response files.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We strongly recommend that you use the latest version of the response files!</p>
</div>
<p>For our example, we’re going to use <code class="docutils literal notranslate"><span class="pre">vv</span> <span class="pre">=</span> <span class="pre">02</span></code> for the RMF and <code class="docutils literal notranslate"><span class="pre">vv</span> <span class="pre">=</span> <span class="pre">03</span></code> for the ARF and MRF.</p>
<section id="setting-response-versions">
<h4>Setting response versions<a class="headerlink" href="#setting-response-versions" title="Link to this heading">#</a></h4>
<p>We’ll set up variables to hold the response version numbers:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmf_ver</span> <span class="o">=</span> <span class="s2">&quot;02&quot;</span>
<span class="n">arf_ver</span> <span class="o">=</span> <span class="s2">&quot;03&quot;</span>
<span class="n">mrf_ver</span> <span class="o">=</span> <span class="s2">&quot;03&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-quzcif-to-get-the-response-files">
<h4>Using <code class="docutils literal notranslate"><span class="pre">quzcif</span></code> to get the response files<a class="headerlink" href="#using-quzcif-to-get-the-response-files" title="Link to this heading">#</a></h4>
<p>Now we use the HEASARC tool to actually fetch the response files:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting the on-axis RMFs, ARFs, and MRFs</span>

<span class="n">resps</span> <span class="o">=</span> <span class="p">{</span><span class="n">det</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rmf&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;arf&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;mrf&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span> <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">evt_file_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

<span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">evt_file_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">det_str</span> <span class="o">=</span> <span class="s2">&quot;DU</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">rmf_res</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">quzcif</span><span class="p">(</span>
        <span class="n">mission</span><span class="o">=</span><span class="s2">&quot;ixpe&quot;</span><span class="p">,</span>
        <span class="n">instrument</span><span class="o">=</span><span class="s2">&quot;gpd&quot;</span><span class="p">,</span>
        <span class="n">detector</span><span class="o">=</span><span class="n">det_str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">codename</span><span class="o">=</span><span class="s2">&quot;MATRIX&quot;</span><span class="p">,</span>
        <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">resps</span><span class="p">[</span><span class="n">det</span><span class="p">][</span><span class="s2">&quot;rmf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rmf_res</span><span class="o">.</span><span class="n">output</span> <span class="k">if</span> <span class="s2">&quot;alpha075_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmf_ver</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">arf_res</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">quzcif</span><span class="p">(</span>
        <span class="n">mission</span><span class="o">=</span><span class="s2">&quot;ixpe&quot;</span><span class="p">,</span>
        <span class="n">instrument</span><span class="o">=</span><span class="s2">&quot;gpd&quot;</span><span class="p">,</span>
        <span class="n">detector</span><span class="o">=</span><span class="n">det_str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">codename</span><span class="o">=</span><span class="s2">&quot;SPECRESP&quot;</span><span class="p">,</span>
        <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">resps</span><span class="p">[</span><span class="n">det</span><span class="p">][</span><span class="s2">&quot;arf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arf_res</span><span class="o">.</span><span class="n">output</span> <span class="k">if</span> <span class="s2">&quot;alpha075_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arf_ver</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">mrf_res</span> <span class="o">=</span> <span class="n">hsp</span><span class="o">.</span><span class="n">quzcif</span><span class="p">(</span>
        <span class="n">mission</span><span class="o">=</span><span class="s2">&quot;ixpe&quot;</span><span class="p">,</span>
        <span class="n">instrument</span><span class="o">=</span><span class="s2">&quot;gpd&quot;</span><span class="p">,</span>
        <span class="n">detector</span><span class="o">=</span><span class="n">det_str</span><span class="p">,</span>
        <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">codename</span><span class="o">=</span><span class="s2">&quot;MODSPECRESP&quot;</span><span class="p">,</span>
        <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">resps</span><span class="p">[</span><span class="n">det</span><span class="p">][</span><span class="s2">&quot;mrf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mrf_res</span><span class="o">.</span><span class="n">output</span> <span class="k">if</span> <span class="s2">&quot;alpha075_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mrf_ver</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="loading-spectro-polarimetric-data-into-pyxspec-and-fitting-a-model">
<h2>4. Loading spectro-polarimetric data into pyXspec and fitting a model<a class="headerlink" href="#loading-spectro-polarimetric-data-into-pyxspec-and-fitting-a-model" title="Link to this heading">#</a></h2>
<p>We now have everything we need to load the extracted spectra into pyXspec and fit a model to them!</p>
<section id="configuring-pyxspec">
<h3>Configuring PyXspec<a class="headerlink" href="#configuring-pyxspec" title="Link to this heading">#</a></h3>
<p>Here we configure some of pyXspec’s behaviors. We set the verbosity to ‘0’ to suppress printed output, make sure the
plot axes are energy (for the x-axis), and normalized counts per second (for the y-axis).</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Severely imits the output of pyXspec, though chatter = 0 will still</span>
<span class="c1">#  let some messages through.</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">chatter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Other xspec settings</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">xAxis</span> <span class="o">=</span> <span class="s2">&quot;keV&quot;</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">nIterations</span> <span class="o">=</span> <span class="mi">500</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-the-spectra-into-pyxspec">
<h3>Reading the spectra into pyXspec<a class="headerlink" href="#reading-the-spectra-into-pyxspec" title="Link to this heading">#</a></h3>
<p>This snippet uses our previously defined <code class="docutils literal notranslate"><span class="pre">resps</span></code> dictionary to load the spectra and their requisite response files
into pyXspec. The ‘I’, ‘U’, and ‘Q’ spectra are all loaded in for each detector. The ‘contextlib.chdir’ statement is
used to change the working directory to the directory containing spectral files so that the spectra can be loaded, and
then to ensure that the working directory is reset.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">resps</span> <span class="o">=</span> <span class="p">{</span><span class="n">det</span><span class="p">:</span> <span class="n">resps</span><span class="p">[</span><span class="n">det</span><span class="p">]</span> <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">resps</span><span class="p">)}</span>

<span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">):</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Iterator index to keep the spectrum numbering correct</span>
    <span class="k">for</span> <span class="n">det</span><span class="p">,</span> <span class="n">supp_files</span> <span class="ow">in</span> <span class="n">resps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">du</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">det</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># ----------- Load the I data -----------</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">:</span><span class="si">%i</span><span class="s2"> ixpe_det</span><span class="si">%i</span><span class="s2">_src_I.pha&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">du</span><span class="p">,</span> <span class="n">du</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">du</span><span class="p">))</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">du</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">du</span><span class="o">+</span><span class="n">x</span><span class="si">}</span><span class="s2"> ixpe_det</span><span class="si">{</span><span class="n">du</span><span class="si">}</span><span class="s2">_src_I.pha&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="n">du</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># Load response and background files</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;rmf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">arf</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;arf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s2">&quot;ixpe_det</span><span class="si">%i</span><span class="s2">_bck_I.pha&quot;</span> <span class="o">%</span> <span class="n">du</span>
        <span class="c1"># ---------------------------------------</span>

        <span class="c1"># ----------- Load the Q data -----------</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">:</span><span class="si">%i</span><span class="s2"> ixpe_det</span><span class="si">%i</span><span class="s2">_src_Q.pha&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">du</span><span class="p">,</span> <span class="n">du</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">du</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="n">du</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># #Load response and background files</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;rmf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">arf</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;mrf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s2">&quot;ixpe_det</span><span class="si">%i</span><span class="s2">_bck_Q.pha&quot;</span> <span class="o">%</span> <span class="n">du</span>
        <span class="c1"># ---------------------------------------</span>

        <span class="c1"># ----------- Load the U data -----------</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">:</span><span class="si">%i</span><span class="s2"> ixpe_det</span><span class="si">%i</span><span class="s2">_src_U.pha&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">du</span><span class="p">,</span> <span class="n">du</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">du</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="n">du</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># #Load response and background files</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;rmf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">arf</span> <span class="o">=</span> <span class="n">supp_files</span><span class="p">[</span><span class="s2">&quot;mrf&quot;</span><span class="p">]</span>
        <span class="n">s</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s2">&quot;ixpe_det</span><span class="si">%i</span><span class="s2">_bck_U.pha&quot;</span> <span class="o">%</span> <span class="n">du</span>
        <span class="c1"># ---------------------------------------</span>

        <span class="n">x</span> <span class="o">+=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-the-energy-range-to-fit">
<h3>Selecting the energy range to fit<a class="headerlink" href="#selecting-the-energy-range-to-fit" title="Link to this heading">#</a></h3>
<p>We decide to ignore all channels that are outside the 2.0-8.0 keV energy range, as this is the nominal ‘usable’
energy range for IXPE.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Do not pass integers to <code class="docutils literal notranslate"><span class="pre">ignore</span></code> when trying to ignore an energy range, as that will actually
ignore a range of <strong>channels</strong>. So don’t be tempted to use xs.AllData.ignore(“0-2, 8-**”) here!</p>
</div>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="s2">&quot;0.0-2.0, 8.0-**&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-up-the-spectro-polarimetric-model">
<h3>Setting up the spectro-polarimetric model<a class="headerlink" href="#setting-up-the-spectro-polarimetric-model" title="Link to this heading">#</a></h3>
<p>We’ll to fit a fairly standard galactic-hydrogen-column-absorbed (<em>tbabs</em>) power-law model to the data (with a
multiplicative constant that accounts for the differing responses of the detectors), but we also include a more
unusual, polarization-related, model - ‘polconst’.</p>
<p>This will constrain the polarization angle and fraction of the source, by using exploiting the ‘U’ and ‘Q’ spectra
we generated and loaded earlier. By using ‘polconst’ we are intrinsically assuming that the polarization angle is
constant with energy.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the model that we want to fit</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;polconst*tbabs(constant*powerlaw)&quot;</span><span class="p">)</span>

<span class="c1"># Set initial guesses for parameter values</span>
<span class="n">model</span><span class="o">.</span><span class="n">polconst</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">model</span><span class="o">.</span><span class="n">polconst</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span>
<span class="n">model</span><span class="o">.</span><span class="n">TBabs</span><span class="o">.</span><span class="n">nH</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">model</span><span class="o">.</span><span class="n">powerlaw</span><span class="o">.</span><span class="n">PhoIndex</span> <span class="o">=</span> <span class="mf">2.7</span>
<span class="n">model</span><span class="o">.</span><span class="n">powerlaw</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
</div>
<p>The previous step sets up a different version of our model for each detector but also links many of the parameters.
This means that we are jointly fitting the data for each instrument, which increases our constraining power over fitting
an individual instrument.</p>
<p>Here we read out the separate models and set the constant multiplicative factor for each instrument.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">m1</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">m1</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">factor</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">m2</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">m3</span><span class="o">.</span><span class="n">constant</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="mf">0.9</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-the-model-fit-through-pyxspec">
<h3>Running the model fit through pyXspec<a class="headerlink" href="#running-the-model-fit-through-pyxspec" title="Link to this heading">#</a></h3>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">show</span></code> method to examine the final parameter values of the fitted model (we have to temporarily relax the zero verbosity we set earlier on):</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">chatter</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">chatter</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualizing-the-results">
<h2>5. Visualizing the results<a class="headerlink" href="#visualizing-the-results" title="Link to this heading">#</a></h2>
<p>We will now extract information from pyXspec and plot various aspects of the fitted models and results using the
<code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> package. This offers more flexibility than the built-in plotting functions in pyXspec.</p>
<section id="a-traditional-x-ray-spectrum">
<h3>A ‘traditional’ X-ray spectrum<a class="headerlink" href="#a-traditional-x-ray-spectrum" title="Link to this heading">#</a></h3>
<p>We can fetch the count rate, and energy bin centers, from pyXspec:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This command will construct a logged-data plot of the spectrum</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="s2">&quot;lda&quot;</span><span class="p">)</span>

<span class="n">yVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
<span class="n">yErr</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">yErr</span><span class="p">()</span>
<span class="n">xVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
<span class="n">xErr</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">xErr</span><span class="p">()</span>
<span class="n">mop</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Using that information, we can plot a ‘traditional’ X-ray spectrum:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot the spectral data points, with error bars</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">xVals</span><span class="p">,</span>
    <span class="n">yVals</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">xErr</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">yErr</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;k.&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;IXPE Data [01004701]&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add the fitted model line to the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">xVals</span><span class="p">,</span> <span class="n">mop</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;polconst$\times$tbabs$\times$(constant$\times$powerlaw)&quot;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">inp</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inp</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Counts cm$^{-2}$ s$^{-1}$ keV$^{-1}$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/0fc39fcb8b1eed4b9a052ef2b2001f21ed15809f369e4375685f6b59a9978563.png" src="../../../_images/0fc39fcb8b1eed4b9a052ef2b2001f21ed15809f369e4375685f6b59a9978563.png" />
</div>
</div>
</section>
<section id="polarization-angle-vs-energy">
<h3>Polarization angle vs. energy<a class="headerlink" href="#polarization-angle-vs-energy" title="Link to this heading">#</a></h3>
<p>This part of the data and model is constraining the polarization angle, which by our model choice (particularly the
‘polconst’ component) is assumed to be constant with energy.</p>
<p>We can extract the data and model information that will let us plot the polarization angle against energy:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="s2">&quot;polangle&quot;</span><span class="p">)</span>
<span class="n">yVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
<span class="n">yErr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">yErr</span><span class="p">()]</span>
<span class="n">xVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
<span class="n">xErr</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">xErr</span><span class="p">()</span>
<span class="n">mop</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>This visualization will help us understand how good the assumption of constant polarization with energy appears to be:</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">xVals</span><span class="p">,</span>
    <span class="n">yVals</span><span class="p">,</span>
    <span class="n">xerr</span><span class="o">=</span><span class="n">xErr</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">yErr</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;k.&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;IXPE Data [01004701]&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">xVals</span><span class="p">,</span> <span class="n">mop</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;polconst$\times$tbabs$\times$(constant$\times$powerlaw)&quot;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Energy [keV]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Polarization Angle [$^\circ$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/6aaa88a3ba96e8207d6f89445d48dc67bd44689a998ec7ebac6be1a5675a627d.png" src="../../../_images/6aaa88a3ba96e8207d6f89445d48dc67bd44689a998ec7ebac6be1a5675a627d.png" />
</div>
</div>
</section>
</section>
<section id="interpreting-the-results-from-xspec">
<h2>6. Interpreting the results from XSPEC<a class="headerlink" href="#interpreting-the-results-from-xspec" title="Link to this heading">#</a></h2>
<p>There are two parameters of interest in our example; the polarization <strong>fraction</strong> (A),
and the polarization <strong>angle</strong> (<span class="math notranslate nohighlight">\(\psi\)</span>). The XSPEC error (or uncertainty) command can be used
to deduce confidence intervals for these parameters.</p>
<p>We can estimate the 99% confidence interval for these two parameters.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;re using the XSPEC error command to estimate parameter uncertainties</span>
<span class="c1"># Parameter 1 is the polarization fraction</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;6.635 1&quot;</span><span class="p">)</span>

<span class="c1"># Parameter 2 is the polarization angle</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;6.635 2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Of particular interest is the 2D error contour for the polarization fraction and polarization angle - we use XSPEC’s
<code class="docutils literal notranslate"><span class="pre">steppar</span></code> command to ‘walk’ around the polarization fraction and angle parameter spaces.</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lch</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">logChatter</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">logChatter</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># Create and open a log file for XSPEC output.</span>
<span class="c1"># This step can sometimes take a few minutes. Please be patient!</span>
<span class="n">logFile</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">openLog</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="p">,</span> <span class="s2">&quot;steppar.txt&quot;</span><span class="p">))</span>

<span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">steppar</span><span class="p">(</span><span class="s2">&quot;1 0.00 0.21 41 2 -90 0 36&quot;</span><span class="p">)</span>

<span class="c1"># Close XSPEC&#39;s currently opened log file.</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Xset</span><span class="o">.</span><span class="n">closeLog</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>With the error estimation complete, we’ll extract the plotting information from pyXspec:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch the plotting information</span>
<span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="s2">&quot;contour ,,4 1.386, 4.61 9.21 13.81&quot;</span><span class="p">)</span>
<span class="n">yVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
<span class="n">xVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
<span class="n">zVals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">z</span><span class="p">()</span>

<span class="n">levelvals</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">contourLevels</span><span class="p">()</span>
<span class="n">statval</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">Fit</span><span class="o">.</span><span class="n">statistic</span>
</pre></div>
</div>
</div>
</div>
<p>Then plot the error contour for our two polarization parameters.</p>
<div class="cell tag_hide-input config_scroll_outputs docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xVals</span><span class="p">,</span> <span class="n">yVals</span><span class="p">,</span> <span class="n">zVals</span><span class="p">,</span> <span class="n">levelvals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">polconst</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m1</span><span class="o">.</span><span class="n">polconst</span><span class="o">.</span><span class="n">psi</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Polarization Angle ($\psi$) [$^{\circ}$]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Polarization Fraction (A)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/4a923132db81a227ea0687c9b2679d377128f533972afb3a70d31ed8bc5fba53.png" src="../../../_images/4a923132db81a227ea0687c9b2679d377128f533972afb3a70d31ed8bc5fba53.png" />
</div>
</div>
<section id="determining-the-flux-and-calculating-mdp">
<h3>Determining the flux and calculating MDP<a class="headerlink" href="#determining-the-flux-and-calculating-mdp" title="Link to this heading">#</a></h3>
<p>Note that the detection is deemed “highly probable” (confidence C &gt; 99.9%) as A/<span class="math notranslate nohighlight">\(\sigma\)</span> = 4.123 &gt;<span class="math notranslate nohighlight">\(\sqrt{-2 ln(1- C)}\)</span>, where <span class="math notranslate nohighlight">\(\sigma\)</span> = 0.01807 as given by XSPEC above.</p>
<p>Finally, we can use PIMMS to estimate the Minimum Detectable Polarization (MDP).</p>
<p>To do this, we first use XSPEC to determine the (model) flux on the 2-8 keV energy range:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span><span class="o">.</span><span class="n">AllModels</span><span class="o">.</span><span class="n">calcFlux</span><span class="p">(</span><span class="s2">&quot;2.0 8.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Extract the calculated fluxes for stokes-I spectra (we know the indices because I-spectra were loaded before Q and U spectra, and each detector was loaded in sequence - note that XSPEC indexing starts at 1, unlike Python):</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flux_ispec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sp_ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
    <span class="n">flux_ispec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">AllData</span><span class="p">(</span><span class="n">sp_ind</span><span class="p">)</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">flux_ispec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7.942901256897255e-11, 7.589054935135048e-11, 7.084215422150606e-11]
</pre></div>
</div>
</div>
</div>
<p>Now we can easily calculate a mean flux:</p>
<div class="cell config_scroll_outputs docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">flux_ispec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(7.538723871394304e-11)
</pre></div>
</div>
</div>
</div>
<p>We set up a powerlaw model in <a class="reference external" href="https://heasarc.gsfc.nasa.gov/cgi-bin/Tools/w3pimms/w3pimms.pl">PIMMS</a>, passing parameters that match the model we just fit and the flux we just calculated:</p>
<ul class="simple">
<li><p>Galactic hydrogen column density (<span class="math notranslate nohighlight">\(n_{H}\)</span>) <span class="math notranslate nohighlight">\(=0.646\times 10^{22}\:\rm{cm}^{-2}\)</span></p></li>
<li><p>Photon index (<span class="math notranslate nohighlight">\(\Gamma\)</span>) <span class="math notranslate nohighlight">\(= 2.75\)</span></p></li>
<li><p>Average flux from the three detectors (<span class="math notranslate nohighlight">\(f_{\rm{X}}\)</span>) <span class="math notranslate nohighlight">\(=7.54\times 10^{-11}\)</span> erg cm<span class="math notranslate nohighlight">\(^{-2}\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span></p></li>
</ul>
<p>When simulating IXPE, we find that PIMMS returns a ‘MDP99’ of 5.62% for a 100 ks exposure.</p>
<p>Scaling by the actual mean of this observation’s exposure time (97.243 ks) gives us an MDP99 of 5.70% meaning that, for an unpolarized source with these physical parameters, an IXPE observation will return a value A &gt; 0.057 only 1% of the time.</p>
<p>This is consistent with the highly probable detection we have found through analysis of this observation - a polarization fraction of 7.45<span class="math notranslate nohighlight">\(\pm\)</span>1.8%.</p>
</section>
</section>
<section id="about-this-notebook">
<h2>About this notebook<a class="headerlink" href="#about-this-notebook" title="Link to this heading">#</a></h2>
<p>Author: Kavitha Arur, IXPE GOF Scientist</p>
<p>Author: David J Turner, HEASARC Staff Scientist</p>
<p>Updated On: 2026-02-02</p>
<section id="additional-resources">
<h3>Additional Resources<a class="headerlink" href="#additional-resources" title="Link to this heading">#</a></h3>
<p>Support: <a class="reference external" href="https://heasarc.gsfc.nasa.gov/cgi-bin/Feedback?selected=ixpe">IXPE GOF Helpdesk</a></p>
<p>Documents:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/ixpe/analysis/ixpe_quickstart.pdf">IXPE Quick Start Guide</a></p></li>
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/ixpe/analysis/IXPE_Stats-Advice.pdf">Recommended practices for statistical treatment of IXPE results</a></p></li>
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/ixpe/analysis/#supportdoc">IXPE support documentation website</a></p></li>
</ul>
</section>
<section id="acknowledgements">
<h3>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h3>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ixpe_index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">IXPE</p>
      </div>
    </a>
    <a class="right-next"
       href="../swift/swift_index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Swift</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">Outputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime">Runtime</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#global-setup">Global Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constants">Constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-ixpe-data-files-for-01004701">1. Downloading the IXPE data files for 01004701</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-structure-of-ixpe-data">2. Exploring the structure of IXPE data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-spectro-polarimetric-data-products">3. Extracting spectro-polarimetric data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-source-and-background-regions">Defining source and background regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-extractor-tool">Running the extractor tool</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-response-files">Obtaining response files</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-response-versions">Setting response versions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-quzcif-to-get-the-response-files">Using <code class="docutils literal notranslate"><span class="pre">quzcif</span></code> to get the response files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-spectro-polarimetric-data-into-pyxspec-and-fitting-a-model">4. Loading spectro-polarimetric data into pyXspec and fitting a model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-pyxspec">Configuring PyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-spectra-into-pyxspec">Reading the spectra into pyXspec</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-energy-range-to-fit">Selecting the energy range to fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-spectro-polarimetric-model">Setting up the spectro-polarimetric model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-model-fit-through-pyxspec">Running the model fit through pyXspec</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">5. Visualizing the results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-traditional-x-ray-spectrum">A ‘traditional’ X-ray spectrum</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polarization-angle-vs-energy">Polarization angle vs. energy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-results-from-xspec">6. Interpreting the results from XSPEC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-flux-and-calculating-mdp">Determining the flux and calculating MDP</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-resources">Additional Resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By HEASARC developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026, HEASARC developers.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>